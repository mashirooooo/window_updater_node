import{createHash as e}from"crypto";import{basename as t,join as s,dirname as i}from"path";import{statSync as r,readFileSync as n,readdirSync as o,createWriteStream as a,createReadStream as h,stat as l,existsSync as c,rename as p,mkdirSync as u,writeFileSync as f}from"fs";import{createGzip as d,createGunzip as m}from"zlib";import{spawn as g}from"child_process";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function E(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{h(i.next(e))}catch(e){n(e)}}function a(e){try{h(i.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}h((i=i.apply(e,t||[])).next())}))}var v="object"==typeof process&&process&&"win32"===process.platform?{sep:"\\"}:{sep:"/"},$=I;function I(e,t,s){e instanceof RegExp&&(e=w(e,s)),t instanceof RegExp&&(t=w(t,s));var i=R(e,t,s);return i&&{start:i[0],end:i[1],pre:s.slice(0,i[0]),body:s.slice(i[0]+e.length,i[1]),post:s.slice(i[1]+t.length)}}function w(e,t){var s=t.match(e);return s?s[0]:null}function R(e,t,s){var i,r,n,o,a,h=s.indexOf(e),l=s.indexOf(t,h+1),c=h;if(h>=0&&l>0){if(e===t)return[h,l];for(i=[],n=s.length;c>=0&&!a;)c==h?(i.push(c),h=s.indexOf(e,c+1)):1==i.length?a=[i.pop(),l]:((r=i.pop())<n&&(n=r,o=l),l=s.indexOf(t,c+1)),c=h<l&&h>=0?h:l;i.length&&(a=[n,o])}return a}I.range=R;var y=$,L=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return _(function(e){return e.split("\\\\").join(S).split("\\{").join(O).split("\\}").join(T).split("\\,").join(A).split("\\.").join(N)}(e),!0).map(x)},S="\0SLASH"+Math.random()+"\0",O="\0OPEN"+Math.random()+"\0",T="\0CLOSE"+Math.random()+"\0",A="\0COMMA"+Math.random()+"\0",N="\0PERIOD"+Math.random()+"\0";function b(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function x(e){return e.split(S).join("\\").split(O).join("{").split(T).join("}").split(A).join(",").split(N).join(".")}function C(e){if(!e)return[""];var t=[],s=y("{","}",e);if(!s)return e.split(",");var i=s.pre,r=s.body,n=s.post,o=i.split(",");o[o.length-1]+="{"+r+"}";var a=C(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function k(e){return"{"+e+"}"}function z(e){return/^-?0\d/.test(e)}function P(e,t){return e<=t}function M(e,t){return e>=t}function _(e,t){var s=[],i=y("{","}",e);if(!i)return[e];var r=i.pre,n=i.post.length?_(i.post,!1):[""];if(/\$$/.test(i.pre))for(var o=0;o<n.length;o++){var a=r+"{"+i.body+"}"+n[o];s.push(a)}else{var h,l,c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),u=c||p,f=i.body.indexOf(",")>=0;if(!u&&!f)return i.post.match(/,.*\}/)?_(e=i.pre+"{"+i.body+T+i.post):[e];if(u)h=i.body.split(/\.\./);else if(1===(h=C(i.body)).length&&1===(h=_(h[0],!1).map(k)).length)return n.map((function(e){return i.pre+h[0]+e}));if(u){var d=b(h[0]),m=b(h[1]),g=Math.max(h[0].length,h[1].length),E=3==h.length?Math.abs(b(h[2])):1,v=P;m<d&&(E*=-1,v=M);var $=h.some(z);l=[];for(var I=d;v(I,m);I+=E){var w;if(p)"\\"===(w=String.fromCharCode(I))&&(w="");else if(w=String(I),$){var R=g-w.length;if(R>0){var L=new Array(R+1).join("0");w=I<0?"-"+L+w.slice(1):L+w}}l.push(w)}}else{l=[];for(var S=0;S<h.length;S++)l.push.apply(l,_(h[S],!1))}for(S=0;S<l.length;S++)for(o=0;o<n.length;o++){a=r+l[S]+n[o];(!t||u||a)&&s.push(a)}}return s}const D=j=(e,t,s={})=>(Z(t),!(!s.nocomment&&"#"===t.charAt(0))&&new Q(t,s).match(e));var j=D;const F=v;D.sep=F.sep;const G=Symbol("globstar **");D.GLOBSTAR=G;const U=L,X={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},B=e=>e.split("").reduce(((e,t)=>(e[t]=!0,e)),{}),H=B("().*{}+?[]^$\\!"),V=B("[.("),W=/\/+/;D.filter=(e,t={})=>(s,i,r)=>D(s,e,t);const Y=(e,t={})=>{const s={};return Object.keys(e).forEach((t=>s[t]=e[t])),Object.keys(t).forEach((e=>s[e]=t[e])),s};D.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return D;const t=D,s=(s,i,r)=>t(s,i,Y(e,r));return(s.Minimatch=class extends t.Minimatch{constructor(t,s){super(t,Y(e,s))}}).defaults=s=>t.defaults(Y(e,s)).Minimatch,s.filter=(s,i)=>t.filter(s,Y(e,i)),s.defaults=s=>t.defaults(Y(e,s)),s.makeRe=(s,i)=>t.makeRe(s,Y(e,i)),s.braceExpand=(s,i)=>t.braceExpand(s,Y(e,i)),s.match=(s,i,r)=>t.match(s,i,Y(e,r)),s},D.braceExpand=(e,t)=>q(e,t);const q=(e,t={})=>(Z(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:U(e)),Z=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},J=Symbol("subparse");D.makeRe=(e,t)=>new Q(e,t||{}).makeRe(),D.match=(e,t,s={})=>{const i=new Q(t,s);return e=e.filter((e=>i.match(e))),i.options.nonull&&!e.length&&e.push(t),e};class Q{constructor(e,t){Z(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();let s=this.globSet=this.braceExpand();t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,s),s=this.globParts=s.map((e=>e.split(W))),this.debug(this.pattern,s),s=s.map(((e,t,s)=>e.map(this.parse,this))),this.debug(this.pattern,s),s=s.filter((e=>-1===e.indexOf(!1))),this.debug(this.pattern,s),this.set=s}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let i=0;i<e.length&&"!"===e.charAt(i);i++)t=!t,s++;s&&(this.pattern=e.substr(s)),this.negate=t}matchOne(e,t,s){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var r=0,n=0,o=e.length,a=t.length;r<o&&n<a;r++,n++){this.debug("matchOne loop");var h,l=t[n],c=e[r];if(this.debug(t,l,c),!1===l)return!1;if(l===G){this.debug("GLOBSTAR",[t,l,c]);var p=r,u=n+1;if(u===a){for(this.debug("** at the end");r<o;r++)if("."===e[r]||".."===e[r]||!i.dot&&"."===e[r].charAt(0))return!1;return!0}for(;p<o;){var f=e[p];if(this.debug("\nglobstar while",e,p,t,u,f),this.matchOne(e.slice(p),t.slice(u),s))return this.debug("globstar found match!",p,o,f),!0;if("."===f||".."===f||!i.dot&&"."===f.charAt(0)){this.debug("dot detected!",e,p,t,u);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!s||(this.debug("\n>>> no match, partial?",e,p,t,u),p!==o))}if("string"==typeof l?(h=c===l,this.debug("string match",l,c,h)):(h=c.match(l),this.debug("pattern match",l,c,h)),!h)return!1}if(r===o&&n===a)return!0;if(r===o)return s;if(n===a)return r===o-1&&""===e[r];throw new Error("wtf?")}braceExpand(){return q(this.pattern,this.options)}parse(e,t){Z(e);const s=this.options;if("**"===e){if(!s.noglobstar)return G;e="*"}if(""===e)return"";let i="",r=!!s.nocase,n=!1;const o=[],a=[];let h,l,c,p,u=!1,f=-1,d=-1;const m="."===e.charAt(0)?"":s.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=()=>{if(h){switch(h){case"*":i+="[^/]*?",r=!0;break;case"?":i+="[^/]",r=!0;break;default:i+="\\"+h}this.debug("clearStateChar %j %j",h,i),h=!1}};for(let t,m=0;m<e.length&&(t=e.charAt(m));m++)if(this.debug("%s\t%s %s %j",e,m,i,t),n){if("/"===t)return!1;H[t]&&(i+="\\"),i+=t,n=!1}else switch(t){case"/":return!1;case"\\":g(),n=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,m,i,t),u){this.debug("  in class"),"!"===t&&m===d+1&&(t="^"),i+=t;continue}this.debug("call clearStateChar %j",h),g(),h=t,s.noext&&g();continue;case"(":if(u){i+="(";continue}if(!h){i+="\\(";continue}o.push({type:h,start:m-1,reStart:i.length,open:X[h].open,close:X[h].close}),i+="!"===h?"(?:(?!(?:":"(?:",this.debug("plType %j %j",h,i),h=!1;continue;case")":if(u||!o.length){i+="\\)";continue}g(),r=!0,c=o.pop(),i+=c.close,"!"===c.type&&a.push(c),c.reEnd=i.length;continue;case"|":if(u||!o.length){i+="\\|";continue}g(),i+="|";continue;case"[":if(g(),u){i+="\\"+t;continue}u=!0,d=m,f=i.length,i+=t;continue;case"]":if(m===d+1||!u){i+="\\"+t;continue}l=e.substring(d+1,m);try{RegExp("["+l+"]")}catch(e){p=this.parse(l,J),i=i.substr(0,f)+"\\["+p[0]+"\\]",r=r||p[1],u=!1;continue}r=!0,u=!1,i+=t;continue;default:g(),!H[t]||"^"===t&&u||(i+="\\"),i+=t}for(u&&(l=e.substr(d+1),p=this.parse(l,J),i=i.substr(0,f)+"\\["+p[0],r=r||p[1]),c=o.pop();c;c=o.pop()){let e;e=i.slice(c.reStart+c.open.length),this.debug("setting tail",i,c),e=e.replace(/((?:\\{2}){0,64})(\\?)\|/g,((e,t,s)=>(s||(s="\\"),t+t+s+"|"))),this.debug("tail=%j\n   %s",e,e,c,i);const t="*"===c.type?"[^/]*?":"?"===c.type?"[^/]":"\\"+c.type;r=!0,i=i.slice(0,c.reStart)+t+"\\("+e}g(),n&&(i+="\\\\");const E=V[i.charAt(0)];for(let e=a.length-1;e>-1;e--){const s=a[e],r=i.slice(0,s.reStart),n=i.slice(s.reStart,s.reEnd-8);let o=i.slice(s.reEnd);const h=i.slice(s.reEnd-8,s.reEnd)+o,l=r.split("(").length-1;let c=o;for(let e=0;e<l;e++)c=c.replace(/\)[+*?]?/,"");o=c;i=r+n+o+(""===o&&t!==J?"$":"")+h}if(""!==i&&r&&(i="(?=.)"+i),E&&(i=m+i),t===J)return[i,r];if(!r)return e.replace(/\\(.)/g,"$1");const v=s.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",v),{_glob:e,_src:i})}catch(e){return new RegExp("$.")}}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",i=t.nocase?"i":"";let r=e.map((e=>(e=e.map((e=>"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===G?G:e._src)).reduce(((e,t)=>(e[e.length-1]===G&&t===G||e.push(t),e)),[]),e.forEach(((t,i)=>{t===G&&e[i-1]!==G&&(0===i?e.length>1?e[i+1]="(?:\\/|"+s+"\\/)?"+e[i+1]:e[i]=s:i===e.length-1?e[i-1]+="(?:\\/|"+s+")?":(e[i-1]+="(?:\\/|\\/"+s+"\\/)"+e[i+1],e[i+1]=G))})),e.filter((e=>e!==G)).join("/")))).join("|");r="^(?:"+r+")$",this.negate&&(r="^(?!"+r+").*$");try{this.regexp=new RegExp(r,i)}catch(e){this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const s=this.options;"/"!==F.sep&&(e=e.split(F.sep).join("/")),e=e.split(W),this.debug(this.pattern,"split",e);const i=this.set;let r;this.debug(this.pattern,"set",i);for(let t=e.length-1;t>=0&&(r=e[t],!r);t--);for(let n=0;n<i.length;n++){const o=i[n];let a=e;s.matchBase&&1===o.length&&(a=[r]);if(this.matchOne(a,o,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return D.defaults(e).Minimatch}}D.Minimatch=Q;class K{}class ee extends K{}class te{}class se{constructor(){this.added=[],this.changed=[]}}class ie{constructor(){this.status="init",this.message=""}}var re;function ne(t){return e("sha256").update(t).digest("hex")}function oe(e,t){if("function"==typeof e)return e(t);if(e&&Array.isArray(e)&&0!==e.length){return new RegExp(e.reduce(((e,t)=>e+"|"+j.makeRe(t).source),"").substring(1)).test(t)}return!1}function ae(e,i={}){var a,h;const l=r(e),c=t(e);if(l.isFile()){if(oe(null===(a=null==i?void 0:i.files)||void 0===a?void 0:a.exclude,c))return null;const t=new K;return t.name=c,t.hash=ne(n(e)),t}if(l.isDirectory()){if(oe(null===(h=null==i?void 0:i.folders)||void 0===h?void 0:h.exclude,c))return null;const t=new ee;return t.name=c,t.children=o(e).map((t=>ae(s(e,t),i))).filter((e=>null!==e)),t.hash=ne(t.children.map((e=>e.hash)).join("")),t}return null}function he(e){e&&e.children&&(e.childrenObject=e.children.reduce(((e,t)=>(t.children&&he(t),e[t.name]=t,e)),{}))}function le(e,t,s=new se,i="."){return t.hash===e.hash||(t.children?t.children.forEach((t=>{t=t,e.childrenObject&&e.childrenObject[t.name]?le(e.childrenObject[t.name],t,s,i+"/"+t.name):ce(t,i+"/"+t.name,s.added)})):s.changed.push({filePath:i,hash:t.hash})),s}function ce(e,t,s){e.children?e.children.forEach((e=>{ce(e,t+"/"+e.name,s)})):s.push({filePath:t,hash:e.hash})}function pe(e,t){return new Promise(((s,i)=>{const r=d(),n=a(t),o=h(e);o.on("close",s),o.on("error",i),n.on("error",i),o.pipe(r).pipe(n)}))}function ue(e,t,i,r=!1){return E(this,void 0,void 0,(function*(){if(e.children)for(let s=0;s<e.children.length;s++)yield ue(e.children[s],t+(r?"":"/"+e.name),i);else yield pe(t+"/"+e.name,s(i,e.hash+".gz"))}))}function fe(e,t){return new Promise((s=>{l(e,((i,r)=>{var n;s(!i&&(r.isFile()&&(null===(n=ae(e))||void 0===n?void 0:n.hash)===t))}))}))}!function(e){e[e.HaveNothingUpdate=0]="HaveNothingUpdate",e[e.Success=1]="Success",e[e.Failed=2]="Failed"}(re||(re={}));var de={exports:{}};var me={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};var ge="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:s}=me,i=ge,r=(t=e.exports={}).re=[],n=t.src=[],o=t.t={};let a=0;const h=(e,t,s)=>{const h=a++;i(e,h,t),o[e]=h,n[h]=t,r[h]=new RegExp(t,s?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","[0-9]+"),h("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),h("MAINVERSION",`(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${n[o.NUMERICIDENTIFIER]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${n[o.NUMERICIDENTIFIERLOOSE]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${n[o.PRERELEASEIDENTIFIER]}(?:\\.${n[o.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${n[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[o.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER","[0-9A-Za-z-]+"),h("BUILD",`(?:\\+(${n[o.BUILDIDENTIFIER]}(?:\\.${n[o.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${n[o.MAINVERSION]}${n[o.PRERELEASE]}?${n[o.BUILD]}?`),h("FULL",`^${n[o.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${n[o.MAINVERSIONLOOSE]}${n[o.PRERELEASELOOSE]}?${n[o.BUILD]}?`),h("LOOSE",`^${n[o.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${n[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${n[o.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:${n[o.PRERELEASE]})?${n[o.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:${n[o.PRERELEASELOOSE]})?${n[o.BUILD]}?)?)?`),h("XRANGE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?(?:$|[^\\d])`),h("COERCERTL",n[o.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${n[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${n[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${n[o.LONECARET]}${n[o.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${n[o.LONECARET]}${n[o.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${n[o.GTLT]}\\s*(${n[o.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]}|${n[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${n[o.XRANGEPLAIN]})\\s+-\\s+(${n[o.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${n[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[o.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(de,de.exports);const Ee=["includePrerelease","loose","rtl"];var ve=e=>e?"object"!=typeof e?{loose:!0}:Ee.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const $e=/^[0-9]+$/,Ie=(e,t)=>{const s=$e.test(e),i=$e.test(t);return s&&i&&(e=+e,t=+t),e===t?0:s&&!i?-1:i&&!s?1:e<t?-1:1};var we={compareIdentifiers:Ie,rcompareIdentifiers:(e,t)=>Ie(t,e)};const Re=ge,{MAX_LENGTH:ye,MAX_SAFE_INTEGER:Le}=me,{re:Se,t:Oe}=de.exports,Te=ve,{compareIdentifiers:Ae}=we;class Ne{constructor(e,t){if(t=Te(t),e instanceof Ne){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>ye)throw new TypeError(`version is longer than ${ye} characters`);Re("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const s=e.trim().match(t.loose?Se[Oe.LOOSE]:Se[Oe.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>Le||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Le||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Le||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<Le)return t}return e})):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Re("SemVer.compare",this.version,this.options,e),!(e instanceof Ne)){if("string"==typeof e&&e===this.version)return 0;e=new Ne(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ne||(e=new Ne(e,this.options)),Ae(this.major,e.major)||Ae(this.minor,e.minor)||Ae(this.patch,e.patch)}comparePre(e){if(e instanceof Ne||(e=new Ne(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const s=this.prerelease[t],i=e.prerelease[t];if(Re("prerelease compare",t,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return Ae(s,i)}while(++t)}compareBuild(e){e instanceof Ne||(e=new Ne(e,this.options));let t=0;do{const s=this.build[t],i=e.build[t];if(Re("prerelease compare",t,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return Ae(s,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var be=Ne;const{MAX_LENGTH:xe}=me,{re:Ce,t:ke}=de.exports,ze=be,Pe=ve;var Me=(e,t)=>{if(t=Pe(t),e instanceof ze)return e;if("string"!=typeof e)return null;if(e.length>xe)return null;if(!(t.loose?Ce[ke.LOOSE]:Ce[ke.FULL]).test(e))return null;try{return new ze(e,t)}catch(e){return null}};const _e=Me;var De=(e,t)=>{const s=_e(e,t);return s?s.version:null};const je=Me;var Fe=(e,t)=>{const s=je(e.trim().replace(/^[=v]+/,""),t);return s?s.version:null};const Ge=be;var Ue=(e,t,s,i)=>{"string"==typeof s&&(i=s,s=void 0);try{return new Ge(e,s).inc(t,i).version}catch(e){return null}};const Xe=be;var Be=(e,t,s)=>new Xe(e,s).compare(new Xe(t,s));const He=Be;var Ve=(e,t,s)=>0===He(e,t,s);const We=Me,Ye=Ve;var qe=(e,t)=>{if(Ye(e,t))return null;{const s=We(e),i=We(t),r=s.prerelease.length||i.prerelease.length,n=r?"pre":"",o=r?"prerelease":"";for(const e in s)if(("major"===e||"minor"===e||"patch"===e)&&s[e]!==i[e])return n+e;return o}};const Ze=be;var Je=(e,t)=>new Ze(e,t).major;const Qe=be;var Ke=(e,t)=>new Qe(e,t).minor;const et=be;var tt=(e,t)=>new et(e,t).patch;const st=Me;var it=(e,t)=>{const s=st(e,t);return s&&s.prerelease.length?s.prerelease:null};const rt=Be;var nt=(e,t,s)=>rt(t,e,s);const ot=Be;var at=(e,t)=>ot(e,t,!0);const ht=be;var lt=(e,t,s)=>{const i=new ht(e,s),r=new ht(t,s);return i.compare(r)||i.compareBuild(r)};const ct=lt;var pt=(e,t)=>e.sort(((e,s)=>ct(e,s,t)));const ut=lt;var ft=(e,t)=>e.sort(((e,s)=>ut(s,e,t)));const dt=Be;var mt=(e,t,s)=>dt(e,t,s)>0;const gt=Be;var Et=(e,t,s)=>gt(e,t,s)<0;const vt=Be;var $t=(e,t,s)=>0!==vt(e,t,s);const It=Be;var wt=(e,t,s)=>It(e,t,s)>=0;const Rt=Be;var yt=(e,t,s)=>Rt(e,t,s)<=0;const Lt=Ve,St=$t,Ot=mt,Tt=wt,At=Et,Nt=yt;var bt=(e,t,s,i)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e===s;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e!==s;case"":case"=":case"==":return Lt(e,s,i);case"!=":return St(e,s,i);case">":return Ot(e,s,i);case">=":return Tt(e,s,i);case"<":return At(e,s,i);case"<=":return Nt(e,s,i);default:throw new TypeError(`Invalid operator: ${t}`)}};const xt=be,Ct=Me,{re:kt,t:zt}=de.exports;var Pt=(e,t)=>{if(e instanceof xt)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let s=null;if((t=t||{}).rtl){let t;for(;(t=kt[zt.COERCERTL].exec(e))&&(!s||s.index+s[0].length!==e.length);)s&&t.index+t[0].length===s.index+s[0].length||(s=t),kt[zt.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;kt[zt.COERCERTL].lastIndex=-1}else s=e.match(kt[zt.COERCE]);return null===s?null:Ct(`${s[2]}.${s[3]||"0"}.${s[4]||"0"}`,t)};const Mt="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,_t="undefined"!=typeof AbortController?AbortController:Object.assign(class{constructor(){this.signal=new _t.AbortSignal}abort(){this.signal.aborted=!0}},{AbortSignal:class{constructor(){this.aborted=!1}}}),Dt=new Set,jt=(e,t)=>{const s=`LRU_CACHE_OPTION_${e}`;Ut(s)&&Xt(s,`${e} option`,`options.${t}`,Yt)},Ft=(e,t)=>{const s=`LRU_CACHE_METHOD_${e}`;if(Ut(s)){const{prototype:i}=Yt,{get:r}=Object.getOwnPropertyDescriptor(i,e);Xt(s,`${e} method`,`cache.${t}()`,r)}},Gt=(...e)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...e):console.error(...e)},Ut=e=>!Dt.has(e),Xt=(e,t,s,i)=>{Dt.add(e);Gt(`The ${t} is deprecated. Please use ${s} instead.`,"DeprecationWarning",e,i)},Bt=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),Ht=e=>Bt(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?Vt:null:null;class Vt extends Array{constructor(e){super(e),this.fill(0)}}class Wt{constructor(e){const t=e?Ht(e):Array;this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class Yt{constructor(e={}){const{max:t=0,ttl:s,ttlResolution:i=1,ttlAutopurge:r,updateAgeOnGet:n,updateAgeOnHas:o,allowStale:a,dispose:h,disposeAfter:l,noDisposeOnSet:c,noUpdateTTL:p,maxSize:u=0,sizeCalculation:f,fetchMethod:d}=e,{length:m,maxAge:g,stale:E}=e instanceof Yt?{}:e;if(0!==t&&!Bt(t))throw new TypeError("max option must be a nonnegative integer");const v=t?Ht(t):Array;if(!v)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=u,this.sizeCalculation=f||m,this.sizeCalculation){if(!this.maxSize)throw new TypeError("cannot set sizeCalculation without setting maxSize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=d||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new v(t),this.prev=new v(t),this.head=0,this.tail=0,this.free=new Wt(t),this.initialFill=1,this.size=0,"function"==typeof h&&(this.dispose=h),"function"==typeof l?(this.disposeAfter=l,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!c,this.noUpdateTTL=!!p,0!==this.maxSize){if(!Bt(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!a||!!E,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!o,this.ttlResolution=Bt(i)||0===i?i:1,this.ttlAutopurge=!!r,this.ttl=s||g||0,this.ttl){if(!Bt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(Ut(e)){Dt.add(e);Gt("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,Yt)}}E&&jt("stale","allowStale"),g&&jt("maxAge","ttl"),m&&jt("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new Vt(this.max),this.starts=new Vt(this.max),this.setItemTTL=(e,t)=>{if(this.starts[e]=0!==t?Mt.now():0,this.ttls[e]=t,0!==t&&this.ttlAutopurge){const s=setTimeout((()=>{this.isStale(e)&&this.delete(this.keyList[e])}),t+1);s.unref&&s.unref()}},this.updateItemAge=e=>{this.starts[e]=0!==this.ttls[e]?Mt.now():0};let e=0;const t=()=>{const t=Mt.now();if(this.ttlResolution>0){e=t;const s=setTimeout((()=>e=0),this.ttlResolution);s.unref&&s.unref()}return t};this.getRemainingTTL=s=>{const i=this.keyMap.get(s);return void 0===i?0:0===this.ttls[i]||0===this.starts[i]?1/0:this.starts[i]+this.ttls[i]-(e||t())},this.isStale=s=>0!==this.ttls[s]&&0!==this.starts[s]&&(e||t())-this.starts[s]>this.ttls[s]}updateItemAge(e){}setItemTTL(e,t){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new Vt(this.max),this.removeItemSize=e=>this.calculatedSize-=this.sizes[e],this.requireSize=(e,t,s,i)=>{if(!Bt(s)){if(!i)throw new TypeError("invalid size value (must be positive integer)");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(s=i(t,e),!Bt(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s},this.addItemSize=(e,t,s,i)=>{this.sizes[e]=i;const r=this.maxSize-this.sizes[e];for(;this.calculatedSize>r;)this.evict();this.calculatedSize+=this.sizes[e]},this.delete=e=>{if(0!==this.size){const t=this.keyMap.get(e);void 0!==t&&(this.calculatedSize-=this.sizes[t])}return Yt.prototype.delete.call(this,e)}}removeItemSize(e){}addItemSize(e,t,s,i){}requireSize(e,t,s,i){if(s||i)throw new TypeError("cannot set size without setting maxSize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())yield[this.keyList[e],this.valList[e]]}*rentries(){for(const e of this.rindexes())yield[this.keyList[e],this.valList[e]]}*keys(){for(const e of this.indexes())yield this.keyList[e]}*rkeys(){for(const e of this.rindexes())yield this.keyList[e]}*values(){for(const e of this.indexes())yield this.valList[e]}*rvalues(){for(const e of this.rindexes())yield this.valList[e]}[Symbol.iterator](){return this.entries()}find(e,t={}){for(const s of this.indexes())if(e(this.valList[s],this.keyList[s],this))return this.get(this.keyList[s],t)}forEach(e,t=this){for(const s of this.indexes())e.call(t,this.valList[s],this.keyList[s],this)}rforEach(e,t=this){for(const s of this.rindexes())e.call(t,this.valList[s],this.keyList[s],this)}get prune(){return Ft("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const e=[];for(const t of this.indexes()){const s=this.keyList[t],i={value:this.valList[t]};this.ttls&&(i.ttl=this.ttls[t]),this.sizes&&(i.size=this.sizes[t]),e.unshift([s,i])}return e}load(e){this.clear();for(const[t,s]of e)this.set(t,s.value,s)}dispose(e,t,s){}set(e,t,{ttl:s=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:r=0,sizeCalculation:n=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL}={}){r=this.requireSize(e,t,r,n);let a=0===this.size?void 0:this.keyMap.get(e);if(void 0===a)a=this.newIndex(),this.keyList[a]=e,this.valList[a]=t,this.keyMap.set(e,a),this.next[this.tail]=a,this.prev[a]=this.tail,this.tail=a,this.size++,this.addItemSize(a,t,e,r),o=!1;else{const s=this.valList[a];t!==s&&(this.isBackgroundFetch(s)?s.__abortController.abort():i||(this.dispose(s,e,"set"),this.disposeAfter&&this.disposed.push([s,e,"set"])),this.removeItemSize(a),this.valList[a]=t,this.addItemSize(a,t,e,r)),this.moveToTail(a)}if(0===s||0!==this.ttl||this.ttls||this.initializeTTLTracking(),o||this.setItemTTL(a,s),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max?this.evict():0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(),e}}evict(){const e=this.head,t=this.keyList[e],s=this.valList[e];return this.isBackgroundFetch(s)?s.__abortController.abort():(this.dispose(s,t,"evict"),this.disposeAfter&&this.disposed.push([s,t,"evict"])),this.removeItemSize(e),this.head=this.next[e],this.keyMap.delete(t),this.size--,e}has(e,{updateAgeOnHas:t=this.updateAgeOnHas}={}){const s=this.keyMap.get(e);return void 0!==s&&!this.isStale(s)&&(t&&this.updateItemAge(s),!0)}peek(e,{allowStale:t=this.allowStale}={}){const s=this.keyMap.get(e);if(void 0!==s&&(t||!this.isStale(s)))return this.valList[s]}backgroundFetch(e,t,s){const i=void 0===t?void 0:this.valList[t];if(this.isBackgroundFetch(i))return i;const r=new _t,n={signal:r.signal,options:s},o=Promise.resolve(this.fetchMethod(e,i,n)).then((t=>(r.signal.aborted||this.set(e,t,n.options),t)));return o.__abortController=r,o.__staleWhileFetching=i,void 0===t?(this.set(e,o,n.options),t=this.keyMap.get(e)):this.valList[t]=o,o}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,ttl:i=this.ttl,noDisposeOnSet:r=this.noDisposeOnSet,size:n=0,sizeCalculation:o=this.sizeCalculation,noUpdateTTL:a=this.noUpdateTTL}={}){if(!this.fetchMethod)return this.get(e,{allowStale:t,updateAgeOnGet:s});const h={allowStale:t,updateAgeOnGet:s,ttl:i,noDisposeOnSet:r,size:n,sizeCalculation:o,noUpdateTTL:a};let l=this.keyMap.get(e);if(void 0===l)return this.backgroundFetch(e,l,h);{const i=this.valList[l];if(this.isBackgroundFetch(i))return t&&void 0!==i.__staleWhileFetching?i.__staleWhileFetching:i;if(!this.isStale(l))return this.moveToTail(l),s&&this.updateItemAge(l),i;const r=this.backgroundFetch(e,l,h);return t&&void 0!==r.__staleWhileFetching?r.__staleWhileFetching:r}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet}={}){const i=this.keyMap.get(e);if(void 0!==i){const r=this.valList[i],n=this.isBackgroundFetch(r);if(this.isStale(i))return n?t?r.__staleWhileFetching:void 0:(this.delete(e),t?r:void 0);if(n)return;return this.moveToTail(i),s&&this.updateItemAge(i),r}}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return Ft("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const s=this.keyMap.get(e);if(void 0!==s)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(s);const t=this.valList[s];this.isBackgroundFetch(t)?t.__abortController.abort():(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[s]=null,this.valList[s]=null,s===this.tail?this.tail=this.prev[s]:s===this.head?this.head=this.next[s]:(this.next[this.prev[s]]=this.next[s],this.prev[this.next[s]]=this.prev[s]),this.size--,this.free.push(s)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort();else{const s=this.keyList[e];this.dispose(t,s,"delete"),this.disposeAfter&&this.disposed.push([t,s,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return Ft("reset","clear"),this.clear}get length(){return((e,t)=>{const s=`LRU_CACHE_PROPERTY_${e}`;if(Ut(s)){const{prototype:i}=Yt,{get:r}=Object.getOwnPropertyDescriptor(i,e);Xt(s,`${e} property`,`cache.${t}`,r)}})("length","size"),this.size}}var qt=Yt;class Zt{constructor(e,t){if(t=Kt(t),e instanceof Zt)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Zt(e.raw,t);if(e instanceof es)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!hs(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&ls(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,s=Qt.get(t);if(s)return s;const i=this.options.loose,r=i?is[rs.HYPHENRANGELOOSE]:is[rs.HYPHENRANGE];e=e.replace(r,ws(this.options.includePrerelease)),ts("hyphen replace",e),e=e.replace(is[rs.COMPARATORTRIM],ns),ts("comparator trim",e);let n=(e=(e=(e=e.replace(is[rs.TILDETRIM],os)).replace(is[rs.CARETTRIM],as)).split(/\s+/).join(" ")).split(" ").map((e=>ps(e,this.options))).join(" ").split(/\s+/).map((e=>Is(e,this.options)));i&&(n=n.filter((e=>(ts("loose invalid filter",e,this.options),!!e.match(is[rs.COMPARATORLOOSE]))))),ts("range list",n);const o=new Map,a=n.map((e=>new es(e,this.options)));for(const e of a){if(hs(e))return[e];o.set(e.value,e)}o.size>1&&o.has("")&&o.delete("");const h=[...o.values()];return Qt.set(t,h),h}intersects(e,t){if(!(e instanceof Zt))throw new TypeError("a Range is required");return this.set.some((s=>cs(s,t)&&e.set.some((e=>cs(e,t)&&s.every((s=>e.every((e=>s.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new ss(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(Rs(this.set[t],e,this.options))return!0;return!1}}var Jt=Zt;const Qt=new qt({max:1e3}),Kt=ve,es=Ss,ts=ge,ss=be,{re:is,t:rs,comparatorTrimReplace:ns,tildeTrimReplace:os,caretTrimReplace:as}=de.exports,hs=e=>"<0.0.0-0"===e.value,ls=e=>""===e.value,cs=(e,t)=>{let s=!0;const i=e.slice();let r=i.pop();for(;s&&i.length;)s=i.every((e=>r.intersects(e,t))),r=i.pop();return s},ps=(e,t)=>(ts("comp",e,t),e=ms(e,t),ts("caret",e),e=fs(e,t),ts("tildes",e),e=Es(e,t),ts("xrange",e),e=$s(e,t),ts("stars",e),e),us=e=>!e||"x"===e.toLowerCase()||"*"===e,fs=(e,t)=>e.trim().split(/\s+/).map((e=>ds(e,t))).join(" "),ds=(e,t)=>{const s=t.loose?is[rs.TILDELOOSE]:is[rs.TILDE];return e.replace(s,((t,s,i,r,n)=>{let o;return ts("tilde",e,t,s,i,r,n),us(s)?o="":us(i)?o=`>=${s}.0.0 <${+s+1}.0.0-0`:us(r)?o=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:n?(ts("replaceTilde pr",n),o=`>=${s}.${i}.${r}-${n} <${s}.${+i+1}.0-0`):o=`>=${s}.${i}.${r} <${s}.${+i+1}.0-0`,ts("tilde return",o),o}))},ms=(e,t)=>e.trim().split(/\s+/).map((e=>gs(e,t))).join(" "),gs=(e,t)=>{ts("caret",e,t);const s=t.loose?is[rs.CARETLOOSE]:is[rs.CARET],i=t.includePrerelease?"-0":"";return e.replace(s,((t,s,r,n,o)=>{let a;return ts("caret",e,t,s,r,n,o),us(s)?a="":us(r)?a=`>=${s}.0.0${i} <${+s+1}.0.0-0`:us(n)?a="0"===s?`>=${s}.${r}.0${i} <${s}.${+r+1}.0-0`:`>=${s}.${r}.0${i} <${+s+1}.0.0-0`:o?(ts("replaceCaret pr",o),a="0"===s?"0"===r?`>=${s}.${r}.${n}-${o} <${s}.${r}.${+n+1}-0`:`>=${s}.${r}.${n}-${o} <${s}.${+r+1}.0-0`:`>=${s}.${r}.${n}-${o} <${+s+1}.0.0-0`):(ts("no pr"),a="0"===s?"0"===r?`>=${s}.${r}.${n}${i} <${s}.${r}.${+n+1}-0`:`>=${s}.${r}.${n}${i} <${s}.${+r+1}.0-0`:`>=${s}.${r}.${n} <${+s+1}.0.0-0`),ts("caret return",a),a}))},Es=(e,t)=>(ts("replaceXRanges",e,t),e.split(/\s+/).map((e=>vs(e,t))).join(" ")),vs=(e,t)=>{e=e.trim();const s=t.loose?is[rs.XRANGELOOSE]:is[rs.XRANGE];return e.replace(s,((s,i,r,n,o,a)=>{ts("xRange",e,s,i,r,n,o,a);const h=us(r),l=h||us(n),c=l||us(o),p=c;return"="===i&&p&&(i=""),a=t.includePrerelease?"-0":"",h?s=">"===i||"<"===i?"<0.0.0-0":"*":i&&p?(l&&(n=0),o=0,">"===i?(i=">=",l?(r=+r+1,n=0,o=0):(n=+n+1,o=0)):"<="===i&&(i="<",l?r=+r+1:n=+n+1),"<"===i&&(a="-0"),s=`${i+r}.${n}.${o}${a}`):l?s=`>=${r}.0.0${a} <${+r+1}.0.0-0`:c&&(s=`>=${r}.${n}.0${a} <${r}.${+n+1}.0-0`),ts("xRange return",s),s}))},$s=(e,t)=>(ts("replaceStars",e,t),e.trim().replace(is[rs.STAR],"")),Is=(e,t)=>(ts("replaceGTE0",e,t),e.trim().replace(is[t.includePrerelease?rs.GTE0PRE:rs.GTE0],"")),ws=e=>(t,s,i,r,n,o,a,h,l,c,p,u,f)=>`${s=us(i)?"":us(r)?`>=${i}.0.0${e?"-0":""}`:us(n)?`>=${i}.${r}.0${e?"-0":""}`:o?`>=${s}`:`>=${s}${e?"-0":""}`} ${h=us(l)?"":us(c)?`<${+l+1}.0.0-0`:us(p)?`<${l}.${+c+1}.0-0`:u?`<=${l}.${c}.${p}-${u}`:e?`<${l}.${c}.${+p+1}-0`:`<=${h}`}`.trim(),Rs=(e,t,s)=>{for(let s=0;s<e.length;s++)if(!e[s].test(t))return!1;if(t.prerelease.length&&!s.includePrerelease){for(let s=0;s<e.length;s++)if(ts(e[s].semver),e[s].semver!==es.ANY&&e[s].semver.prerelease.length>0){const i=e[s].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0},ys=Symbol("SemVer ANY");class Ls{static get ANY(){return ys}constructor(e,t){if(t=Os(t),e instanceof Ls){if(e.loose===!!t.loose)return e;e=e.value}bs("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ys?this.value="":this.value=this.operator+this.semver.version,bs("comp",this)}parse(e){const t=this.options.loose?Ts[As.COMPARATORLOOSE]:Ts[As.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new xs(s[2],this.options.loose):this.semver=ys}toString(){return this.value}test(e){if(bs("Comparator.test",e,this.options.loose),this.semver===ys||e===ys)return!0;if("string"==typeof e)try{e=new xs(e,this.options)}catch(e){return!1}return Ns(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof Ls))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new Cs(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new Cs(this.value,t).test(e.semver);const s=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),r=this.semver.version===e.semver.version,n=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=Ns(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),a=Ns(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return s||i||r&&n||o||a}}var Ss=Ls;const Os=ve,{re:Ts,t:As}=de.exports,Ns=bt,bs=ge,xs=be,Cs=Jt,ks=Jt;var zs=(e,t,s)=>{try{t=new ks(t,s)}catch(e){return!1}return t.test(e)};const Ps=Jt;var Ms=(e,t)=>new Ps(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));const _s=be,Ds=Jt;var js=(e,t,s)=>{let i=null,r=null,n=null;try{n=new Ds(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(i&&-1!==r.compare(e)||(i=e,r=new _s(i,s)))})),i};const Fs=be,Gs=Jt;var Us=(e,t,s)=>{let i=null,r=null,n=null;try{n=new Gs(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(i&&1!==r.compare(e)||(i=e,r=new Fs(i,s)))})),i};const Xs=be,Bs=Jt,Hs=mt;var Vs=(e,t)=>{e=new Bs(e,t);let s=new Xs("0.0.0");if(e.test(s))return s;if(s=new Xs("0.0.0-0"),e.test(s))return s;s=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let r=null;i.forEach((e=>{const t=new Xs(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":r&&!Hs(t,r)||(r=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!r||s&&!Hs(s,r)||(s=r)}return s&&e.test(s)?s:null};const Ws=Jt;var Ys=(e,t)=>{try{return new Ws(e,t).range||"*"}catch(e){return null}};const qs=be,Zs=Ss,{ANY:Js}=Zs,Qs=Jt,Ks=zs,ei=mt,ti=Et,si=yt,ii=wt;var ri=(e,t,s,i)=>{let r,n,o,a,h;switch(e=new qs(e,i),t=new Qs(t,i),s){case">":r=ei,n=si,o=ti,a=">",h=">=";break;case"<":r=ti,n=ii,o=ei,a="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Ks(e,t,i))return!1;for(let s=0;s<t.set.length;++s){const l=t.set[s];let c=null,p=null;if(l.forEach((e=>{e.semver===Js&&(e=new Zs(">=0.0.0")),c=c||e,p=p||e,r(e.semver,c.semver,i)?c=e:o(e.semver,p.semver,i)&&(p=e)})),c.operator===a||c.operator===h)return!1;if((!p.operator||p.operator===a)&&n(e,p.semver))return!1;if(p.operator===h&&o(e,p.semver))return!1}return!0};const ni=ri;var oi=(e,t,s)=>ni(e,t,">",s);const ai=ri;var hi=(e,t,s)=>ai(e,t,"<",s);const li=Jt;var ci=(e,t,s)=>(e=new li(e,s),t=new li(t,s),e.intersects(t));const pi=zs,ui=Be;const fi=Jt,di=Ss,{ANY:mi}=di,gi=zs,Ei=Be,vi=(e,t,s)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===mi){if(1===t.length&&t[0].semver===mi)return!0;e=s.includePrerelease?[new di(">=0.0.0-0")]:[new di(">=0.0.0")]}if(1===t.length&&t[0].semver===mi){if(s.includePrerelease)return!0;t=[new di(">=0.0.0")]}const i=new Set;let r,n,o,a,h,l,c;for(const t of e)">"===t.operator||">="===t.operator?r=$i(r,t,s):"<"===t.operator||"<="===t.operator?n=Ii(n,t,s):i.add(t.semver);if(i.size>1)return null;if(r&&n){if(o=Ei(r.semver,n.semver,s),o>0)return null;if(0===o&&(">="!==r.operator||"<="!==n.operator))return null}for(const e of i){if(r&&!gi(e,String(r),s))return null;if(n&&!gi(e,String(n),s))return null;for(const i of t)if(!gi(e,String(i),s))return!1;return!0}let p=!(!n||s.includePrerelease||!n.semver.prerelease.length)&&n.semver,u=!(!r||s.includePrerelease||!r.semver.prerelease.length)&&r.semver;p&&1===p.prerelease.length&&"<"===n.operator&&0===p.prerelease[0]&&(p=!1);for(const e of t){if(c=c||">"===e.operator||">="===e.operator,l=l||"<"===e.operator||"<="===e.operator,r)if(u&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===u.major&&e.semver.minor===u.minor&&e.semver.patch===u.patch&&(u=!1),">"===e.operator||">="===e.operator){if(a=$i(r,e,s),a===e&&a!==r)return!1}else if(">="===r.operator&&!gi(r.semver,String(e),s))return!1;if(n)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),"<"===e.operator||"<="===e.operator){if(h=Ii(n,e,s),h===e&&h!==n)return!1}else if("<="===n.operator&&!gi(n.semver,String(e),s))return!1;if(!e.operator&&(n||r)&&0!==o)return!1}return!(r&&l&&!n&&0!==o)&&(!(n&&c&&!r&&0!==o)&&(!u&&!p))},$i=(e,t,s)=>{if(!e)return t;const i=Ei(e.semver,t.semver,s);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},Ii=(e,t,s)=>{if(!e)return t;const i=Ei(e.semver,t.semver,s);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};var wi=(e,t,s={})=>{if(e===t)return!0;e=new fi(e,s),t=new fi(t,s);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=vi(r,e,s);if(i=i||null!==t,t)continue e}if(i)return!1}return!0};const Ri=de.exports;var yi={re:Ri.re,src:Ri.src,tokens:Ri.t,SEMVER_SPEC_VERSION:me.SEMVER_SPEC_VERSION,SemVer:be,compareIdentifiers:we.compareIdentifiers,rcompareIdentifiers:we.rcompareIdentifiers,parse:Me,valid:De,clean:Fe,inc:Ue,diff:qe,major:Je,minor:Ke,patch:tt,prerelease:it,compare:Be,rcompare:nt,compareLoose:at,compareBuild:lt,sort:pt,rsort:ft,gt:mt,lt:Et,eq:Ve,neq:$t,gte:wt,lte:yt,cmp:bt,coerce:Pt,Comparator:Ss,Range:Jt,satisfies:zs,toComparators:Ms,maxSatisfying:js,minSatisfying:Us,minVersion:Vs,validRange:Ys,outside:ri,gtr:oi,ltr:hi,intersects:ci,simplifyRange:(e,t,s)=>{const i=[];let r=null,n=null;const o=e.sort(((e,t)=>ui(e,t,s)));for(const e of o){pi(e,t,s)?(n=e,r||(r=e)):(n&&i.push([r,n]),n=null,r=null)}r&&i.push([r,null]);const a=[];for(const[e,t]of i)e===t?a.push(e):t||e!==o[0]?t?e===o[0]?a.push(`<=${t}`):a.push(`${e} - ${t}`):a.push(`>=${e}`):a.push("*");const h=a.join(" || "),l="string"==typeof t.raw?t.raw:String(t);return h.length<l.length?h:t},subset:wi};class Li{constructor(){this.tasks=[],this.isDownloading=!1,this.__downLoadFinnishCallBack=()=>0}downLoadFinnishCallBack(e){this.__downLoadFinnishCallBack=e}addTask(e){if("function"!=typeof e.task)throw new TypeError("Task must be a function!");this.tasks.push(e),this.isDownloading||(this.isDownloading=!0,this.download())}downAndungzip(t,s,i,r){return new Promise(((o,h)=>{const l=`${i}.tmp`;if(c(i)&&ne(n(i))===t)o(!0);else{const n=e("sha256"),c=m(),u=a(l);r(s).then((e=>{e.pipe(c)}),(e=>{h(e)})),c.on("error",(e=>{c.close(),u.close(),n.destroy(),h(e)})),c.on("data",(e=>{n.write(e),u.write(e)})),c.on("end",(()=>{n.digest("hex")!==t?(n.destroy(),h(new Error("下载文件出错"))):(u.on("finish",(()=>{p(l,i,(e=>{e?h(e):o(!0)}))})),u.end())}))}}))}download(){const e=this.tasks.shift();e?e.task().then((()=>{e.finnishCallBack(!0),this.download()})).catch((t=>{e.finnishCallBack(!1,t)})):(this.__downLoadFinnishCallBack(),this.isDownloading=!1)}}class Si{constructor(e,t,s,i,r,n,o,a,h,l={files:{}}){this.statusCallback=e,this.updaterName=t,this.version=s,this.exePath=i,this.tempDirectory=r,this.updateConfigName=n,this.updateJson=o,this.baseUrl=a,this.downloadFn=h,this.options=l,this.downloadQueue=new Li,this.__diffResult=void 0}checkForUpdates(){return E(this,void 0,void 0,(function*(){try{if(c(this.tempDirectory)||u(this.tempDirectory),yi.gt(this.updateJson.version,this.version)){const e=ae(i(this.exePath),this.options);he(e);const t=le(e,this.updateJson.hash);return f(s(this.tempDirectory,this.updateConfigName+".json"),JSON.stringify(t,null,2)),t&&t.added.concat(t.changed).length>0&&(this.__diffResult=Object.freeze(t)),t.added.concat(t.changed).length}return 0}catch(e){return this.statusCallback({message:e,status:"failed"}),0}}))}downloadUpdate(){return E(this,void 0,void 0,(function*(){if(!this.__diffResult)return this.statusCallback({message:"程序无须更新",status:"failed"}),!1;try{c(this.tempDirectory)||u(this.tempDirectory),this.baseUrl.endsWith("/")||(this.baseUrl+="/");return new Promise(((e,t)=>{this.downloadQueue.downLoadFinnishCallBack((()=>{e(!0)})),this.__diffResult.added.concat(this.__diffResult.changed).forEach((e=>{const t=`${this.baseUrl}${e.hash}.gz`;this.downloadQueue.addTask({task:()=>this.downloadQueue.downAndungzip(e.hash,t,s(this.tempDirectory,e.hash),this.downloadFn),finnishCallBack:e=>{}})}))}))}catch(e){return this.statusCallback({message:e,status:"failed"}),!1}}))}install(e=!1){return E(this,void 0,void 0,(function*(){try{let t=!0;if(e)t=e;else{if(yield this.validateDiffPackageIntegrity())return this.statusCallback({message:"Installation check difference failed",status:"failed"}),!1}if(t){g(this.updaterName,{detached:!0,env:{exe_path:this.exePath,update_temp_path:this.tempDirectory,update_config_file_name:this.updateConfigName+".json",exe_pid:process.pid.toString()},stdio:"ignore"});return!0}return!1}catch(e){this.statusCallback({message:e,status:"failed"})}}))}validateDiffPackageIntegrity(){return E(this,void 0,void 0,(function*(){if(this.__diffResult){for(const e of this.__diffResult.changed){const t=`${this.tempDirectory}/${e.hash}`;if(!(yield fe(t,e.hash)))return!0}for(const e of this.__diffResult.added){const t=`${this.tempDirectory}/${e.hash}`;if(!(yield fe(t,e.hash)))return!0}}return!1}))}}export{se as DiffVersionHashResult,te as DiffVersionHashResultItem,K as HashedFile,ee as HashedFolder,Si as UpdateElectron,ie as UpdateInfo,re as UpdateStatus,fe as checkFileExitAndHash,le as diffVersionHash,pe as gzip,he as handleHashedFolderChildrenToObject,ne as hash256,ae as hashElement,ce as pushdiffVersionHashResult,oe as reduceGlobPatterns,ue as zipHashElement};
