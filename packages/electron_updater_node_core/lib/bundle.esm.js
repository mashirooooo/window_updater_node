import{createHash as e}from"crypto";import{basename as t,join as r,dirname as n}from"path";import{statSync as s,readFileSync as i,readdirSync as o,createWriteStream as a,createReadStream as h,existsSync as c,writeFileSync as l,mkdirSync as p}from"fs";import{createGzip as u,createGunzip as E}from"zlib";import{spawn as f}from"child_process";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var d=function(e,t){return d=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},d(e,t)};function g(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{h(n.next(e))}catch(e){i(e)}}function a(e){try{h(n.throw(e))}catch(e){i(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))}function I(e,t){var r,n,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var m="object"==typeof process&&process&&"win32"===process.platform?{sep:"\\"}:{sep:"/"},R=N;function N(e,t,r){e instanceof RegExp&&(e=O(e,r)),t instanceof RegExp&&(t=O(t,r));var n=b(e,t,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+e.length,n[1]),post:r.slice(n[1]+t.length)}}function O(e,t){var r=t.match(e);return r?r[0]:null}function b(e,t,r){var n,s,i,o,a,h=r.indexOf(e),c=r.indexOf(t,h+1),l=h;if(h>=0&&c>0){if(e===t)return[h,c];for(n=[],i=r.length;l>=0&&!a;)l==h?(n.push(l),h=r.indexOf(e,l+1)):1==n.length?a=[n.pop(),c]:((s=n.pop())<i&&(i=s,o=c),c=r.indexOf(t,l+1)),l=h<c&&h>=0?h:c;n.length&&(a=[i,o])}return a}N.range=b;var L=R,A=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return G(function(e){return e.split("\\\\").join($).split("\\{").join(v).split("\\}").join(T).split("\\,").join(S).split("\\.").join(y)}(e),!0).map(P)},$="\0SLASH"+Math.random()+"\0",v="\0OPEN"+Math.random()+"\0",T="\0CLOSE"+Math.random()+"\0",S="\0COMMA"+Math.random()+"\0",y="\0PERIOD"+Math.random()+"\0";function w(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function P(e){return e.split($).join("\\").split(v).join("{").split(T).join("}").split(S).join(",").split(y).join(".")}function D(e){if(!e)return[""];var t=[],r=L("{","}",e);if(!r)return e.split(",");var n=r.pre,s=r.body,i=r.post,o=n.split(",");o[o.length-1]+="{"+s+"}";var a=D(i);return i.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function j(e){return"{"+e+"}"}function M(e){return/^-?0\d/.test(e)}function x(e,t){return e<=t}function F(e,t){return e>=t}function G(e,t){var r=[],n=L("{","}",e);if(!n)return[e];var s=n.pre,i=n.post.length?G(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<i.length;o++){var a=s+"{"+n.body+"}"+i[o];r.push(a)}else{var h,c,l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),u=l||p,E=n.body.indexOf(",")>=0;if(!u&&!E)return n.post.match(/,.*\}/)?G(e=n.pre+"{"+n.body+T+n.post):[e];if(u)h=n.body.split(/\.\./);else if(1===(h=D(n.body)).length&&1===(h=G(h[0],!1).map(j)).length)return i.map((function(e){return n.pre+h[0]+e}));if(u){var f=w(h[0]),d=w(h[1]),g=Math.max(h[0].length,h[1].length),I=3==h.length?Math.abs(w(h[2])):1,m=x;d<f&&(I*=-1,m=F);var R=h.some(M);c=[];for(var N=f;m(N,d);N+=I){var O;if(p)"\\"===(O=String.fromCharCode(N))&&(O="");else if(O=String(N),R){var b=g-O.length;if(b>0){var A=new Array(b+1).join("0");O=N<0?"-"+A+O.slice(1):A+O}}c.push(O)}}else{c=[];for(var $=0;$<h.length;$++)c.push.apply(c,G(h[$],!1))}for($=0;$<c.length;$++)for(o=0;o<i.length;o++){a=s+c[$]+i[o];(!t||u||a)&&r.push(a)}}return r}const C=_=(e,t,r={})=>(W(t),!(!r.nocomment&&"#"===t.charAt(0))&&new K(t,r).match(e));var _=C;const U=m;C.sep=U.sep;const X=Symbol("globstar **");C.GLOBSTAR=X;const k=A,B={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},H=e=>e.split("").reduce(((e,t)=>(e[t]=!0,e)),{}),V=H("().*{}+?[]^$\\!"),z=H("[.("),Z=/\/+/;C.filter=(e,t={})=>(r,n,s)=>C(r,e,t);const Y=(e,t={})=>{const r={};return Object.keys(e).forEach((t=>r[t]=e[t])),Object.keys(t).forEach((e=>r[e]=t[e])),r};C.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return C;const t=C,r=(r,n,s)=>t(r,n,Y(e,s));return(r.Minimatch=class extends t.Minimatch{constructor(t,r){super(t,Y(e,r))}}).defaults=r=>t.defaults(Y(e,r)).Minimatch,r.filter=(r,n)=>t.filter(r,Y(e,n)),r.defaults=r=>t.defaults(Y(e,r)),r.makeRe=(r,n)=>t.makeRe(r,Y(e,n)),r.braceExpand=(r,n)=>t.braceExpand(r,Y(e,n)),r.match=(r,n,s)=>t.match(r,n,Y(e,s)),r},C.braceExpand=(e,t)=>J(e,t);const J=(e,t={})=>(W(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:k(e)),W=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},q=Symbol("subparse");C.makeRe=(e,t)=>new K(e,t||{}).makeRe(),C.match=(e,t,r={})=>{const n=new K(t,r);return e=e.filter((e=>n.match(e))),n.options.nonull&&!e.length&&e.push(t),e};class K{constructor(e,t){W(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();let r=this.globSet=this.braceExpand();t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,r),r=this.globParts=r.map((e=>e.split(Z))),this.debug(this.pattern,r),r=r.map(((e,t,r)=>e.map(this.parse,this))),this.debug(this.pattern,r),r=r.filter((e=>-1===e.indexOf(!1))),this.debug(this.pattern,r),this.set=r}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let t=!1,r=0;for(let n=0;n<e.length&&"!"===e.charAt(n);n++)t=!t,r++;r&&(this.pattern=e.substr(r)),this.negate=t}matchOne(e,t,r){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,i=0,o=e.length,a=t.length;s<o&&i<a;s++,i++){this.debug("matchOne loop");var h,c=t[i],l=e[s];if(this.debug(t,c,l),!1===c)return!1;if(c===X){this.debug("GLOBSTAR",[t,c,l]);var p=s,u=i+1;if(u===a){for(this.debug("** at the end");s<o;s++)if("."===e[s]||".."===e[s]||!n.dot&&"."===e[s].charAt(0))return!1;return!0}for(;p<o;){var E=e[p];if(this.debug("\nglobstar while",e,p,t,u,E),this.matchOne(e.slice(p),t.slice(u),r))return this.debug("globstar found match!",p,o,E),!0;if("."===E||".."===E||!n.dot&&"."===E.charAt(0)){this.debug("dot detected!",e,p,t,u);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!r||(this.debug("\n>>> no match, partial?",e,p,t,u),p!==o))}if("string"==typeof c?(h=l===c,this.debug("string match",c,l,h)):(h=l.match(c),this.debug("pattern match",c,l,h)),!h)return!1}if(s===o&&i===a)return!0;if(s===o)return r;if(i===a)return s===o-1&&""===e[s];throw new Error("wtf?")}braceExpand(){return J(this.pattern,this.options)}parse(e,t){W(e);const r=this.options;if("**"===e){if(!r.noglobstar)return X;e="*"}if(""===e)return"";let n="",s=!!r.nocase,i=!1;const o=[],a=[];let h,c,l,p,u=!1,E=-1,f=-1;const d="."===e.charAt(0)?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=()=>{if(h){switch(h){case"*":n+="[^/]*?",s=!0;break;case"?":n+="[^/]",s=!0;break;default:n+="\\"+h}this.debug("clearStateChar %j %j",h,n),h=!1}};for(let t,d=0;d<e.length&&(t=e.charAt(d));d++)if(this.debug("%s\t%s %s %j",e,d,n,t),i){if("/"===t)return!1;V[t]&&(n+="\\"),n+=t,i=!1}else switch(t){case"/":return!1;case"\\":g(),i=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,d,n,t),u){this.debug("  in class"),"!"===t&&d===f+1&&(t="^"),n+=t;continue}this.debug("call clearStateChar %j",h),g(),h=t,r.noext&&g();continue;case"(":if(u){n+="(";continue}if(!h){n+="\\(";continue}o.push({type:h,start:d-1,reStart:n.length,open:B[h].open,close:B[h].close}),n+="!"===h?"(?:(?!(?:":"(?:",this.debug("plType %j %j",h,n),h=!1;continue;case")":if(u||!o.length){n+="\\)";continue}g(),s=!0,l=o.pop(),n+=l.close,"!"===l.type&&a.push(l),l.reEnd=n.length;continue;case"|":if(u||!o.length){n+="\\|";continue}g(),n+="|";continue;case"[":if(g(),u){n+="\\"+t;continue}u=!0,f=d,E=n.length,n+=t;continue;case"]":if(d===f+1||!u){n+="\\"+t;continue}c=e.substring(f+1,d);try{RegExp("["+c+"]")}catch(e){p=this.parse(c,q),n=n.substr(0,E)+"\\["+p[0]+"\\]",s=s||p[1],u=!1;continue}s=!0,u=!1,n+=t;continue;default:g(),!V[t]||"^"===t&&u||(n+="\\"),n+=t}for(u&&(c=e.substr(f+1),p=this.parse(c,q),n=n.substr(0,E)+"\\["+p[0],s=s||p[1]),l=o.pop();l;l=o.pop()){let e;e=n.slice(l.reStart+l.open.length),this.debug("setting tail",n,l),e=e.replace(/((?:\\{2}){0,64})(\\?)\|/g,((e,t,r)=>(r||(r="\\"),t+t+r+"|"))),this.debug("tail=%j\n   %s",e,e,l,n);const t="*"===l.type?"[^/]*?":"?"===l.type?"[^/]":"\\"+l.type;s=!0,n=n.slice(0,l.reStart)+t+"\\("+e}g(),i&&(n+="\\\\");const I=z[n.charAt(0)];for(let e=a.length-1;e>-1;e--){const r=a[e],s=n.slice(0,r.reStart),i=n.slice(r.reStart,r.reEnd-8);let o=n.slice(r.reEnd);const h=n.slice(r.reEnd-8,r.reEnd)+o,c=s.split("(").length-1;let l=o;for(let e=0;e<c;e++)l=l.replace(/\)[+*?]?/,"");o=l;n=s+i+o+(""===o&&t!==q?"$":"")+h}if(""!==n&&s&&(n="(?=.)"+n),I&&(n=d+n),t===q)return[n,s];if(!s)return e.replace(/\\(.)/g,"$1");const m=r.nocase?"i":"";try{return Object.assign(new RegExp("^"+n+"$",m),{_glob:e,_src:n})}catch(e){return new RegExp("$.")}}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,r=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",n=t.nocase?"i":"";let s=e.map((e=>(e=e.map((e=>"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===X?X:e._src)).reduce(((e,t)=>(e[e.length-1]===X&&t===X||e.push(t),e)),[]),e.forEach(((t,n)=>{t===X&&e[n-1]!==X&&(0===n?e.length>1?e[n+1]="(?:\\/|"+r+"\\/)?"+e[n+1]:e[n]=r:n===e.length-1?e[n-1]+="(?:\\/|"+r+")?":(e[n-1]+="(?:\\/|\\/"+r+"\\/)"+e[n+1],e[n+1]=X))})),e.filter((e=>e!==X)).join("/")))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,n)}catch(e){this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const r=this.options;"/"!==U.sep&&(e=e.split(U.sep).join("/")),e=e.split(Z),this.debug(this.pattern,"split",e);const n=this.set;let s;this.debug(this.pattern,"set",n);for(let t=e.length-1;t>=0&&(s=e[t],!s);t--);for(let i=0;i<n.length;i++){const o=n[i];let a=e;r.matchBase&&1===o.length&&(a=[s]);if(this.matchOne(a,o,t))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate}static defaults(e){return C.defaults(e).Minimatch}}C.Minimatch=K;var Q,ee=function(){},te=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}d(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}(ee),re=function(){},ne=function(){this.added=[],this.changed=[]},se=function(){this.status="init",this.message=""};!function(e){e[e.HaveNothingUpdate=0]="HaveNothingUpdate",e[e.Success=1]="Success",e[e.Failed=2]="Failed"}(Q||(Q={}));var ie="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var oe={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16},ae={exports:{}};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r}=oe,n=ie,s=(t=e.exports={}).re=[],i=t.src=[],o=t.t={};let a=0;const h=(e,t,r)=>{const h=a++;n(e,h,t),o[e]=h,i[h]=t,s[h]=new RegExp(t,r?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","[0-9]+"),h("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),h("MAINVERSION",`(${i[o.NUMERICIDENTIFIER]})\\.(${i[o.NUMERICIDENTIFIER]})\\.(${i[o.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${i[o.NUMERICIDENTIFIERLOOSE]})\\.(${i[o.NUMERICIDENTIFIERLOOSE]})\\.(${i[o.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${i[o.NUMERICIDENTIFIER]}|${i[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${i[o.NUMERICIDENTIFIERLOOSE]}|${i[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${i[o.PRERELEASEIDENTIFIER]}(?:\\.${i[o.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${i[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[o.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER","[0-9A-Za-z-]+"),h("BUILD",`(?:\\+(${i[o.BUILDIDENTIFIER]}(?:\\.${i[o.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${i[o.MAINVERSION]}${i[o.PRERELEASE]}?${i[o.BUILD]}?`),h("FULL",`^${i[o.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${i[o.MAINVERSIONLOOSE]}${i[o.PRERELEASELOOSE]}?${i[o.BUILD]}?`),h("LOOSE",`^${i[o.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${i[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${i[o.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${i[o.XRANGEIDENTIFIER]})(?:\\.(${i[o.XRANGEIDENTIFIER]})(?:\\.(${i[o.XRANGEIDENTIFIER]})(?:${i[o.PRERELEASE]})?${i[o.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${i[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[o.XRANGEIDENTIFIERLOOSE]})(?:${i[o.PRERELEASELOOSE]})?${i[o.BUILD]}?)?)?`),h("XRANGE",`^${i[o.GTLT]}\\s*${i[o.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${i[o.GTLT]}\\s*${i[o.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),h("COERCERTL",i[o.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${i[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${i[o.LONETILDE]}${i[o.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${i[o.LONETILDE]}${i[o.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${i[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${i[o.LONECARET]}${i[o.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${i[o.LONECARET]}${i[o.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${i[o.GTLT]}\\s*(${i[o.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${i[o.GTLT]}\\s*(${i[o.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${i[o.GTLT]}\\s*(${i[o.LOOSEPLAIN]}|${i[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${i[o.XRANGEPLAIN]})\\s+-\\s+(${i[o.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${i[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[o.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(ae,ae.exports);const he=["includePrerelease","loose","rtl"];var ce=e=>e?"object"!=typeof e?{loose:!0}:he.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const le=/^[0-9]+$/,pe=(e,t)=>{const r=le.test(e),n=le.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};var ue={compareIdentifiers:pe,rcompareIdentifiers:(e,t)=>pe(t,e)};const Ee=ie,{MAX_LENGTH:fe,MAX_SAFE_INTEGER:de}=oe,{re:ge,t:Ie}=ae.exports,me=ce,{compareIdentifiers:Re}=ue;class Ne{constructor(e,t){if(t=me(t),e instanceof Ne){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>fe)throw new TypeError(`version is longer than ${fe} characters`);Ee("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?ge[Ie.LOOSE]:ge[Ie.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>de||this.major<0)throw new TypeError("Invalid major version");if(this.minor>de||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>de||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<de)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(Ee("SemVer.compare",this.version,this.options,e),!(e instanceof Ne)){if("string"==typeof e&&e===this.version)return 0;e=new Ne(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ne||(e=new Ne(e,this.options)),Re(this.major,e.major)||Re(this.minor,e.minor)||Re(this.patch,e.patch)}comparePre(e){if(e instanceof Ne||(e=new Ne(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(Ee("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return Re(r,n)}while(++t)}compareBuild(e){e instanceof Ne||(e=new Ne(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(Ee("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return Re(r,n)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}const Oe=Ne;const be=(e,t,r)=>new Oe(e,r).compare(new Oe(t,r));var Le=(e,t,r)=>be(e,t,r)>0;function Ae(t){return e("sha256").update(t).digest("hex")}function $e(e,t){return"function"==typeof e?e(t):!(!e||!Array.isArray(e)||0===e.length)&&new RegExp(e.reduce((function(e,t){return e+"|"+_.makeRe(t).source}),"").substring(1)).test(t)}function ve(e,n){var a,h;void 0===n&&(n={});var c,l=s(e),p=t(e);return l.isFile()?$e(null===(a=null==n?void 0:n.files)||void 0===a?void 0:a.exclude,p)?null:((c=new ee).name=p,c.hash=Ae(i(e)),c):l.isDirectory()?$e(null===(h=null==n?void 0:n.folders)||void 0===h?void 0:h.exclude,p)?null:((c=new te).name=p,c.children=o(e).map((function(t){return ve(r(e,t),n)})).filter((function(e){return null!==e})),c.hash=Ae(c.children.map((function(e){return e.hash})).join("")),c):null}function Te(e){e&&e.children&&(e.childrenObject=e.children.reduce((function(e,t){return t.children&&Te(t),e[t.name]=t,e}),{}))}function Se(e,t,r,n){return void 0===r&&(r=new ne),void 0===n&&(n="."),t.hash===e.hash||(t.children?t.children.forEach((function(t){t=t,e.childrenObject&&e.childrenObject[t.name]?Se(e.childrenObject[t.name],t,r,n+"/"+t.name):ye(t,n+"/"+t.name,r.added)})):r.changed.push({filePath:n,hash:t.hash})),r}function ye(e,t,r){e.children?e.children.forEach((function(e){ye(e,t+"/"+e.name,r)})):r.push({filePath:t,hash:e.hash})}function we(e,t){return new Promise((function(r,n){var s=u(),i=a(t),o=h(e);o.on("close",r),o.on("error",n),i.on("error",n),o.pipe(s).pipe(i)}))}function Pe(e,t,n,s){return void 0===s&&(s=!1),g(this,void 0,void 0,(function(){var i;return I(this,(function(o){switch(o.label){case 0:if(!e.children)return[3,5];i=0,o.label=1;case 1:return i<e.children.length?[4,Pe(e.children[i],t+(s?"":"/"+e.name),n)]:[3,4];case 2:o.sent(),o.label=3;case 3:return i++,[3,1];case 4:return[3,7];case 5:return[4,we(t+"/"+e.name,r(n,e.hash+".gz"))];case 6:o.sent(),o.label=7;case 7:return[2]}}))}))}function De(e,t,s,i,o,a,h,u,E,d){return void 0===d&&(d={files:{}}),g(this,void 0,void 0,(function(){var g,m,R,N,O,b;return I(this,(function(I){switch(I.label){case 0:g=n(i),m=new se,c(o)||p(o),R=process.noAsar,I.label=1;case 1:return I.trys.push([1,6,,7]),Le(h.version,s)?(m.status="downloading",process.noAsar=!0,Te(N=ve(g,d)),O=Se(N,h.hash),l(r(o,a+".json"),JSON.stringify(O,null,2)),console.log(O),e(m),u.endsWith("/")||(u+="/"),[4,Promise.all(O.changed.map((function(e){return je(e.hash,"".concat(u).concat(e.hash,".gz"),r(o,e.hash),E)})))]):[3,4];case 2:return I.sent(),[4,Promise.all(O.added.map((function(e){return je(e.hash,"".concat(u).concat(e.hash,".gz"),r(o,e.hash),E)})))];case 3:return I.sent(),process.noAsar=R,console.log("complete"),m.status="finished",e(m),f(t,{detached:!0,env:{exe_path:i,update_temp_path:o,update_config_file_name:a+".json",exe_pid:process.pid.toString()},stdio:"ignore"}),[2,Q.Success];case 4:return[2,Q.HaveNothingUpdate];case 5:return[3,7];case 6:return b=I.sent(),process.noAsar=R,console.log(b),m.status="failed",m.message=b,e(m),[2,Q.Failed];case 7:return[2]}}))}))}function je(t,r,n,s){return new Promise((function(o,h){if(c(n)&&Ae(i(n))===t)o(!0);else{var l=e("sha256"),p=E(),u=a(n);s(r).then((function(e){e.pipe(p)}),(function(e){h(e)})),p.on("error",(function(e){p.close(),u.close(),l.destroy(),h(e)})),p.on("data",(function(e){l.write(e),u.write(e)})),p.on("end",(function(){l.digest("hex")!==t?(l.destroy(),h(new Error("下载文件出错"))):o(!0)}))}}))}export{ne as DiffVersionHashResult,re as DiffVersionHashResultItem,ee as HashedFile,te as HashedFolder,se as UpdateInfo,Q as UpdateStatus,Se as diffVersionHash,we as gzip,Te as handleHashedFolderChildrenToObject,Ae as hash256,ve as hashElement,ye as pushdiffVersionHashResult,$e as reduceGlobPatterns,De as updateElectron,Pe as zipHashElement};
