import{createHash as e}from"crypto";import{basename as t,join as s,dirname as i}from"path";import{statSync as r,readFileSync as n,readdirSync as o,createWriteStream as a,createReadStream as h,existsSync as l,mkdirSync as c,writeFileSync as p,stat as u,rename as d}from"fs";import{createGzip as f,createGunzip as m}from"zlib";import{spawn as g}from"child_process";
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function E(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{h(i.next(e))}catch(e){n(e)}}function a(e){try{h(i.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}h((i=i.apply(e,t||[])).next())}))}var v="object"==typeof process&&process&&"win32"===process.platform?{sep:"\\"}:{sep:"/"},$=w;function w(e,t,s){e instanceof RegExp&&(e=R(e,s)),t instanceof RegExp&&(t=R(t,s));var i=I(e,t,s);return i&&{start:i[0],end:i[1],pre:s.slice(0,i[0]),body:s.slice(i[0]+e.length,i[1]),post:s.slice(i[1]+t.length)}}function R(e,t){var s=t.match(e);return s?s[0]:null}function I(e,t,s){var i,r,n,o,a,h=s.indexOf(e),l=s.indexOf(t,h+1),c=h;if(h>=0&&l>0){if(e===t)return[h,l];for(i=[],n=s.length;c>=0&&!a;)c==h?(i.push(c),h=s.indexOf(e,c+1)):1==i.length?a=[i.pop(),l]:((r=i.pop())<n&&(n=r,o=l),l=s.indexOf(t,c+1)),c=h<l&&h>=0?h:l;i.length&&(a=[n,o])}return a}w.range=I;var y=$,L=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return M(function(e){return e.split("\\\\").join(S).split("\\{").join(A).split("\\}").join(O).split("\\,").join(T).split("\\.").join(N)}(e),!0).map(x)},S="\0SLASH"+Math.random()+"\0",A="\0OPEN"+Math.random()+"\0",O="\0CLOSE"+Math.random()+"\0",T="\0COMMA"+Math.random()+"\0",N="\0PERIOD"+Math.random()+"\0";function b(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function x(e){return e.split(S).join("\\").split(A).join("{").split(O).join("}").split(T).join(",").split(N).join(".")}function C(e){if(!e)return[""];var t=[],s=y("{","}",e);if(!s)return e.split(",");var i=s.pre,r=s.body,n=s.post,o=i.split(",");o[o.length-1]+="{"+r+"}";var a=C(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function k(e){return"{"+e+"}"}function _(e){return/^-?0\d/.test(e)}function z(e,t){return e<=t}function P(e,t){return e>=t}function M(e,t){var s=[],i=y("{","}",e);if(!i)return[e];var r=i.pre,n=i.post.length?M(i.post,!1):[""];if(/\$$/.test(i.pre))for(var o=0;o<n.length;o++){var a=r+"{"+i.body+"}"+n[o];s.push(a)}else{var h,l,c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),u=c||p,d=i.body.indexOf(",")>=0;if(!u&&!d)return i.post.match(/,.*\}/)?M(e=i.pre+"{"+i.body+O+i.post):[e];if(u)h=i.body.split(/\.\./);else if(1===(h=C(i.body)).length&&1===(h=M(h[0],!1).map(k)).length)return n.map((function(e){return i.pre+h[0]+e}));if(u){var f=b(h[0]),m=b(h[1]),g=Math.max(h[0].length,h[1].length),E=3==h.length?Math.abs(b(h[2])):1,v=z;m<f&&(E*=-1,v=P);var $=h.some(_);l=[];for(var w=f;v(w,m);w+=E){var R;if(p)"\\"===(R=String.fromCharCode(w))&&(R="");else if(R=String(w),$){var I=g-R.length;if(I>0){var L=new Array(I+1).join("0");R=w<0?"-"+L+R.slice(1):L+R}}l.push(R)}}else{l=[];for(var S=0;S<h.length;S++)l.push.apply(l,M(h[S],!1))}for(S=0;S<l.length;S++)for(o=0;o<n.length;o++){a=r+l[S]+n[o];(!t||u||a)&&s.push(a)}}return s}const D=j=(e,t,s={})=>(J(t),!(!s.nocomment&&"#"===t.charAt(0))&&new Q(t,s).match(e));var j=D;const F=v;D.sep=F.sep;const G=Symbol("globstar **");D.GLOBSTAR=G;const U=L,X={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},B=e=>e.split("").reduce(((e,t)=>(e[t]=!0,e)),{}),H=B("().*{}+?[]^$\\!"),V=B("[.("),W=/\/+/;D.filter=(e,t={})=>(s,i,r)=>D(s,e,t);const Y=(e,t={})=>{const s={};return Object.keys(e).forEach((t=>s[t]=e[t])),Object.keys(t).forEach((e=>s[e]=t[e])),s};D.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return D;const t=D,s=(s,i,r)=>t(s,i,Y(e,r));return(s.Minimatch=class extends t.Minimatch{constructor(t,s){super(t,Y(e,s))}}).defaults=s=>t.defaults(Y(e,s)).Minimatch,s.filter=(s,i)=>t.filter(s,Y(e,i)),s.defaults=s=>t.defaults(Y(e,s)),s.makeRe=(s,i)=>t.makeRe(s,Y(e,i)),s.braceExpand=(s,i)=>t.braceExpand(s,Y(e,i)),s.match=(s,i,r)=>t.match(s,i,Y(e,r)),s},D.braceExpand=(e,t)=>q(e,t);const q=(e,t={})=>(J(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:U(e)),J=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},Z=Symbol("subparse");D.makeRe=(e,t)=>new Q(e,t||{}).makeRe(),D.match=(e,t,s={})=>{const i=new Q(t,s);return e=e.filter((e=>i.match(e))),i.options.nonull&&!e.length&&e.push(t),e};class Q{constructor(e,t){J(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();let s=this.globSet=this.braceExpand();t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,s),s=this.globParts=s.map((e=>e.split(W))),this.debug(this.pattern,s),s=s.map(((e,t,s)=>e.map(this.parse,this))),this.debug(this.pattern,s),s=s.filter((e=>-1===e.indexOf(!1))),this.debug(this.pattern,s),this.set=s}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let i=0;i<e.length&&"!"===e.charAt(i);i++)t=!t,s++;s&&(this.pattern=e.substr(s)),this.negate=t}matchOne(e,t,s){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var r=0,n=0,o=e.length,a=t.length;r<o&&n<a;r++,n++){this.debug("matchOne loop");var h,l=t[n],c=e[r];if(this.debug(t,l,c),!1===l)return!1;if(l===G){this.debug("GLOBSTAR",[t,l,c]);var p=r,u=n+1;if(u===a){for(this.debug("** at the end");r<o;r++)if("."===e[r]||".."===e[r]||!i.dot&&"."===e[r].charAt(0))return!1;return!0}for(;p<o;){var d=e[p];if(this.debug("\nglobstar while",e,p,t,u,d),this.matchOne(e.slice(p),t.slice(u),s))return this.debug("globstar found match!",p,o,d),!0;if("."===d||".."===d||!i.dot&&"."===d.charAt(0)){this.debug("dot detected!",e,p,t,u);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!s||(this.debug("\n>>> no match, partial?",e,p,t,u),p!==o))}if("string"==typeof l?(h=c===l,this.debug("string match",l,c,h)):(h=c.match(l),this.debug("pattern match",l,c,h)),!h)return!1}if(r===o&&n===a)return!0;if(r===o)return s;if(n===a)return r===o-1&&""===e[r];throw new Error("wtf?")}braceExpand(){return q(this.pattern,this.options)}parse(e,t){J(e);const s=this.options;if("**"===e){if(!s.noglobstar)return G;e="*"}if(""===e)return"";let i="",r=!!s.nocase,n=!1;const o=[],a=[];let h,l,c,p,u=!1,d=-1,f=-1;const m="."===e.charAt(0)?"":s.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=()=>{if(h){switch(h){case"*":i+="[^/]*?",r=!0;break;case"?":i+="[^/]",r=!0;break;default:i+="\\"+h}this.debug("clearStateChar %j %j",h,i),h=!1}};for(let t,m=0;m<e.length&&(t=e.charAt(m));m++)if(this.debug("%s\t%s %s %j",e,m,i,t),n){if("/"===t)return!1;H[t]&&(i+="\\"),i+=t,n=!1}else switch(t){case"/":return!1;case"\\":g(),n=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,m,i,t),u){this.debug("  in class"),"!"===t&&m===f+1&&(t="^"),i+=t;continue}this.debug("call clearStateChar %j",h),g(),h=t,s.noext&&g();continue;case"(":if(u){i+="(";continue}if(!h){i+="\\(";continue}o.push({type:h,start:m-1,reStart:i.length,open:X[h].open,close:X[h].close}),i+="!"===h?"(?:(?!(?:":"(?:",this.debug("plType %j %j",h,i),h=!1;continue;case")":if(u||!o.length){i+="\\)";continue}g(),r=!0,c=o.pop(),i+=c.close,"!"===c.type&&a.push(c),c.reEnd=i.length;continue;case"|":if(u||!o.length){i+="\\|";continue}g(),i+="|";continue;case"[":if(g(),u){i+="\\"+t;continue}u=!0,f=m,d=i.length,i+=t;continue;case"]":if(m===f+1||!u){i+="\\"+t;continue}l=e.substring(f+1,m);try{RegExp("["+l+"]")}catch(e){p=this.parse(l,Z),i=i.substr(0,d)+"\\["+p[0]+"\\]",r=r||p[1],u=!1;continue}r=!0,u=!1,i+=t;continue;default:g(),!H[t]||"^"===t&&u||(i+="\\"),i+=t}for(u&&(l=e.substr(f+1),p=this.parse(l,Z),i=i.substr(0,d)+"\\["+p[0],r=r||p[1]),c=o.pop();c;c=o.pop()){let e;e=i.slice(c.reStart+c.open.length),this.debug("setting tail",i,c),e=e.replace(/((?:\\{2}){0,64})(\\?)\|/g,((e,t,s)=>(s||(s="\\"),t+t+s+"|"))),this.debug("tail=%j\n   %s",e,e,c,i);const t="*"===c.type?"[^/]*?":"?"===c.type?"[^/]":"\\"+c.type;r=!0,i=i.slice(0,c.reStart)+t+"\\("+e}g(),n&&(i+="\\\\");const E=V[i.charAt(0)];for(let e=a.length-1;e>-1;e--){const s=a[e],r=i.slice(0,s.reStart),n=i.slice(s.reStart,s.reEnd-8);let o=i.slice(s.reEnd);const h=i.slice(s.reEnd-8,s.reEnd)+o,l=r.split("(").length-1;let c=o;for(let e=0;e<l;e++)c=c.replace(/\)[+*?]?/,"");o=c;i=r+n+o+(""===o&&t!==Z?"$":"")+h}if(""!==i&&r&&(i="(?=.)"+i),E&&(i=m+i),t===Z)return[i,r];if(!r)return e.replace(/\\(.)/g,"$1");const v=s.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",v),{_glob:e,_src:i})}catch(e){return new RegExp("$.")}}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",i=t.nocase?"i":"";let r=e.map((e=>(e=e.map((e=>"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===G?G:e._src)).reduce(((e,t)=>(e[e.length-1]===G&&t===G||e.push(t),e)),[]),e.forEach(((t,i)=>{t===G&&e[i-1]!==G&&(0===i?e.length>1?e[i+1]="(?:\\/|"+s+"\\/)?"+e[i+1]:e[i]=s:i===e.length-1?e[i-1]+="(?:\\/|"+s+")?":(e[i-1]+="(?:\\/|\\/"+s+"\\/)"+e[i+1],e[i+1]=G))})),e.filter((e=>e!==G)).join("/")))).join("|");r="^(?:"+r+")$",this.negate&&(r="^(?!"+r+").*$");try{this.regexp=new RegExp(r,i)}catch(e){this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const s=this.options;"/"!==F.sep&&(e=e.split(F.sep).join("/")),e=e.split(W),this.debug(this.pattern,"split",e);const i=this.set;let r;this.debug(this.pattern,"set",i);for(let t=e.length-1;t>=0&&(r=e[t],!r);t--);for(let n=0;n<i.length;n++){const o=i[n];let a=e;s.matchBase&&1===o.length&&(a=[r]);if(this.matchOne(a,o,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return D.defaults(e).Minimatch}}D.Minimatch=Q;class K{}class ee extends K{}class te{}class se{constructor(){this.added=[],this.changed=[]}}class ie{constructor(){this.status="init",this.message=""}}var re;!function(e){e[e.HaveNothingUpdate=0]="HaveNothingUpdate",e[e.Success=1]="Success",e[e.Failed=2]="Failed"}(re||(re={}));var ne="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var oe={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16},ae={exports:{}};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:s}=oe,i=ne,r=(t=e.exports={}).re=[],n=t.src=[],o=t.t={};let a=0;const h=(e,t,s)=>{const h=a++;i(e,h,t),o[e]=h,n[h]=t,r[h]=new RegExp(t,s?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","[0-9]+"),h("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),h("MAINVERSION",`(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${n[o.NUMERICIDENTIFIER]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${n[o.NUMERICIDENTIFIERLOOSE]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${n[o.PRERELEASEIDENTIFIER]}(?:\\.${n[o.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${n[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[o.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER","[0-9A-Za-z-]+"),h("BUILD",`(?:\\+(${n[o.BUILDIDENTIFIER]}(?:\\.${n[o.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${n[o.MAINVERSION]}${n[o.PRERELEASE]}?${n[o.BUILD]}?`),h("FULL",`^${n[o.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${n[o.MAINVERSIONLOOSE]}${n[o.PRERELEASELOOSE]}?${n[o.BUILD]}?`),h("LOOSE",`^${n[o.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${n[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${n[o.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:${n[o.PRERELEASE]})?${n[o.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:${n[o.PRERELEASELOOSE]})?${n[o.BUILD]}?)?)?`),h("XRANGE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?(?:$|[^\\d])`),h("COERCERTL",n[o.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${n[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${n[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${n[o.LONECARET]}${n[o.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${n[o.LONECARET]}${n[o.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${n[o.GTLT]}\\s*(${n[o.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]}|${n[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${n[o.XRANGEPLAIN]})\\s+-\\s+(${n[o.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${n[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[o.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(ae,ae.exports);const he=["includePrerelease","loose","rtl"];var le=e=>e?"object"!=typeof e?{loose:!0}:he.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const ce=/^[0-9]+$/,pe=(e,t)=>{const s=ce.test(e),i=ce.test(t);return s&&i&&(e=+e,t=+t),e===t?0:s&&!i?-1:i&&!s?1:e<t?-1:1};var ue={compareIdentifiers:pe,rcompareIdentifiers:(e,t)=>pe(t,e)};const de=ne,{MAX_LENGTH:fe,MAX_SAFE_INTEGER:me}=oe,{re:ge,t:Ee}=ae.exports,ve=le,{compareIdentifiers:$e}=ue;class we{constructor(e,t){if(t=ve(t),e instanceof we){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>fe)throw new TypeError(`version is longer than ${fe} characters`);de("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const s=e.trim().match(t.loose?ge[Ee.LOOSE]:ge[Ee.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>me||this.major<0)throw new TypeError("Invalid major version");if(this.minor>me||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>me||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<me)return t}return e})):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(de("SemVer.compare",this.version,this.options,e),!(e instanceof we)){if("string"==typeof e&&e===this.version)return 0;e=new we(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof we||(e=new we(e,this.options)),$e(this.major,e.major)||$e(this.minor,e.minor)||$e(this.patch,e.patch)}comparePre(e){if(e instanceof we||(e=new we(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const s=this.prerelease[t],i=e.prerelease[t];if(de("prerelease compare",t,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return $e(s,i)}while(++t)}compareBuild(e){e instanceof we||(e=new we(e,this.options));let t=0;do{const s=this.build[t],i=e.build[t];if(de("prerelease compare",t,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return $e(s,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var Re=we;const Ie=Re;var ye=(e,t,s)=>new Ie(e,s).compare(new Ie(t,s));const Le=ye;var Se=(e,t,s)=>Le(e,t,s)>0;function Ae(t){return e("sha256").update(t).digest("hex")}function Oe(e,t){if("function"==typeof e)return e(t);if(e&&Array.isArray(e)&&0!==e.length){return new RegExp(e.reduce(((e,t)=>e+"|"+j.makeRe(t).source),"").substring(1)).test(t)}return!1}function Te(e,i={}){var a,h;const l=r(e),c=t(e);if(l.isFile()){if(Oe(null===(a=null==i?void 0:i.files)||void 0===a?void 0:a.exclude,c))return null;const t=new K;return t.name=c,t.hash=Ae(n(e)),t}if(l.isDirectory()){if(Oe(null===(h=null==i?void 0:i.folders)||void 0===h?void 0:h.exclude,c))return null;const t=new ee;return t.name=c,t.children=o(e).map((t=>Te(s(e,t),i))).filter((e=>null!==e)),t.hash=Ae(t.children.map((e=>e.hash)).join("")),t}return null}function Ne(e){e&&e.children&&(e.childrenObject=e.children.reduce(((e,t)=>(t.children&&Ne(t),e[t.name]=t,e)),{}))}function be(e,t,s=new se,i="."){return t.hash===e.hash||(t.children?t.children.forEach((t=>{t=t,e.childrenObject&&e.childrenObject[t.name]?be(e.childrenObject[t.name],t,s,i+"/"+t.name):xe(t,i+"/"+t.name,s.added)})):s.changed.push({filePath:i,hash:t.hash})),s}function xe(e,t,s){e.children?e.children.forEach((e=>{xe(e,t+"/"+e.name,s)})):s.push({filePath:t,hash:e.hash})}function Ce(e,t){return new Promise(((s,i)=>{const r=f(),n=a(t),o=h(e);o.on("close",s),o.on("error",i),n.on("error",i),o.pipe(r).pipe(n)}))}function ke(e,t,i,r=!1){return E(this,void 0,void 0,(function*(){if(e.children)for(let s=0;s<e.children.length;s++)yield ke(e.children[s],t+(r?"":"/"+e.name),i);else yield Ce(t+"/"+e.name,s(i,e.hash+".gz"))}))}function _e(e,t,r,n,o,a,h,u,d,f={files:{}}){return E(this,void 0,void 0,(function*(){const m=i(n),E=new ie;l(o)||c(o);const v=process.noAsar;try{if(Se(h.version,r)){E.status="downloading",process.noAsar=!0;const i=Te(m,f);Ne(i);const r=be(i,h.hash);return p(s(o,a+".json"),JSON.stringify(r,null,2)),console.log(r),e(E),u.endsWith("/")||(u+="/"),yield Promise.all(r.changed.map((e=>ze(e.hash,`${u}${e.hash}.gz`,s(o,e.hash),d)))),yield Promise.all(r.added.map((e=>ze(e.hash,`${u}${e.hash}.gz`,s(o,e.hash),d)))),process.noAsar=v,console.log("complete"),E.status="finished",e(E),g(t,{detached:!0,env:{exe_path:n,update_temp_path:o,update_config_file_name:a+".json",exe_pid:process.pid.toString()},stdio:"ignore"}),re.Success}return re.HaveNothingUpdate}catch(t){return process.noAsar=v,console.log(t),E.status="failed",E.message=t,e(E),re.Failed}}))}function ze(t,s,i,r){return new Promise(((o,h)=>{if(l(i)&&Ae(n(i))===t)o(!0);else{const n=e("sha256"),l=m(),c=a(i);r(s).then((e=>{e.pipe(l)}),(e=>{h(e)})),l.on("error",(e=>{l.close(),c.close(),n.destroy(),h(e)})),l.on("data",(e=>{n.write(e),c.write(e)})),l.on("end",(()=>{n.digest("hex")!==t?(n.destroy(),h(new Error("下载文件出错"))):o(!0)}))}}))}function Pe(e,t){return new Promise((s=>{u(e,((i,r)=>{var n;s(!i&&(r.isFile()&&(null===(n=Te(e))||void 0===n?void 0:n.hash)===t))}))}))}const{MAX_LENGTH:Me}=oe,{re:De,t:je}=ae.exports,Fe=Re,Ge=le;var Ue=(e,t)=>{if(t=Ge(t),e instanceof Fe)return e;if("string"!=typeof e)return null;if(e.length>Me)return null;if(!(t.loose?De[je.LOOSE]:De[je.FULL]).test(e))return null;try{return new Fe(e,t)}catch(e){return null}};const Xe=Ue;var Be=(e,t)=>{const s=Xe(e,t);return s?s.version:null};const He=Ue;var Ve=(e,t)=>{const s=He(e.trim().replace(/^[=v]+/,""),t);return s?s.version:null};const We=Re;var Ye=(e,t,s,i)=>{"string"==typeof s&&(i=s,s=void 0);try{return new We(e,s).inc(t,i).version}catch(e){return null}};const qe=ye;var Je=(e,t,s)=>0===qe(e,t,s);const Ze=Ue,Qe=Je;var Ke=(e,t)=>{if(Qe(e,t))return null;{const s=Ze(e),i=Ze(t),r=s.prerelease.length||i.prerelease.length,n=r?"pre":"",o=r?"prerelease":"";for(const e in s)if(("major"===e||"minor"===e||"patch"===e)&&s[e]!==i[e])return n+e;return o}};const et=Re;var tt=(e,t)=>new et(e,t).major;const st=Re;var it=(e,t)=>new st(e,t).minor;const rt=Re;var nt=(e,t)=>new rt(e,t).patch;const ot=Ue;var at=(e,t)=>{const s=ot(e,t);return s&&s.prerelease.length?s.prerelease:null};const ht=ye;var lt=(e,t,s)=>ht(t,e,s);const ct=ye;var pt=(e,t)=>ct(e,t,!0);const ut=Re;var dt=(e,t,s)=>{const i=new ut(e,s),r=new ut(t,s);return i.compare(r)||i.compareBuild(r)};const ft=dt;var mt=(e,t)=>e.sort(((e,s)=>ft(e,s,t)));const gt=dt;var Et=(e,t)=>e.sort(((e,s)=>gt(s,e,t)));const vt=ye;var $t=(e,t,s)=>vt(e,t,s)<0;const wt=ye;var Rt=(e,t,s)=>0!==wt(e,t,s);const It=ye;var yt=(e,t,s)=>It(e,t,s)>=0;const Lt=ye;var St=(e,t,s)=>Lt(e,t,s)<=0;const At=Je,Ot=Rt,Tt=Se,Nt=yt,bt=$t,xt=St;var Ct=(e,t,s,i)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e===s;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e!==s;case"":case"=":case"==":return At(e,s,i);case"!=":return Ot(e,s,i);case">":return Tt(e,s,i);case">=":return Nt(e,s,i);case"<":return bt(e,s,i);case"<=":return xt(e,s,i);default:throw new TypeError(`Invalid operator: ${t}`)}};const kt=Re,_t=Ue,{re:zt,t:Pt}=ae.exports;var Mt=(e,t)=>{if(e instanceof kt)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let s=null;if((t=t||{}).rtl){let t;for(;(t=zt[Pt.COERCERTL].exec(e))&&(!s||s.index+s[0].length!==e.length);)s&&t.index+t[0].length===s.index+s[0].length||(s=t),zt[Pt.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;zt[Pt.COERCERTL].lastIndex=-1}else s=e.match(zt[Pt.COERCE]);return null===s?null:_t(`${s[2]}.${s[3]||"0"}.${s[4]||"0"}`,t)};const Dt="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,jt="undefined"!=typeof AbortController?AbortController:Object.assign(class{constructor(){this.signal=new jt.AbortSignal}abort(){this.signal.aborted=!0}},{AbortSignal:class{constructor(){this.aborted=!1}}}),Ft=new Set,Gt=(e,t)=>{const s=`LRU_CACHE_OPTION_${e}`;Bt(s)&&Ht(s,`${e} option`,`options.${t}`,Jt)},Ut=(e,t)=>{const s=`LRU_CACHE_METHOD_${e}`;if(Bt(s)){const{prototype:i}=Jt,{get:r}=Object.getOwnPropertyDescriptor(i,e);Ht(s,`${e} method`,`cache.${t}()`,r)}},Xt=(...e)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...e):console.error(...e)},Bt=e=>!Ft.has(e),Ht=(e,t,s,i)=>{Ft.add(e);Xt(`The ${t} is deprecated. Please use ${s} instead.`,"DeprecationWarning",e,i)},Vt=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),Wt=e=>Vt(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?Yt:null:null;class Yt extends Array{constructor(e){super(e),this.fill(0)}}class qt{constructor(e){const t=e?Wt(e):Array;this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class Jt{constructor(e={}){const{max:t=0,ttl:s,ttlResolution:i=1,ttlAutopurge:r,updateAgeOnGet:n,updateAgeOnHas:o,allowStale:a,dispose:h,disposeAfter:l,noDisposeOnSet:c,noUpdateTTL:p,maxSize:u=0,sizeCalculation:d,fetchMethod:f}=e,{length:m,maxAge:g,stale:E}=e instanceof Jt?{}:e;if(0!==t&&!Vt(t))throw new TypeError("max option must be a nonnegative integer");const v=t?Wt(t):Array;if(!v)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=u,this.sizeCalculation=d||m,this.sizeCalculation){if(!this.maxSize)throw new TypeError("cannot set sizeCalculation without setting maxSize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=f||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new v(t),this.prev=new v(t),this.head=0,this.tail=0,this.free=new qt(t),this.initialFill=1,this.size=0,"function"==typeof h&&(this.dispose=h),"function"==typeof l?(this.disposeAfter=l,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!c,this.noUpdateTTL=!!p,0!==this.maxSize){if(!Vt(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!a||!!E,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!o,this.ttlResolution=Vt(i)||0===i?i:1,this.ttlAutopurge=!!r,this.ttl=s||g||0,this.ttl){if(!Vt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(Bt(e)){Ft.add(e);Xt("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,Jt)}}E&&Gt("stale","allowStale"),g&&Gt("maxAge","ttl"),m&&Gt("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new Yt(this.max),this.starts=new Yt(this.max),this.setItemTTL=(e,t)=>{if(this.starts[e]=0!==t?Dt.now():0,this.ttls[e]=t,0!==t&&this.ttlAutopurge){const s=setTimeout((()=>{this.isStale(e)&&this.delete(this.keyList[e])}),t+1);s.unref&&s.unref()}},this.updateItemAge=e=>{this.starts[e]=0!==this.ttls[e]?Dt.now():0};let e=0;const t=()=>{const t=Dt.now();if(this.ttlResolution>0){e=t;const s=setTimeout((()=>e=0),this.ttlResolution);s.unref&&s.unref()}return t};this.getRemainingTTL=s=>{const i=this.keyMap.get(s);return void 0===i?0:0===this.ttls[i]||0===this.starts[i]?1/0:this.starts[i]+this.ttls[i]-(e||t())},this.isStale=s=>0!==this.ttls[s]&&0!==this.starts[s]&&(e||t())-this.starts[s]>this.ttls[s]}updateItemAge(e){}setItemTTL(e,t){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new Yt(this.max),this.removeItemSize=e=>this.calculatedSize-=this.sizes[e],this.requireSize=(e,t,s,i)=>{if(!Vt(s)){if(!i)throw new TypeError("invalid size value (must be positive integer)");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(s=i(t,e),!Vt(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s},this.addItemSize=(e,t,s,i)=>{this.sizes[e]=i;const r=this.maxSize-this.sizes[e];for(;this.calculatedSize>r;)this.evict();this.calculatedSize+=this.sizes[e]},this.delete=e=>{if(0!==this.size){const t=this.keyMap.get(e);void 0!==t&&(this.calculatedSize-=this.sizes[t])}return Jt.prototype.delete.call(this,e)}}removeItemSize(e){}addItemSize(e,t,s,i){}requireSize(e,t,s,i){if(s||i)throw new TypeError("cannot set size without setting maxSize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())yield[this.keyList[e],this.valList[e]]}*rentries(){for(const e of this.rindexes())yield[this.keyList[e],this.valList[e]]}*keys(){for(const e of this.indexes())yield this.keyList[e]}*rkeys(){for(const e of this.rindexes())yield this.keyList[e]}*values(){for(const e of this.indexes())yield this.valList[e]}*rvalues(){for(const e of this.rindexes())yield this.valList[e]}[Symbol.iterator](){return this.entries()}find(e,t={}){for(const s of this.indexes())if(e(this.valList[s],this.keyList[s],this))return this.get(this.keyList[s],t)}forEach(e,t=this){for(const s of this.indexes())e.call(t,this.valList[s],this.keyList[s],this)}rforEach(e,t=this){for(const s of this.rindexes())e.call(t,this.valList[s],this.keyList[s],this)}get prune(){return Ut("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const e=[];for(const t of this.indexes()){const s=this.keyList[t],i={value:this.valList[t]};this.ttls&&(i.ttl=this.ttls[t]),this.sizes&&(i.size=this.sizes[t]),e.unshift([s,i])}return e}load(e){this.clear();for(const[t,s]of e)this.set(t,s.value,s)}dispose(e,t,s){}set(e,t,{ttl:s=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:r=0,sizeCalculation:n=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL}={}){r=this.requireSize(e,t,r,n);let a=0===this.size?void 0:this.keyMap.get(e);if(void 0===a)a=this.newIndex(),this.keyList[a]=e,this.valList[a]=t,this.keyMap.set(e,a),this.next[this.tail]=a,this.prev[a]=this.tail,this.tail=a,this.size++,this.addItemSize(a,t,e,r),o=!1;else{const s=this.valList[a];t!==s&&(this.isBackgroundFetch(s)?s.__abortController.abort():i||(this.dispose(s,e,"set"),this.disposeAfter&&this.disposed.push([s,e,"set"])),this.removeItemSize(a),this.valList[a]=t,this.addItemSize(a,t,e,r)),this.moveToTail(a)}if(0===s||0!==this.ttl||this.ttls||this.initializeTTLTracking(),o||this.setItemTTL(a,s),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max?this.evict():0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(),e}}evict(){const e=this.head,t=this.keyList[e],s=this.valList[e];return this.isBackgroundFetch(s)?s.__abortController.abort():(this.dispose(s,t,"evict"),this.disposeAfter&&this.disposed.push([s,t,"evict"])),this.removeItemSize(e),this.head=this.next[e],this.keyMap.delete(t),this.size--,e}has(e,{updateAgeOnHas:t=this.updateAgeOnHas}={}){const s=this.keyMap.get(e);return void 0!==s&&!this.isStale(s)&&(t&&this.updateItemAge(s),!0)}peek(e,{allowStale:t=this.allowStale}={}){const s=this.keyMap.get(e);if(void 0!==s&&(t||!this.isStale(s)))return this.valList[s]}backgroundFetch(e,t,s){const i=void 0===t?void 0:this.valList[t];if(this.isBackgroundFetch(i))return i;const r=new jt,n={signal:r.signal,options:s},o=Promise.resolve(this.fetchMethod(e,i,n)).then((t=>(r.signal.aborted||this.set(e,t,n.options),t)));return o.__abortController=r,o.__staleWhileFetching=i,void 0===t?(this.set(e,o,n.options),t=this.keyMap.get(e)):this.valList[t]=o,o}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,ttl:i=this.ttl,noDisposeOnSet:r=this.noDisposeOnSet,size:n=0,sizeCalculation:o=this.sizeCalculation,noUpdateTTL:a=this.noUpdateTTL}={}){if(!this.fetchMethod)return this.get(e,{allowStale:t,updateAgeOnGet:s});const h={allowStale:t,updateAgeOnGet:s,ttl:i,noDisposeOnSet:r,size:n,sizeCalculation:o,noUpdateTTL:a};let l=this.keyMap.get(e);if(void 0===l)return this.backgroundFetch(e,l,h);{const i=this.valList[l];if(this.isBackgroundFetch(i))return t&&void 0!==i.__staleWhileFetching?i.__staleWhileFetching:i;if(!this.isStale(l))return this.moveToTail(l),s&&this.updateItemAge(l),i;const r=this.backgroundFetch(e,l,h);return t&&void 0!==r.__staleWhileFetching?r.__staleWhileFetching:r}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet}={}){const i=this.keyMap.get(e);if(void 0!==i){const r=this.valList[i],n=this.isBackgroundFetch(r);if(this.isStale(i))return n?t?r.__staleWhileFetching:void 0:(this.delete(e),t?r:void 0);if(n)return;return this.moveToTail(i),s&&this.updateItemAge(i),r}}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return Ut("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const s=this.keyMap.get(e);if(void 0!==s)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(s);const t=this.valList[s];this.isBackgroundFetch(t)?t.__abortController.abort():(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[s]=null,this.valList[s]=null,s===this.tail?this.tail=this.prev[s]:s===this.head?this.head=this.next[s]:(this.next[this.prev[s]]=this.next[s],this.prev[this.next[s]]=this.prev[s]),this.size--,this.free.push(s)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort();else{const s=this.keyList[e];this.dispose(t,s,"delete"),this.disposeAfter&&this.disposed.push([t,s,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return Ut("reset","clear"),this.clear}get length(){return((e,t)=>{const s=`LRU_CACHE_PROPERTY_${e}`;if(Bt(s)){const{prototype:i}=Jt,{get:r}=Object.getOwnPropertyDescriptor(i,e);Ht(s,`${e} property`,`cache.${t}`,r)}})("length","size"),this.size}}var Zt=Jt;class Qt{constructor(e,t){if(t=ts(t),e instanceof Qt)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Qt(e.raw,t);if(e instanceof ss)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!cs(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&ps(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,s=es.get(t);if(s)return s;const i=this.options.loose,r=i?ns[os.HYPHENRANGELOOSE]:ns[os.HYPHENRANGE];e=e.replace(r,ys(this.options.includePrerelease)),is("hyphen replace",e),e=e.replace(ns[os.COMPARATORTRIM],as),is("comparator trim",e);let n=(e=(e=(e=e.replace(ns[os.TILDETRIM],hs)).replace(ns[os.CARETTRIM],ls)).split(/\s+/).join(" ")).split(" ").map((e=>ds(e,this.options))).join(" ").split(/\s+/).map((e=>Is(e,this.options)));i&&(n=n.filter((e=>(is("loose invalid filter",e,this.options),!!e.match(ns[os.COMPARATORLOOSE]))))),is("range list",n);const o=new Map,a=n.map((e=>new ss(e,this.options)));for(const e of a){if(cs(e))return[e];o.set(e.value,e)}o.size>1&&o.has("")&&o.delete("");const h=[...o.values()];return es.set(t,h),h}intersects(e,t){if(!(e instanceof Qt))throw new TypeError("a Range is required");return this.set.some((s=>us(s,t)&&e.set.some((e=>us(e,t)&&s.every((s=>e.every((e=>s.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new rs(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(Ls(this.set[t],e,this.options))return!0;return!1}}var Kt=Qt;const es=new Zt({max:1e3}),ts=le,ss=Os,is=ne,rs=Re,{re:ns,t:os,comparatorTrimReplace:as,tildeTrimReplace:hs,caretTrimReplace:ls}=ae.exports,cs=e=>"<0.0.0-0"===e.value,ps=e=>""===e.value,us=(e,t)=>{let s=!0;const i=e.slice();let r=i.pop();for(;s&&i.length;)s=i.every((e=>r.intersects(e,t))),r=i.pop();return s},ds=(e,t)=>(is("comp",e,t),e=Es(e,t),is("caret",e),e=ms(e,t),is("tildes",e),e=$s(e,t),is("xrange",e),e=Rs(e,t),is("stars",e),e),fs=e=>!e||"x"===e.toLowerCase()||"*"===e,ms=(e,t)=>e.trim().split(/\s+/).map((e=>gs(e,t))).join(" "),gs=(e,t)=>{const s=t.loose?ns[os.TILDELOOSE]:ns[os.TILDE];return e.replace(s,((t,s,i,r,n)=>{let o;return is("tilde",e,t,s,i,r,n),fs(s)?o="":fs(i)?o=`>=${s}.0.0 <${+s+1}.0.0-0`:fs(r)?o=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:n?(is("replaceTilde pr",n),o=`>=${s}.${i}.${r}-${n} <${s}.${+i+1}.0-0`):o=`>=${s}.${i}.${r} <${s}.${+i+1}.0-0`,is("tilde return",o),o}))},Es=(e,t)=>e.trim().split(/\s+/).map((e=>vs(e,t))).join(" "),vs=(e,t)=>{is("caret",e,t);const s=t.loose?ns[os.CARETLOOSE]:ns[os.CARET],i=t.includePrerelease?"-0":"";return e.replace(s,((t,s,r,n,o)=>{let a;return is("caret",e,t,s,r,n,o),fs(s)?a="":fs(r)?a=`>=${s}.0.0${i} <${+s+1}.0.0-0`:fs(n)?a="0"===s?`>=${s}.${r}.0${i} <${s}.${+r+1}.0-0`:`>=${s}.${r}.0${i} <${+s+1}.0.0-0`:o?(is("replaceCaret pr",o),a="0"===s?"0"===r?`>=${s}.${r}.${n}-${o} <${s}.${r}.${+n+1}-0`:`>=${s}.${r}.${n}-${o} <${s}.${+r+1}.0-0`:`>=${s}.${r}.${n}-${o} <${+s+1}.0.0-0`):(is("no pr"),a="0"===s?"0"===r?`>=${s}.${r}.${n}${i} <${s}.${r}.${+n+1}-0`:`>=${s}.${r}.${n}${i} <${s}.${+r+1}.0-0`:`>=${s}.${r}.${n} <${+s+1}.0.0-0`),is("caret return",a),a}))},$s=(e,t)=>(is("replaceXRanges",e,t),e.split(/\s+/).map((e=>ws(e,t))).join(" ")),ws=(e,t)=>{e=e.trim();const s=t.loose?ns[os.XRANGELOOSE]:ns[os.XRANGE];return e.replace(s,((s,i,r,n,o,a)=>{is("xRange",e,s,i,r,n,o,a);const h=fs(r),l=h||fs(n),c=l||fs(o),p=c;return"="===i&&p&&(i=""),a=t.includePrerelease?"-0":"",h?s=">"===i||"<"===i?"<0.0.0-0":"*":i&&p?(l&&(n=0),o=0,">"===i?(i=">=",l?(r=+r+1,n=0,o=0):(n=+n+1,o=0)):"<="===i&&(i="<",l?r=+r+1:n=+n+1),"<"===i&&(a="-0"),s=`${i+r}.${n}.${o}${a}`):l?s=`>=${r}.0.0${a} <${+r+1}.0.0-0`:c&&(s=`>=${r}.${n}.0${a} <${r}.${+n+1}.0-0`),is("xRange return",s),s}))},Rs=(e,t)=>(is("replaceStars",e,t),e.trim().replace(ns[os.STAR],"")),Is=(e,t)=>(is("replaceGTE0",e,t),e.trim().replace(ns[t.includePrerelease?os.GTE0PRE:os.GTE0],"")),ys=e=>(t,s,i,r,n,o,a,h,l,c,p,u,d)=>`${s=fs(i)?"":fs(r)?`>=${i}.0.0${e?"-0":""}`:fs(n)?`>=${i}.${r}.0${e?"-0":""}`:o?`>=${s}`:`>=${s}${e?"-0":""}`} ${h=fs(l)?"":fs(c)?`<${+l+1}.0.0-0`:fs(p)?`<${l}.${+c+1}.0-0`:u?`<=${l}.${c}.${p}-${u}`:e?`<${l}.${c}.${+p+1}-0`:`<=${h}`}`.trim(),Ls=(e,t,s)=>{for(let s=0;s<e.length;s++)if(!e[s].test(t))return!1;if(t.prerelease.length&&!s.includePrerelease){for(let s=0;s<e.length;s++)if(is(e[s].semver),e[s].semver!==ss.ANY&&e[s].semver.prerelease.length>0){const i=e[s].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0},Ss=Symbol("SemVer ANY");class As{static get ANY(){return Ss}constructor(e,t){if(t=Ts(t),e instanceof As){if(e.loose===!!t.loose)return e;e=e.value}Cs("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===Ss?this.value="":this.value=this.operator+this.semver.version,Cs("comp",this)}parse(e){const t=this.options.loose?Ns[bs.COMPARATORLOOSE]:Ns[bs.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new ks(s[2],this.options.loose):this.semver=Ss}toString(){return this.value}test(e){if(Cs("Comparator.test",e,this.options.loose),this.semver===Ss||e===Ss)return!0;if("string"==typeof e)try{e=new ks(e,this.options)}catch(e){return!1}return xs(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof As))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new _s(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new _s(this.value,t).test(e.semver);const s=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),r=this.semver.version===e.semver.version,n=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=xs(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),a=xs(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return s||i||r&&n||o||a}}var Os=As;const Ts=le,{re:Ns,t:bs}=ae.exports,xs=Ct,Cs=ne,ks=Re,_s=Kt,zs=Kt;var Ps=(e,t,s)=>{try{t=new zs(t,s)}catch(e){return!1}return t.test(e)};const Ms=Kt;var Ds=(e,t)=>new Ms(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));const js=Re,Fs=Kt;var Gs=(e,t,s)=>{let i=null,r=null,n=null;try{n=new Fs(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(i&&-1!==r.compare(e)||(i=e,r=new js(i,s)))})),i};const Us=Re,Xs=Kt;var Bs=(e,t,s)=>{let i=null,r=null,n=null;try{n=new Xs(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(i&&1!==r.compare(e)||(i=e,r=new Us(i,s)))})),i};const Hs=Re,Vs=Kt,Ws=Se;var Ys=(e,t)=>{e=new Vs(e,t);let s=new Hs("0.0.0");if(e.test(s))return s;if(s=new Hs("0.0.0-0"),e.test(s))return s;s=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let r=null;i.forEach((e=>{const t=new Hs(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":r&&!Ws(t,r)||(r=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!r||s&&!Ws(s,r)||(s=r)}return s&&e.test(s)?s:null};const qs=Kt;var Js=(e,t)=>{try{return new qs(e,t).range||"*"}catch(e){return null}};const Zs=Re,Qs=Os,{ANY:Ks}=Qs,ei=Kt,ti=Ps,si=Se,ii=$t,ri=St,ni=yt;var oi=(e,t,s,i)=>{let r,n,o,a,h;switch(e=new Zs(e,i),t=new ei(t,i),s){case">":r=si,n=ri,o=ii,a=">",h=">=";break;case"<":r=ii,n=ni,o=si,a="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(ti(e,t,i))return!1;for(let s=0;s<t.set.length;++s){const l=t.set[s];let c=null,p=null;if(l.forEach((e=>{e.semver===Ks&&(e=new Qs(">=0.0.0")),c=c||e,p=p||e,r(e.semver,c.semver,i)?c=e:o(e.semver,p.semver,i)&&(p=e)})),c.operator===a||c.operator===h)return!1;if((!p.operator||p.operator===a)&&n(e,p.semver))return!1;if(p.operator===h&&o(e,p.semver))return!1}return!0};const ai=oi;var hi=(e,t,s)=>ai(e,t,">",s);const li=oi;var ci=(e,t,s)=>li(e,t,"<",s);const pi=Kt;var ui=(e,t,s)=>(e=new pi(e,s),t=new pi(t,s),e.intersects(t));const di=Ps,fi=ye;const mi=Kt,gi=Os,{ANY:Ei}=gi,vi=Ps,$i=ye,wi=(e,t,s)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===Ei){if(1===t.length&&t[0].semver===Ei)return!0;e=s.includePrerelease?[new gi(">=0.0.0-0")]:[new gi(">=0.0.0")]}if(1===t.length&&t[0].semver===Ei){if(s.includePrerelease)return!0;t=[new gi(">=0.0.0")]}const i=new Set;let r,n,o,a,h,l,c;for(const t of e)">"===t.operator||">="===t.operator?r=Ri(r,t,s):"<"===t.operator||"<="===t.operator?n=Ii(n,t,s):i.add(t.semver);if(i.size>1)return null;if(r&&n){if(o=$i(r.semver,n.semver,s),o>0)return null;if(0===o&&(">="!==r.operator||"<="!==n.operator))return null}for(const e of i){if(r&&!vi(e,String(r),s))return null;if(n&&!vi(e,String(n),s))return null;for(const i of t)if(!vi(e,String(i),s))return!1;return!0}let p=!(!n||s.includePrerelease||!n.semver.prerelease.length)&&n.semver,u=!(!r||s.includePrerelease||!r.semver.prerelease.length)&&r.semver;p&&1===p.prerelease.length&&"<"===n.operator&&0===p.prerelease[0]&&(p=!1);for(const e of t){if(c=c||">"===e.operator||">="===e.operator,l=l||"<"===e.operator||"<="===e.operator,r)if(u&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===u.major&&e.semver.minor===u.minor&&e.semver.patch===u.patch&&(u=!1),">"===e.operator||">="===e.operator){if(a=Ri(r,e,s),a===e&&a!==r)return!1}else if(">="===r.operator&&!vi(r.semver,String(e),s))return!1;if(n)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),"<"===e.operator||"<="===e.operator){if(h=Ii(n,e,s),h===e&&h!==n)return!1}else if("<="===n.operator&&!vi(n.semver,String(e),s))return!1;if(!e.operator&&(n||r)&&0!==o)return!1}return!(r&&l&&!n&&0!==o)&&(!(n&&c&&!r&&0!==o)&&(!u&&!p))},Ri=(e,t,s)=>{if(!e)return t;const i=$i(e.semver,t.semver,s);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},Ii=(e,t,s)=>{if(!e)return t;const i=$i(e.semver,t.semver,s);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};var yi=(e,t,s={})=>{if(e===t)return!0;e=new mi(e,s),t=new mi(t,s);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=wi(r,e,s);if(i=i||null!==t,t)continue e}if(i)return!1}return!0};const Li=ae.exports;var Si={re:Li.re,src:Li.src,tokens:Li.t,SEMVER_SPEC_VERSION:oe.SEMVER_SPEC_VERSION,SemVer:Re,compareIdentifiers:ue.compareIdentifiers,rcompareIdentifiers:ue.rcompareIdentifiers,parse:Ue,valid:Be,clean:Ve,inc:Ye,diff:Ke,major:tt,minor:it,patch:nt,prerelease:at,compare:ye,rcompare:lt,compareLoose:pt,compareBuild:dt,sort:mt,rsort:Et,gt:Se,lt:$t,eq:Je,neq:Rt,gte:yt,lte:St,cmp:Ct,coerce:Mt,Comparator:Os,Range:Kt,satisfies:Ps,toComparators:Ds,maxSatisfying:Gs,minSatisfying:Bs,minVersion:Ys,validRange:Js,outside:oi,gtr:hi,ltr:ci,intersects:ui,simplifyRange:(e,t,s)=>{const i=[];let r=null,n=null;const o=e.sort(((e,t)=>fi(e,t,s)));for(const e of o){di(e,t,s)?(n=e,r||(r=e)):(n&&i.push([r,n]),n=null,r=null)}r&&i.push([r,null]);const a=[];for(const[e,t]of i)e===t?a.push(e):t||e!==o[0]?t?e===o[0]?a.push(`<=${t}`):a.push(`${e} - ${t}`):a.push(`>=${e}`):a.push("*");const h=a.join(" || "),l="string"==typeof t.raw?t.raw:String(t);return h.length<l.length?h:t},subset:yi};class Ai{constructor(){this.tasks=[],this.isDownloading=!1,this.__downLoadFinnishCallBack=()=>0}downLoadFinnishCallBack(e){this.__downLoadFinnishCallBack=e}addTask(e){if("function"!=typeof e)throw new TypeError("Task must be a function!");this.tasks.push(e),this.isDownloading||(this.isDownloading=!0,this.download())}downAndungzip(t,s,i,r){return new Promise(((o,h)=>{const c=`${i}.tmp`;if(l(i)&&Ae(n(i))===t)o(!0);else{const n=e("sha256"),l=m(),p=a(c);r(s).then((e=>{e.pipe(l)}),(e=>{h(e)})),l.on("error",(e=>{l.close(),p.close(),n.destroy(),h(e)})),l.on("data",(e=>{n.write(e),p.write(e)})),l.on("end",(()=>{n.digest("hex")!==t?(n.destroy(),h(new Error("下载文件出错"))):(p.on("finish",(()=>{d(c,i,(e=>{e?h(e):o(!0)}))})),p.end())}))}}))}download(){const e=this.tasks.shift();e?e.task().then((()=>{e.finnishCallBack(!0),this.download()})).catch((t=>{e.finnishCallBack(!1,t)})):(this.__downLoadFinnishCallBack(),this.isDownloading=!1)}}class Oi{constructor(e,t,s,i,r,n,o,a,h,l={files:{}}){this.statusCallback=e,this.updaterName=t,this.version=s,this.exePath=i,this.tempDirectory=r,this.updateConfigName=n,this.updateJson=o,this.baseUrl=a,this.downloadFn=h,this.options=l,this.downloadQueue=new Ai,this.__diffResult=void 0}checkForUpdates(){return E(this,void 0,void 0,(function*(){try{if(Si.gt(this.updateJson.version,this.version)){const e=Te(i(this.exePath),this.options);Ne(e);const t=be(e,this.updateJson.hash);return t&&t.added.concat(t.changed).length>0&&(this.__diffResult=Object.freeze(t)),!!this.__diffResult}return!1}catch(e){return this.statusCallback({message:e,status:"failed"}),console.log("checkForUpdates",e),!1}}))}downloadUpdate(){return E(this,void 0,void 0,(function*(){if(!this.__diffResult)return this.statusCallback({message:"程序无须更新",status:"failed"}),!1;try{l(this.tempDirectory)||c(this.tempDirectory),this.baseUrl.endsWith("/")||(this.baseUrl+="/"),this.statusCallback({message:{changed:this.__diffResult.changed.map((e=>e.hash)),added:this.__diffResult.added.map((e=>e.hash)),msg:"findDifferentElements"},status:"init"});return new Promise(((e,t)=>{this.downloadQueue.downLoadFinnishCallBack((()=>{e(!0)})),this.__diffResult.added.concat(this.__diffResult.changed).forEach((e=>{const t=`${this.baseUrl}${e.hash}.gz`;this.downloadQueue.addTask({task:()=>this.downloadQueue.downAndungzip(e.hash,t,s(this.tempDirectory,e.hash),this.downloadFn),finnishCallBack:e=>{}})}))}))}catch(e){return this.statusCallback({message:e,status:"failed"}),console.log("downloadUpdate",e),!1}}))}install(e=!1){var t,s;return E(this,void 0,void 0,(function*(){try{let i=!0;if(e)i=e;else{if(!(yield this.validateDiffPackageIntegrity()))return this.statusCallback({message:"Installation check difference failed",status:"failed"}),!1}if(i){const e=g(this.updaterName,{detached:!0,env:{exe_path:this.exePath,update_temp_path:this.tempDirectory,update_config_file_name:this.updateConfigName+".json",exe_pid:process.pid.toString()},stdio:"ignore"});return null===(t=e.stdout)||void 0===t||t.on("data",(e=>{this.statusCallback({message:{data:JSON.stringify(e),msg:"child.stdout data"},status:"init"})})),null===(s=e.stdout)||void 0===s||s.on("close",(()=>{this.statusCallback({message:"child.stdout close",status:"init"})})),!0}return!1}catch(e){this.statusCallback({message:e,status:"failed"})}}))}validateDiffPackageIntegrity(){return E(this,void 0,void 0,(function*(){if(this.__diffResult){for(const e of this.__diffResult.changed){const t=`${this.tempDirectory}/${e.hash}`;if(!(yield Pe(t,e.hash)))return!0}for(const e of this.__diffResult.added){const t=`${this.tempDirectory}/${e.hash}`;if(!(yield Pe(t,e.hash)))return!0}}return!1}))}}export{se as DiffVersionHashResult,te as DiffVersionHashResultItem,K as HashedFile,ee as HashedFolder,Oi as UpdateElectron,ie as UpdateInfo,re as UpdateStatus,Pe as checkFileExitAndHash,be as diffVersionHash,Ce as gzip,Ne as handleHashedFolderChildrenToObject,Ae as hash256,Te as hashElement,xe as pushdiffVersionHashResult,Oe as reduceGlobPatterns,_e as updateElectron,ke as zipHashElement};
