"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crypto"),t=require("path"),r=require("fs"),n=require("zlib"),s=require("child_process"),i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])},i(e,t)};function o(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{h(n.next(e))}catch(e){i(e)}}function a(e){try{h(n.throw(e))}catch(e){i(e)}}function h(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}h((n=n.apply(e,t||[])).next())}))}function a(e,t){var r,n,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(s=2&i[0]?n.return:i[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}var h="object"==typeof process&&process&&"win32"===process.platform?{sep:"\\"}:{sep:"/"},c=l;function l(e,t,r){e instanceof RegExp&&(e=p(e,r)),t instanceof RegExp&&(t=p(t,r));var n=u(e,t,r);return n&&{start:n[0],end:n[1],pre:r.slice(0,n[0]),body:r.slice(n[0]+e.length,n[1]),post:r.slice(n[1]+t.length)}}function p(e,t){var r=t.match(e);return r?r[0]:null}function u(e,t,r){var n,s,i,o,a,h=r.indexOf(e),c=r.indexOf(t,h+1),l=h;if(h>=0&&c>0){if(e===t)return[h,c];for(n=[],i=r.length;l>=0&&!a;)l==h?(n.push(l),h=r.indexOf(e,l+1)):1==n.length?a=[n.pop(),c]:((s=n.pop())<i&&(i=s,o=c),c=r.indexOf(t,l+1)),l=h<c&&h>=0?h:c;n.length&&(a=[i,o])}return a}l.range=u;var E=c,f=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return S(function(e){return e.split("\\\\").join(d).split("\\{").join(g).split("\\}").join(I).split("\\,").join(m).split("\\.").join(R)}(e),!0).map(O)},d="\0SLASH"+Math.random()+"\0",g="\0OPEN"+Math.random()+"\0",I="\0CLOSE"+Math.random()+"\0",m="\0COMMA"+Math.random()+"\0",R="\0PERIOD"+Math.random()+"\0";function N(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function O(e){return e.split(d).join("\\").split(g).join("{").split(I).join("}").split(m).join(",").split(R).join(".")}function b(e){if(!e)return[""];var t=[],r=E("{","}",e);if(!r)return e.split(",");var n=r.pre,s=r.body,i=r.post,o=n.split(",");o[o.length-1]+="{"+s+"}";var a=b(i);return i.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function L(e){return"{"+e+"}"}function $(e){return/^-?0\d/.test(e)}function A(e,t){return e<=t}function v(e,t){return e>=t}function S(e,t){var r=[],n=E("{","}",e);if(!n)return[e];var s=n.pre,i=n.post.length?S(n.post,!1):[""];if(/\$$/.test(n.pre))for(var o=0;o<i.length;o++){var a=s+"{"+n.body+"}"+i[o];r.push(a)}else{var h,c,l=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(n.body),p=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(n.body),u=l||p,f=n.body.indexOf(",")>=0;if(!u&&!f)return n.post.match(/,.*\}/)?S(e=n.pre+"{"+n.body+I+n.post):[e];if(u)h=n.body.split(/\.\./);else if(1===(h=b(n.body)).length&&1===(h=S(h[0],!1).map(L)).length)return i.map((function(e){return n.pre+h[0]+e}));if(u){var d=N(h[0]),g=N(h[1]),m=Math.max(h[0].length,h[1].length),R=3==h.length?Math.abs(N(h[2])):1,O=A;g<d&&(R*=-1,O=v);var T=h.some($);c=[];for(var y=d;O(y,g);y+=R){var w;if(p)"\\"===(w=String.fromCharCode(y))&&(w="");else if(w=String(y),T){var x=m-w.length;if(x>0){var P=new Array(x+1).join("0");w=y<0?"-"+P+w.slice(1):P+w}}c.push(w)}}else{c=[];for(var j=0;j<h.length;j++)c.push.apply(c,S(h[j],!1))}for(j=0;j<c.length;j++)for(o=0;o<i.length;o++){a=s+c[j]+i[o];(!t||u||a)&&r.push(a)}}return r}const T=y=(e,t,r={})=>(X(t),!(!r.nocomment&&"#"===t.charAt(0))&&new k(t,r).match(e));var y=T;const w=h;T.sep=w.sep;const x=Symbol("globstar **");T.GLOBSTAR=x;const P=f,j={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},D=e=>e.split("").reduce(((e,t)=>(e[t]=!0,e)),{}),M=D("().*{}+?[]^$\\!"),F=D("[.("),G=/\/+/;T.filter=(e,t={})=>(r,n,s)=>T(r,e,t);const C=(e,t={})=>{const r={};return Object.keys(e).forEach((t=>r[t]=e[t])),Object.keys(t).forEach((e=>r[e]=t[e])),r};T.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return T;const t=T,r=(r,n,s)=>t(r,n,C(e,s));return(r.Minimatch=class extends t.Minimatch{constructor(t,r){super(t,C(e,r))}}).defaults=r=>t.defaults(C(e,r)).Minimatch,r.filter=(r,n)=>t.filter(r,C(e,n)),r.defaults=r=>t.defaults(C(e,r)),r.makeRe=(r,n)=>t.makeRe(r,C(e,n)),r.braceExpand=(r,n)=>t.braceExpand(r,C(e,n)),r.match=(r,n,s)=>t.match(r,n,C(e,s)),r},T.braceExpand=(e,t)=>_(e,t);const _=(e,t={})=>(X(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:P(e)),X=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},U=Symbol("subparse");T.makeRe=(e,t)=>new k(e,t||{}).makeRe(),T.match=(e,t,r={})=>{const n=new k(t,r);return e=e.filter((e=>n.match(e))),n.options.nonull&&!e.length&&e.push(t),e};class k{constructor(e,t){X(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();let r=this.globSet=this.braceExpand();t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,r),r=this.globParts=r.map((e=>e.split(G))),this.debug(this.pattern,r),r=r.map(((e,t,r)=>e.map(this.parse,this))),this.debug(this.pattern,r),r=r.filter((e=>-1===e.indexOf(!1))),this.debug(this.pattern,r),this.set=r}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let t=!1,r=0;for(let n=0;n<e.length&&"!"===e.charAt(n);n++)t=!t,r++;r&&(this.pattern=e.substr(r)),this.negate=t}matchOne(e,t,r){var n=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var s=0,i=0,o=e.length,a=t.length;s<o&&i<a;s++,i++){this.debug("matchOne loop");var h,c=t[i],l=e[s];if(this.debug(t,c,l),!1===c)return!1;if(c===x){this.debug("GLOBSTAR",[t,c,l]);var p=s,u=i+1;if(u===a){for(this.debug("** at the end");s<o;s++)if("."===e[s]||".."===e[s]||!n.dot&&"."===e[s].charAt(0))return!1;return!0}for(;p<o;){var E=e[p];if(this.debug("\nglobstar while",e,p,t,u,E),this.matchOne(e.slice(p),t.slice(u),r))return this.debug("globstar found match!",p,o,E),!0;if("."===E||".."===E||!n.dot&&"."===E.charAt(0)){this.debug("dot detected!",e,p,t,u);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!r||(this.debug("\n>>> no match, partial?",e,p,t,u),p!==o))}if("string"==typeof c?(h=l===c,this.debug("string match",c,l,h)):(h=l.match(c),this.debug("pattern match",c,l,h)),!h)return!1}if(s===o&&i===a)return!0;if(s===o)return r;if(i===a)return s===o-1&&""===e[s];throw new Error("wtf?")}braceExpand(){return _(this.pattern,this.options)}parse(e,t){X(e);const r=this.options;if("**"===e){if(!r.noglobstar)return x;e="*"}if(""===e)return"";let n="",s=!!r.nocase,i=!1;const o=[],a=[];let h,c,l,p,u=!1,E=-1,f=-1;const d="."===e.charAt(0)?"":r.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=()=>{if(h){switch(h){case"*":n+="[^/]*?",s=!0;break;case"?":n+="[^/]",s=!0;break;default:n+="\\"+h}this.debug("clearStateChar %j %j",h,n),h=!1}};for(let t,d=0;d<e.length&&(t=e.charAt(d));d++)if(this.debug("%s\t%s %s %j",e,d,n,t),i){if("/"===t)return!1;M[t]&&(n+="\\"),n+=t,i=!1}else switch(t){case"/":return!1;case"\\":g(),i=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,d,n,t),u){this.debug("  in class"),"!"===t&&d===f+1&&(t="^"),n+=t;continue}this.debug("call clearStateChar %j",h),g(),h=t,r.noext&&g();continue;case"(":if(u){n+="(";continue}if(!h){n+="\\(";continue}o.push({type:h,start:d-1,reStart:n.length,open:j[h].open,close:j[h].close}),n+="!"===h?"(?:(?!(?:":"(?:",this.debug("plType %j %j",h,n),h=!1;continue;case")":if(u||!o.length){n+="\\)";continue}g(),s=!0,l=o.pop(),n+=l.close,"!"===l.type&&a.push(l),l.reEnd=n.length;continue;case"|":if(u||!o.length){n+="\\|";continue}g(),n+="|";continue;case"[":if(g(),u){n+="\\"+t;continue}u=!0,f=d,E=n.length,n+=t;continue;case"]":if(d===f+1||!u){n+="\\"+t;continue}c=e.substring(f+1,d);try{RegExp("["+c+"]")}catch(e){p=this.parse(c,U),n=n.substr(0,E)+"\\["+p[0]+"\\]",s=s||p[1],u=!1;continue}s=!0,u=!1,n+=t;continue;default:g(),!M[t]||"^"===t&&u||(n+="\\"),n+=t}for(u&&(c=e.substr(f+1),p=this.parse(c,U),n=n.substr(0,E)+"\\["+p[0],s=s||p[1]),l=o.pop();l;l=o.pop()){let e;e=n.slice(l.reStart+l.open.length),this.debug("setting tail",n,l),e=e.replace(/((?:\\{2}){0,64})(\\?)\|/g,((e,t,r)=>(r||(r="\\"),t+t+r+"|"))),this.debug("tail=%j\n   %s",e,e,l,n);const t="*"===l.type?"[^/]*?":"?"===l.type?"[^/]":"\\"+l.type;s=!0,n=n.slice(0,l.reStart)+t+"\\("+e}g(),i&&(n+="\\\\");const I=F[n.charAt(0)];for(let e=a.length-1;e>-1;e--){const r=a[e],s=n.slice(0,r.reStart),i=n.slice(r.reStart,r.reEnd-8);let o=n.slice(r.reEnd);const h=n.slice(r.reEnd-8,r.reEnd)+o,c=s.split("(").length-1;let l=o;for(let e=0;e<c;e++)l=l.replace(/\)[+*?]?/,"");o=l;n=s+i+o+(""===o&&t!==U?"$":"")+h}if(""!==n&&s&&(n="(?=.)"+n),I&&(n=d+n),t===U)return[n,s];if(!s)return e.replace(/\\(.)/g,"$1");const m=r.nocase?"i":"";try{return Object.assign(new RegExp("^"+n+"$",m),{_glob:e,_src:n})}catch(e){return new RegExp("$.")}}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,r=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",n=t.nocase?"i":"";let s=e.map((e=>(e=e.map((e=>"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===x?x:e._src)).reduce(((e,t)=>(e[e.length-1]===x&&t===x||e.push(t),e)),[]),e.forEach(((t,n)=>{t===x&&e[n-1]!==x&&(0===n?e.length>1?e[n+1]="(?:\\/|"+r+"\\/)?"+e[n+1]:e[n]=r:n===e.length-1?e[n-1]+="(?:\\/|"+r+")?":(e[n-1]+="(?:\\/|\\/"+r+"\\/)"+e[n+1],e[n+1]=x))})),e.filter((e=>e!==x)).join("/")))).join("|");s="^(?:"+s+")$",this.negate&&(s="^(?!"+s+").*$");try{this.regexp=new RegExp(s,n)}catch(e){this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const r=this.options;"/"!==w.sep&&(e=e.split(w.sep).join("/")),e=e.split(G),this.debug(this.pattern,"split",e);const n=this.set;let s;this.debug(this.pattern,"set",n);for(let t=e.length-1;t>=0&&(s=e[t],!s);t--);for(let i=0;i<n.length;i++){const o=n[i];let a=e;r.matchBase&&1===o.length&&(a=[s]);if(this.matchOne(a,o,t))return!!r.flipNegate||!this.negate}return!r.flipNegate&&this.negate}static defaults(e){return T.defaults(e).Minimatch}}T.Minimatch=k;var H=function(){},V=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}(t,e),t}(H),B=function(){},z=function(){this.added=[],this.changed=[]},q=function(){this.status="init",this.message=""};var Z="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var W={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16},Y={exports:{}};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:r}=W,n=Z,s=(t=e.exports={}).re=[],i=t.src=[],o=t.t={};let a=0;const h=(e,t,r)=>{const h=a++;n(e,h,t),o[e]=h,i[h]=t,s[h]=new RegExp(t,r?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","[0-9]+"),h("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),h("MAINVERSION",`(${i[o.NUMERICIDENTIFIER]})\\.(${i[o.NUMERICIDENTIFIER]})\\.(${i[o.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${i[o.NUMERICIDENTIFIERLOOSE]})\\.(${i[o.NUMERICIDENTIFIERLOOSE]})\\.(${i[o.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${i[o.NUMERICIDENTIFIER]}|${i[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${i[o.NUMERICIDENTIFIERLOOSE]}|${i[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${i[o.PRERELEASEIDENTIFIER]}(?:\\.${i[o.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${i[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${i[o.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER","[0-9A-Za-z-]+"),h("BUILD",`(?:\\+(${i[o.BUILDIDENTIFIER]}(?:\\.${i[o.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${i[o.MAINVERSION]}${i[o.PRERELEASE]}?${i[o.BUILD]}?`),h("FULL",`^${i[o.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${i[o.MAINVERSIONLOOSE]}${i[o.PRERELEASELOOSE]}?${i[o.BUILD]}?`),h("LOOSE",`^${i[o.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${i[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${i[o.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${i[o.XRANGEIDENTIFIER]})(?:\\.(${i[o.XRANGEIDENTIFIER]})(?:\\.(${i[o.XRANGEIDENTIFIER]})(?:${i[o.PRERELEASE]})?${i[o.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${i[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${i[o.XRANGEIDENTIFIERLOOSE]})(?:${i[o.PRERELEASELOOSE]})?${i[o.BUILD]}?)?)?`),h("XRANGE",`^${i[o.GTLT]}\\s*${i[o.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${i[o.GTLT]}\\s*${i[o.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${r}})(?:\\.(\\d{1,${r}}))?(?:\\.(\\d{1,${r}}))?(?:$|[^\\d])`),h("COERCERTL",i[o.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${i[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${i[o.LONETILDE]}${i[o.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${i[o.LONETILDE]}${i[o.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${i[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${i[o.LONECARET]}${i[o.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${i[o.LONECARET]}${i[o.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${i[o.GTLT]}\\s*(${i[o.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${i[o.GTLT]}\\s*(${i[o.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${i[o.GTLT]}\\s*(${i[o.LOOSEPLAIN]}|${i[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${i[o.XRANGEPLAIN]})\\s+-\\s+(${i[o.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${i[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${i[o.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(Y,Y.exports);const J=["includePrerelease","loose","rtl"];var K=e=>e?"object"!=typeof e?{loose:!0}:J.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const Q=/^[0-9]+$/,ee=(e,t)=>{const r=Q.test(e),n=Q.test(t);return r&&n&&(e=+e,t=+t),e===t?0:r&&!n?-1:n&&!r?1:e<t?-1:1};var te={compareIdentifiers:ee,rcompareIdentifiers:(e,t)=>ee(t,e)};const re=Z,{MAX_LENGTH:ne,MAX_SAFE_INTEGER:se}=W,{re:ie,t:oe}=Y.exports,ae=K,{compareIdentifiers:he}=te;class ce{constructor(e,t){if(t=ae(t),e instanceof ce){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>ne)throw new TypeError(`version is longer than ${ne} characters`);re("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const r=e.trim().match(t.loose?ie[oe.LOOSE]:ie[oe.FULL]);if(!r)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+r[1],this.minor=+r[2],this.patch=+r[3],this.major>se||this.major<0)throw new TypeError("Invalid major version");if(this.minor>se||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>se||this.patch<0)throw new TypeError("Invalid patch version");r[4]?this.prerelease=r[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<se)return t}return e})):this.prerelease=[],this.build=r[5]?r[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(re("SemVer.compare",this.version,this.options,e),!(e instanceof ce)){if("string"==typeof e&&e===this.version)return 0;e=new ce(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof ce||(e=new ce(e,this.options)),he(this.major,e.major)||he(this.minor,e.minor)||he(this.patch,e.patch)}comparePre(e){if(e instanceof ce||(e=new ce(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const r=this.prerelease[t],n=e.prerelease[t];if(re("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return he(r,n)}while(++t)}compareBuild(e){e instanceof ce||(e=new ce(e,this.options));let t=0;do{const r=this.build[t],n=e.build[t];if(re("prerelease compare",t,r,n),void 0===r&&void 0===n)return 0;if(void 0===n)return 1;if(void 0===r)return-1;if(r!==n)return he(r,n)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}const le=ce;const pe=(e,t,r)=>new le(e,r).compare(new le(t,r));var ue=(e,t,r)=>pe(e,t,r)>0;function Ee(t){return e.createHash("sha256").update(t).digest("hex")}function fe(e,t){return"function"==typeof e?e(t):!(!e||!Array.isArray(e)||0===e.length)&&new RegExp(e.reduce((function(e,t){return e+"|"+y.makeRe(t).source}),"").substring(1)).test(t)}function de(e,n){var s,i;void 0===n&&(n={});var o,a=r.statSync(e),h=t.basename(e);return a.isFile()?fe(null===(s=null==n?void 0:n.files)||void 0===s?void 0:s.exclude,h)?null:((o=new H).name=h,o.hash=Ee(r.readFileSync(e)),o):a.isDirectory()?fe(null===(i=null==n?void 0:n.folders)||void 0===i?void 0:i.exclude,h)?null:((o=new V).name=h,o.children=r.readdirSync(e).map((function(r){return de(t.join(e,r),n)})).filter((function(e){return null!==e})),o.hash=Ee(o.children.map((function(e){return e.hash})).join("")),o):null}function ge(e){e&&e.children&&(e.childrenObject=e.children.reduce((function(e,t){return t.children&&ge(t),e[t.name]=t,e}),{}))}function Ie(e,t,r,n){return void 0===r&&(r=new z),void 0===n&&(n="."),t.hash===e.hash||(t.children?t.children.forEach((function(t){t=t,e.childrenObject&&e.childrenObject[t.name]?Ie(e.childrenObject[t.name],t,r,n+"/"+t.name):me(t,n+"/"+t.name,r.added)})):r.changed.push({filePath:n,hash:t.hash})),r}function me(e,t,r){e.children?e.children.forEach((function(e){me(e,t+"/"+e.name,r)})):r.push({filePath:t,hash:e.hash})}function Re(e,t){return new Promise((function(s,i){var o=n.createGzip(),a=r.createWriteStream(t),h=r.createReadStream(e);h.on("close",s),h.on("error",i),a.on("error",i),h.pipe(o).pipe(a)}))}function Ne(t,s,i,o){return new Promise((function(a,h){if(r.existsSync(i)&&Ee(r.readFileSync(i))===t)a(!0);else{var c=e.createHash("sha256"),l=n.createGunzip(),p=r.createWriteStream(i);o(s).then((function(e){e.pipe(l)}),(function(e){h(e)})),l.on("error",(function(e){l.close(),p.close(),c.destroy(),h(e)})),l.on("data",(function(e){c.write(e),p.write(e)})),l.on("end",(function(){c.digest("hex")!==t?(c.destroy(),h(new Error("下载文件出错"))):a(!0)}))}}))}exports.DiffVersionHashResult=z,exports.DiffVersionHashResultItem=B,exports.HashedFile=H,exports.HashedFolder=V,exports.UpdateInfo=q,exports.diffVersionHash=Ie,exports.gzip=Re,exports.handleHashedFolderChildrenToObject=ge,exports.hash256=Ee,exports.hashElement=de,exports.pushdiffVersionHashResult=me,exports.reduceGlobPatterns=fe,exports.updateElectron=function(e,n,i,h,c,l,p,u,E){return void 0===E&&(E={files:{}}),o(this,void 0,void 0,(function(){var o,f,d,g,I;return a(this,(function(a){switch(a.label){case 0:o=t.dirname(i),f=new q,r.existsSync(h)||r.mkdirSync(h),a.label=1;case 1:return a.trys.push([1,5,,6]),ue(l.version,n)?(f.status="downloading",ge(d=de(o,E)),g=Ie(d,l.hash),r.writeFileSync(t.join(h,c+".json"),JSON.stringify(g,null,2)),console.log(g),e(f),p.endsWith("/")||(p+="/"),[4,Promise.all(g.changed.map((function(e){return Ne(e.hash,"".concat(p,"/").concat(e.hash,".gz?time=").concat((new Date).getTime()),t.join(h,e.hash),u)})))]):[3,4];case 2:return a.sent(),[4,Promise.all(g.added.map((function(e){return Ne(e.hash,"".concat(p,"/").concat(e.hash,".gz?time=").concat((new Date).getTime()),t.join(h,e.hash),u)})))];case 3:a.sent(),console.log("complete"),f.status="finished",e(f),s.spawn("updater",{detached:!0,env:{exe_path:i,update_temp_path:h,update_config_file_name:c+".json"},stdio:"ignore"}),a.label=4;case 4:return[3,6];case 5:return I=a.sent(),console.log(I),f.status="failed",f.message=I,e(f),[3,6];case 6:return[2]}}))}))},exports.zipHashElement=function e(r,n,s){return o(this,void 0,void 0,(function(){var i;return a(this,(function(o){switch(o.label){case 0:if(!r.children)return[3,5];i=0,o.label=1;case 1:return i<r.children.length?[4,e(r.children[i],n+"/"+r.name,s)]:[3,4];case 2:o.sent(),o.label=3;case 3:return i++,[3,1];case 4:return[3,7];case 5:return[4,Re(n+"/"+r.name,t.join(s,r.hash+".gz"))];case 6:o.sent(),o.label=7;case 7:return[2]}}))}))};
