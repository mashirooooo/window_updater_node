"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crypto"),t=require("path"),s=require("fs"),i=require("zlib"),r=require("child_process");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function n(e,t,s,i){return new(s||(s=Promise))((function(r,n){function o(e){try{h(i.next(e))}catch(e){n(e)}}function a(e){try{h(i.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?r(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}h((i=i.apply(e,t||[])).next())}))}var o="object"==typeof process&&process&&"win32"===process.platform?{sep:"\\"}:{sep:"/"},a=h;function h(e,t,s){e instanceof RegExp&&(e=l(e,s)),t instanceof RegExp&&(t=l(t,s));var i=c(e,t,s);return i&&{start:i[0],end:i[1],pre:s.slice(0,i[0]),body:s.slice(i[0]+e.length,i[1]),post:s.slice(i[1]+t.length)}}function l(e,t){var s=t.match(e);return s?s[0]:null}function c(e,t,s){var i,r,n,o,a,h=s.indexOf(e),l=s.indexOf(t,h+1),c=h;if(h>=0&&l>0){if(e===t)return[h,l];for(i=[],n=s.length;c>=0&&!a;)c==h?(i.push(c),h=s.indexOf(e,c+1)):1==i.length?a=[i.pop(),l]:((r=i.pop())<n&&(n=r,o=l),l=s.indexOf(t,c+1)),c=h<l&&h>=0?h:l;i.length&&(a=[n,o])}return a}h.range=c;var p=a,u=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return L(function(e){return e.split("\\\\").join(d).split("\\{").join(f).split("\\}").join(m).split("\\,").join(g).split("\\.").join(E)}(e),!0).map($)},d="\0SLASH"+Math.random()+"\0",f="\0OPEN"+Math.random()+"\0",m="\0CLOSE"+Math.random()+"\0",g="\0COMMA"+Math.random()+"\0",E="\0PERIOD"+Math.random()+"\0";function v(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function $(e){return e.split(d).join("\\").split(f).join("{").split(m).join("}").split(g).join(",").split(E).join(".")}function w(e){if(!e)return[""];var t=[],s=p("{","}",e);if(!s)return e.split(",");var i=s.pre,r=s.body,n=s.post,o=i.split(",");o[o.length-1]+="{"+r+"}";var a=w(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function R(e){return"{"+e+"}"}function I(e){return/^-?0\d/.test(e)}function y(e,t){return e<=t}function S(e,t){return e>=t}function L(e,t){var s=[],i=p("{","}",e);if(!i)return[e];var r=i.pre,n=i.post.length?L(i.post,!1):[""];if(/\$$/.test(i.pre))for(var o=0;o<n.length;o++){var a=r+"{"+i.body+"}"+n[o];s.push(a)}else{var h,l,c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(i.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(i.body),d=c||u,f=i.body.indexOf(",")>=0;if(!d&&!f)return i.post.match(/,.*\}/)?L(e=i.pre+"{"+i.body+m+i.post):[e];if(d)h=i.body.split(/\.\./);else if(1===(h=w(i.body)).length&&1===(h=L(h[0],!1).map(R)).length)return n.map((function(e){return i.pre+h[0]+e}));if(d){var g=v(h[0]),E=v(h[1]),$=Math.max(h[0].length,h[1].length),O=3==h.length?Math.abs(v(h[2])):1,A=y;E<g&&(O*=-1,A=S);var T=h.some(I);l=[];for(var b=g;A(b,E);b+=O){var N;if(u)"\\"===(N=String.fromCharCode(b))&&(N="");else if(N=String(b),T){var x=$-N.length;if(x>0){var C=new Array(x+1).join("0");N=b<0?"-"+C+N.slice(1):C+N}}l.push(N)}}else{l=[];for(var k=0;k<h.length;k++)l.push.apply(l,L(h[k],!1))}for(k=0;k<l.length;k++)for(o=0;o<n.length;o++){a=r+l[k]+n[o];(!t||d||a)&&s.push(a)}}return s}const O=A=(e,t,s={})=>(j(t),!(!s.nocomment&&"#"===t.charAt(0))&&new D(t,s).match(e));var A=O;const T=o;O.sep=T.sep;const b=Symbol("globstar **");O.GLOBSTAR=b;const N=u,x={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},C=e=>e.split("").reduce(((e,t)=>(e[t]=!0,e)),{}),k=C("().*{}+?[]^$\\!"),_=C("[.("),z=/\/+/;O.filter=(e,t={})=>(s,i,r)=>O(s,e,t);const P=(e,t={})=>{const s={};return Object.keys(e).forEach((t=>s[t]=e[t])),Object.keys(t).forEach((e=>s[e]=t[e])),s};O.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return O;const t=O,s=(s,i,r)=>t(s,i,P(e,r));return(s.Minimatch=class extends t.Minimatch{constructor(t,s){super(t,P(e,s))}}).defaults=s=>t.defaults(P(e,s)).Minimatch,s.filter=(s,i)=>t.filter(s,P(e,i)),s.defaults=s=>t.defaults(P(e,s)),s.makeRe=(s,i)=>t.makeRe(s,P(e,i)),s.braceExpand=(s,i)=>t.braceExpand(s,P(e,i)),s.match=(s,i,r)=>t.match(s,i,P(e,r)),s},O.braceExpand=(e,t)=>M(e,t);const M=(e,t={})=>(j(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:N(e)),j=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},F=Symbol("subparse");O.makeRe=(e,t)=>new D(e,t||{}).makeRe(),O.match=(e,t,s={})=>{const i=new D(t,s);return e=e.filter((e=>i.match(e))),i.options.nonull&&!e.length&&e.push(t),e};class D{constructor(e,t){j(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();let s=this.globSet=this.braceExpand();t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,s),s=this.globParts=s.map((e=>e.split(z))),this.debug(this.pattern,s),s=s.map(((e,t,s)=>e.map(this.parse,this))),this.debug(this.pattern,s),s=s.filter((e=>-1===e.indexOf(!1))),this.debug(this.pattern,s),this.set=s}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let i=0;i<e.length&&"!"===e.charAt(i);i++)t=!t,s++;s&&(this.pattern=e.substr(s)),this.negate=t}matchOne(e,t,s){var i=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var r=0,n=0,o=e.length,a=t.length;r<o&&n<a;r++,n++){this.debug("matchOne loop");var h,l=t[n],c=e[r];if(this.debug(t,l,c),!1===l)return!1;if(l===b){this.debug("GLOBSTAR",[t,l,c]);var p=r,u=n+1;if(u===a){for(this.debug("** at the end");r<o;r++)if("."===e[r]||".."===e[r]||!i.dot&&"."===e[r].charAt(0))return!1;return!0}for(;p<o;){var d=e[p];if(this.debug("\nglobstar while",e,p,t,u,d),this.matchOne(e.slice(p),t.slice(u),s))return this.debug("globstar found match!",p,o,d),!0;if("."===d||".."===d||!i.dot&&"."===d.charAt(0)){this.debug("dot detected!",e,p,t,u);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!s||(this.debug("\n>>> no match, partial?",e,p,t,u),p!==o))}if("string"==typeof l?(h=c===l,this.debug("string match",l,c,h)):(h=c.match(l),this.debug("pattern match",l,c,h)),!h)return!1}if(r===o&&n===a)return!0;if(r===o)return s;if(n===a)return r===o-1&&""===e[r];throw new Error("wtf?")}braceExpand(){return M(this.pattern,this.options)}parse(e,t){j(e);const s=this.options;if("**"===e){if(!s.noglobstar)return b;e="*"}if(""===e)return"";let i="",r=!!s.nocase,n=!1;const o=[],a=[];let h,l,c,p,u=!1,d=-1,f=-1;const m="."===e.charAt(0)?"":s.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=()=>{if(h){switch(h){case"*":i+="[^/]*?",r=!0;break;case"?":i+="[^/]",r=!0;break;default:i+="\\"+h}this.debug("clearStateChar %j %j",h,i),h=!1}};for(let t,m=0;m<e.length&&(t=e.charAt(m));m++)if(this.debug("%s\t%s %s %j",e,m,i,t),n){if("/"===t)return!1;k[t]&&(i+="\\"),i+=t,n=!1}else switch(t){case"/":return!1;case"\\":g(),n=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,m,i,t),u){this.debug("  in class"),"!"===t&&m===f+1&&(t="^"),i+=t;continue}this.debug("call clearStateChar %j",h),g(),h=t,s.noext&&g();continue;case"(":if(u){i+="(";continue}if(!h){i+="\\(";continue}o.push({type:h,start:m-1,reStart:i.length,open:x[h].open,close:x[h].close}),i+="!"===h?"(?:(?!(?:":"(?:",this.debug("plType %j %j",h,i),h=!1;continue;case")":if(u||!o.length){i+="\\)";continue}g(),r=!0,c=o.pop(),i+=c.close,"!"===c.type&&a.push(c),c.reEnd=i.length;continue;case"|":if(u||!o.length){i+="\\|";continue}g(),i+="|";continue;case"[":if(g(),u){i+="\\"+t;continue}u=!0,f=m,d=i.length,i+=t;continue;case"]":if(m===f+1||!u){i+="\\"+t;continue}l=e.substring(f+1,m);try{RegExp("["+l+"]")}catch(e){p=this.parse(l,F),i=i.substr(0,d)+"\\["+p[0]+"\\]",r=r||p[1],u=!1;continue}r=!0,u=!1,i+=t;continue;default:g(),!k[t]||"^"===t&&u||(i+="\\"),i+=t}for(u&&(l=e.substr(f+1),p=this.parse(l,F),i=i.substr(0,d)+"\\["+p[0],r=r||p[1]),c=o.pop();c;c=o.pop()){let e;e=i.slice(c.reStart+c.open.length),this.debug("setting tail",i,c),e=e.replace(/((?:\\{2}){0,64})(\\?)\|/g,((e,t,s)=>(s||(s="\\"),t+t+s+"|"))),this.debug("tail=%j\n   %s",e,e,c,i);const t="*"===c.type?"[^/]*?":"?"===c.type?"[^/]":"\\"+c.type;r=!0,i=i.slice(0,c.reStart)+t+"\\("+e}g(),n&&(i+="\\\\");const E=_[i.charAt(0)];for(let e=a.length-1;e>-1;e--){const s=a[e],r=i.slice(0,s.reStart),n=i.slice(s.reStart,s.reEnd-8);let o=i.slice(s.reEnd);const h=i.slice(s.reEnd-8,s.reEnd)+o,l=r.split("(").length-1;let c=o;for(let e=0;e<l;e++)c=c.replace(/\)[+*?]?/,"");o=c;i=r+n+o+(""===o&&t!==F?"$":"")+h}if(""!==i&&r&&(i="(?=.)"+i),E&&(i=m+i),t===F)return[i,r];if(!r)return e.replace(/\\(.)/g,"$1");const v=s.nocase?"i":"";try{return Object.assign(new RegExp("^"+i+"$",v),{_glob:e,_src:i})}catch(e){return new RegExp("$.")}}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",i=t.nocase?"i":"";let r=e.map((e=>(e=e.map((e=>"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===b?b:e._src)).reduce(((e,t)=>(e[e.length-1]===b&&t===b||e.push(t),e)),[]),e.forEach(((t,i)=>{t===b&&e[i-1]!==b&&(0===i?e.length>1?e[i+1]="(?:\\/|"+s+"\\/)?"+e[i+1]:e[i]=s:i===e.length-1?e[i-1]+="(?:\\/|"+s+")?":(e[i-1]+="(?:\\/|\\/"+s+"\\/)"+e[i+1],e[i+1]=b))})),e.filter((e=>e!==b)).join("/")))).join("|");r="^(?:"+r+")$",this.negate&&(r="^(?!"+r+").*$");try{this.regexp=new RegExp(r,i)}catch(e){this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const s=this.options;"/"!==T.sep&&(e=e.split(T.sep).join("/")),e=e.split(z),this.debug(this.pattern,"split",e);const i=this.set;let r;this.debug(this.pattern,"set",i);for(let t=e.length-1;t>=0&&(r=e[t],!r);t--);for(let n=0;n<i.length;n++){const o=i[n];let a=e;s.matchBase&&1===o.length&&(a=[r]);if(this.matchOne(a,o,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return O.defaults(e).Minimatch}}O.Minimatch=D;class U{}class G extends U{}class H{constructor(){this.added=[],this.changed=[]}}class X{constructor(){this.status="init",this.message=""}}var B;exports.UpdateStatus=void 0,(B=exports.UpdateStatus||(exports.UpdateStatus={}))[B.HaveNothingUpdate=0]="HaveNothingUpdate",B[B.Success=1]="Success",B[B.Failed=2]="Failed";var V="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var W={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16},q={exports:{}};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:s}=W,i=V,r=(t=e.exports={}).re=[],n=t.src=[],o=t.t={};let a=0;const h=(e,t,s)=>{const h=a++;i(e,h,t),o[e]=h,n[h]=t,r[h]=new RegExp(t,s?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","[0-9]+"),h("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),h("MAINVERSION",`(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${n[o.NUMERICIDENTIFIER]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${n[o.NUMERICIDENTIFIERLOOSE]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${n[o.PRERELEASEIDENTIFIER]}(?:\\.${n[o.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${n[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[o.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER","[0-9A-Za-z-]+"),h("BUILD",`(?:\\+(${n[o.BUILDIDENTIFIER]}(?:\\.${n[o.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${n[o.MAINVERSION]}${n[o.PRERELEASE]}?${n[o.BUILD]}?`),h("FULL",`^${n[o.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${n[o.MAINVERSIONLOOSE]}${n[o.PRERELEASELOOSE]}?${n[o.BUILD]}?`),h("LOOSE",`^${n[o.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${n[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${n[o.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:${n[o.PRERELEASE]})?${n[o.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:${n[o.PRERELEASELOOSE]})?${n[o.BUILD]}?)?)?`),h("XRANGE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?(?:$|[^\\d])`),h("COERCERTL",n[o.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${n[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${n[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${n[o.LONECARET]}${n[o.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${n[o.LONECARET]}${n[o.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${n[o.GTLT]}\\s*(${n[o.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]}|${n[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${n[o.XRANGEPLAIN]})\\s+-\\s+(${n[o.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${n[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[o.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(q,q.exports);const Y=["includePrerelease","loose","rtl"];var J=e=>e?"object"!=typeof e?{loose:!0}:Y.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const Z=/^[0-9]+$/,Q=(e,t)=>{const s=Z.test(e),i=Z.test(t);return s&&i&&(e=+e,t=+t),e===t?0:s&&!i?-1:i&&!s?1:e<t?-1:1};var K={compareIdentifiers:Q,rcompareIdentifiers:(e,t)=>Q(t,e)};const ee=V,{MAX_LENGTH:te,MAX_SAFE_INTEGER:se}=W,{re:ie,t:re}=q.exports,ne=J,{compareIdentifiers:oe}=K;class ae{constructor(e,t){if(t=ne(t),e instanceof ae){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>te)throw new TypeError(`version is longer than ${te} characters`);ee("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const s=e.trim().match(t.loose?ie[re.LOOSE]:ie[re.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>se||this.major<0)throw new TypeError("Invalid major version");if(this.minor>se||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>se||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<se)return t}return e})):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ee("SemVer.compare",this.version,this.options,e),!(e instanceof ae)){if("string"==typeof e&&e===this.version)return 0;e=new ae(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof ae||(e=new ae(e,this.options)),oe(this.major,e.major)||oe(this.minor,e.minor)||oe(this.patch,e.patch)}comparePre(e){if(e instanceof ae||(e=new ae(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const s=this.prerelease[t],i=e.prerelease[t];if(ee("prerelease compare",t,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return oe(s,i)}while(++t)}compareBuild(e){e instanceof ae||(e=new ae(e,this.options));let t=0;do{const s=this.build[t],i=e.build[t];if(ee("prerelease compare",t,s,i),void 0===s&&void 0===i)return 0;if(void 0===i)return 1;if(void 0===s)return-1;if(s!==i)return oe(s,i)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var he=ae;const le=he;var ce=(e,t,s)=>new le(e,s).compare(new le(t,s));const pe=ce;var ue=(e,t,s)=>pe(e,t,s)>0;function de(t){return e.createHash("sha256").update(t).digest("hex")}function fe(e,t){if("function"==typeof e)return e(t);if(e&&Array.isArray(e)&&0!==e.length){return new RegExp(e.reduce(((e,t)=>e+"|"+A.makeRe(t).source),"").substring(1)).test(t)}return!1}function me(e,i={}){var r,n;const o=s.statSync(e),a=t.basename(e);if(o.isFile()){if(fe(null===(r=null==i?void 0:i.files)||void 0===r?void 0:r.exclude,a))return null;const t=new U;return t.name=a,t.hash=de(s.readFileSync(e)),t}if(o.isDirectory()){if(fe(null===(n=null==i?void 0:i.folders)||void 0===n?void 0:n.exclude,a))return null;const r=new G;return r.name=a,r.children=s.readdirSync(e).map((s=>me(t.join(e,s),i))).filter((e=>null!==e)),r.hash=de(r.children.map((e=>e.hash)).join("")),r}return null}function ge(e){e&&e.children&&(e.childrenObject=e.children.reduce(((e,t)=>(t.children&&ge(t),e[t.name]=t,e)),{}))}function Ee(e,t,s=new H,i="."){return t.hash===e.hash||(t.children?t.children.forEach((t=>{t=t,e.childrenObject&&e.childrenObject[t.name]?Ee(e.childrenObject[t.name],t,s,i+"/"+t.name):ve(t,i+"/"+t.name,s.added)})):s.changed.push({filePath:i,hash:t.hash})),s}function ve(e,t,s){e.children?e.children.forEach((e=>{ve(e,t+"/"+e.name,s)})):s.push({filePath:t,hash:e.hash})}function $e(e,t){return new Promise(((r,n)=>{const o=i.createGzip(),a=s.createWriteStream(t),h=s.createReadStream(e);h.on("close",r),h.on("error",n),a.on("error",n),h.pipe(o).pipe(a)}))}function we(t,r,n,o){return new Promise(((a,h)=>{if(s.existsSync(n)&&de(s.readFileSync(n))===t)a(!0);else{const l=e.createHash("sha256"),c=i.createGunzip(),p=s.createWriteStream(n);o(r).then((e=>{e.pipe(c)}),(e=>{h(e)})),c.on("error",(e=>{c.close(),p.close(),l.destroy(),h(e)})),c.on("data",(e=>{l.write(e),p.write(e)})),c.on("end",(()=>{l.digest("hex")!==t?(l.destroy(),h(new Error("下载文件出错"))):a(!0)}))}}))}function Re(e,t){return new Promise((i=>{s.stat(e,((s,r)=>{var n;i(!s&&(r.isFile()&&(null===(n=me(e))||void 0===n?void 0:n.hash)===t))}))}))}const{MAX_LENGTH:Ie}=W,{re:ye,t:Se}=q.exports,Le=he,Oe=J;var Ae=(e,t)=>{if(t=Oe(t),e instanceof Le)return e;if("string"!=typeof e)return null;if(e.length>Ie)return null;if(!(t.loose?ye[Se.LOOSE]:ye[Se.FULL]).test(e))return null;try{return new Le(e,t)}catch(e){return null}};const Te=Ae;var be=(e,t)=>{const s=Te(e,t);return s?s.version:null};const Ne=Ae;var xe=(e,t)=>{const s=Ne(e.trim().replace(/^[=v]+/,""),t);return s?s.version:null};const Ce=he;var ke=(e,t,s,i)=>{"string"==typeof s&&(i=s,s=void 0);try{return new Ce(e,s).inc(t,i).version}catch(e){return null}};const _e=ce;var ze=(e,t,s)=>0===_e(e,t,s);const Pe=Ae,Me=ze;var je=(e,t)=>{if(Me(e,t))return null;{const s=Pe(e),i=Pe(t),r=s.prerelease.length||i.prerelease.length,n=r?"pre":"",o=r?"prerelease":"";for(const e in s)if(("major"===e||"minor"===e||"patch"===e)&&s[e]!==i[e])return n+e;return o}};const Fe=he;var De=(e,t)=>new Fe(e,t).major;const Ue=he;var Ge=(e,t)=>new Ue(e,t).minor;const He=he;var Xe=(e,t)=>new He(e,t).patch;const Be=Ae;var Ve=(e,t)=>{const s=Be(e,t);return s&&s.prerelease.length?s.prerelease:null};const We=ce;var qe=(e,t,s)=>We(t,e,s);const Ye=ce;var Je=(e,t)=>Ye(e,t,!0);const Ze=he;var Qe=(e,t,s)=>{const i=new Ze(e,s),r=new Ze(t,s);return i.compare(r)||i.compareBuild(r)};const Ke=Qe;var et=(e,t)=>e.sort(((e,s)=>Ke(e,s,t)));const tt=Qe;var st=(e,t)=>e.sort(((e,s)=>tt(s,e,t)));const it=ce;var rt=(e,t,s)=>it(e,t,s)<0;const nt=ce;var ot=(e,t,s)=>0!==nt(e,t,s);const at=ce;var ht=(e,t,s)=>at(e,t,s)>=0;const lt=ce;var ct=(e,t,s)=>lt(e,t,s)<=0;const pt=ze,ut=ot,dt=ue,ft=ht,mt=rt,gt=ct;var Et=(e,t,s,i)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e===s;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e!==s;case"":case"=":case"==":return pt(e,s,i);case"!=":return ut(e,s,i);case">":return dt(e,s,i);case">=":return ft(e,s,i);case"<":return mt(e,s,i);case"<=":return gt(e,s,i);default:throw new TypeError(`Invalid operator: ${t}`)}};const vt=he,$t=Ae,{re:wt,t:Rt}=q.exports;var It=(e,t)=>{if(e instanceof vt)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let s=null;if((t=t||{}).rtl){let t;for(;(t=wt[Rt.COERCERTL].exec(e))&&(!s||s.index+s[0].length!==e.length);)s&&t.index+t[0].length===s.index+s[0].length||(s=t),wt[Rt.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;wt[Rt.COERCERTL].lastIndex=-1}else s=e.match(wt[Rt.COERCE]);return null===s?null:$t(`${s[2]}.${s[3]||"0"}.${s[4]||"0"}`,t)};const yt="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,St="undefined"!=typeof AbortController?AbortController:Object.assign(class{constructor(){this.signal=new St.AbortSignal}abort(){this.signal.aborted=!0}},{AbortSignal:class{constructor(){this.aborted=!1}}}),Lt=new Set,Ot=(e,t)=>{const s=`LRU_CACHE_OPTION_${e}`;bt(s)&&Nt(s,`${e} option`,`options.${t}`,zt)},At=(e,t)=>{const s=`LRU_CACHE_METHOD_${e}`;if(bt(s)){const{prototype:i}=zt,{get:r}=Object.getOwnPropertyDescriptor(i,e);Nt(s,`${e} method`,`cache.${t}()`,r)}},Tt=(...e)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...e):console.error(...e)},bt=e=>!Lt.has(e),Nt=(e,t,s,i)=>{Lt.add(e);Tt(`The ${t} is deprecated. Please use ${s} instead.`,"DeprecationWarning",e,i)},xt=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),Ct=e=>xt(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?kt:null:null;class kt extends Array{constructor(e){super(e),this.fill(0)}}class _t{constructor(e){const t=e?Ct(e):Array;this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class zt{constructor(e={}){const{max:t=0,ttl:s,ttlResolution:i=1,ttlAutopurge:r,updateAgeOnGet:n,updateAgeOnHas:o,allowStale:a,dispose:h,disposeAfter:l,noDisposeOnSet:c,noUpdateTTL:p,maxSize:u=0,sizeCalculation:d,fetchMethod:f}=e,{length:m,maxAge:g,stale:E}=e instanceof zt?{}:e;if(0!==t&&!xt(t))throw new TypeError("max option must be a nonnegative integer");const v=t?Ct(t):Array;if(!v)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=u,this.sizeCalculation=d||m,this.sizeCalculation){if(!this.maxSize)throw new TypeError("cannot set sizeCalculation without setting maxSize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=f||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new v(t),this.prev=new v(t),this.head=0,this.tail=0,this.free=new _t(t),this.initialFill=1,this.size=0,"function"==typeof h&&(this.dispose=h),"function"==typeof l?(this.disposeAfter=l,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!c,this.noUpdateTTL=!!p,0!==this.maxSize){if(!xt(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!a||!!E,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!o,this.ttlResolution=xt(i)||0===i?i:1,this.ttlAutopurge=!!r,this.ttl=s||g||0,this.ttl){if(!xt(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(bt(e)){Lt.add(e);Tt("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,zt)}}E&&Ot("stale","allowStale"),g&&Ot("maxAge","ttl"),m&&Ot("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new kt(this.max),this.starts=new kt(this.max),this.setItemTTL=(e,t)=>{if(this.starts[e]=0!==t?yt.now():0,this.ttls[e]=t,0!==t&&this.ttlAutopurge){const s=setTimeout((()=>{this.isStale(e)&&this.delete(this.keyList[e])}),t+1);s.unref&&s.unref()}},this.updateItemAge=e=>{this.starts[e]=0!==this.ttls[e]?yt.now():0};let e=0;const t=()=>{const t=yt.now();if(this.ttlResolution>0){e=t;const s=setTimeout((()=>e=0),this.ttlResolution);s.unref&&s.unref()}return t};this.getRemainingTTL=s=>{const i=this.keyMap.get(s);return void 0===i?0:0===this.ttls[i]||0===this.starts[i]?1/0:this.starts[i]+this.ttls[i]-(e||t())},this.isStale=s=>0!==this.ttls[s]&&0!==this.starts[s]&&(e||t())-this.starts[s]>this.ttls[s]}updateItemAge(e){}setItemTTL(e,t){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new kt(this.max),this.removeItemSize=e=>this.calculatedSize-=this.sizes[e],this.requireSize=(e,t,s,i)=>{if(!xt(s)){if(!i)throw new TypeError("invalid size value (must be positive integer)");if("function"!=typeof i)throw new TypeError("sizeCalculation must be a function");if(s=i(t,e),!xt(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s},this.addItemSize=(e,t,s,i)=>{this.sizes[e]=i;const r=this.maxSize-this.sizes[e];for(;this.calculatedSize>r;)this.evict();this.calculatedSize+=this.sizes[e]},this.delete=e=>{if(0!==this.size){const t=this.keyMap.get(e);void 0!==t&&(this.calculatedSize-=this.sizes[t])}return zt.prototype.delete.call(this,e)}}removeItemSize(e){}addItemSize(e,t,s,i){}requireSize(e,t,s,i){if(s||i)throw new TypeError("cannot set size without setting maxSize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())yield[this.keyList[e],this.valList[e]]}*rentries(){for(const e of this.rindexes())yield[this.keyList[e],this.valList[e]]}*keys(){for(const e of this.indexes())yield this.keyList[e]}*rkeys(){for(const e of this.rindexes())yield this.keyList[e]}*values(){for(const e of this.indexes())yield this.valList[e]}*rvalues(){for(const e of this.rindexes())yield this.valList[e]}[Symbol.iterator](){return this.entries()}find(e,t={}){for(const s of this.indexes())if(e(this.valList[s],this.keyList[s],this))return this.get(this.keyList[s],t)}forEach(e,t=this){for(const s of this.indexes())e.call(t,this.valList[s],this.keyList[s],this)}rforEach(e,t=this){for(const s of this.rindexes())e.call(t,this.valList[s],this.keyList[s],this)}get prune(){return At("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const e=[];for(const t of this.indexes()){const s=this.keyList[t],i={value:this.valList[t]};this.ttls&&(i.ttl=this.ttls[t]),this.sizes&&(i.size=this.sizes[t]),e.unshift([s,i])}return e}load(e){this.clear();for(const[t,s]of e)this.set(t,s.value,s)}dispose(e,t,s){}set(e,t,{ttl:s=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:r=0,sizeCalculation:n=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL}={}){r=this.requireSize(e,t,r,n);let a=0===this.size?void 0:this.keyMap.get(e);if(void 0===a)a=this.newIndex(),this.keyList[a]=e,this.valList[a]=t,this.keyMap.set(e,a),this.next[this.tail]=a,this.prev[a]=this.tail,this.tail=a,this.size++,this.addItemSize(a,t,e,r),o=!1;else{const s=this.valList[a];t!==s&&(this.isBackgroundFetch(s)?s.__abortController.abort():i||(this.dispose(s,e,"set"),this.disposeAfter&&this.disposed.push([s,e,"set"])),this.removeItemSize(a),this.valList[a]=t,this.addItemSize(a,t,e,r)),this.moveToTail(a)}if(0===s||0!==this.ttl||this.ttls||this.initializeTTLTracking(),o||this.setItemTTL(a,s),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max?this.evict():0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(),e}}evict(){const e=this.head,t=this.keyList[e],s=this.valList[e];return this.isBackgroundFetch(s)?s.__abortController.abort():(this.dispose(s,t,"evict"),this.disposeAfter&&this.disposed.push([s,t,"evict"])),this.removeItemSize(e),this.head=this.next[e],this.keyMap.delete(t),this.size--,e}has(e,{updateAgeOnHas:t=this.updateAgeOnHas}={}){const s=this.keyMap.get(e);return void 0!==s&&!this.isStale(s)&&(t&&this.updateItemAge(s),!0)}peek(e,{allowStale:t=this.allowStale}={}){const s=this.keyMap.get(e);if(void 0!==s&&(t||!this.isStale(s)))return this.valList[s]}backgroundFetch(e,t,s){const i=void 0===t?void 0:this.valList[t];if(this.isBackgroundFetch(i))return i;const r=new St,n={signal:r.signal,options:s},o=Promise.resolve(this.fetchMethod(e,i,n)).then((t=>(r.signal.aborted||this.set(e,t,n.options),t)));return o.__abortController=r,o.__staleWhileFetching=i,void 0===t?(this.set(e,o,n.options),t=this.keyMap.get(e)):this.valList[t]=o,o}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,ttl:i=this.ttl,noDisposeOnSet:r=this.noDisposeOnSet,size:n=0,sizeCalculation:o=this.sizeCalculation,noUpdateTTL:a=this.noUpdateTTL}={}){if(!this.fetchMethod)return this.get(e,{allowStale:t,updateAgeOnGet:s});const h={allowStale:t,updateAgeOnGet:s,ttl:i,noDisposeOnSet:r,size:n,sizeCalculation:o,noUpdateTTL:a};let l=this.keyMap.get(e);if(void 0===l)return this.backgroundFetch(e,l,h);{const i=this.valList[l];if(this.isBackgroundFetch(i))return t&&void 0!==i.__staleWhileFetching?i.__staleWhileFetching:i;if(!this.isStale(l))return this.moveToTail(l),s&&this.updateItemAge(l),i;const r=this.backgroundFetch(e,l,h);return t&&void 0!==r.__staleWhileFetching?r.__staleWhileFetching:r}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet}={}){const i=this.keyMap.get(e);if(void 0!==i){const r=this.valList[i],n=this.isBackgroundFetch(r);if(this.isStale(i))return n?t?r.__staleWhileFetching:void 0:(this.delete(e),t?r:void 0);if(n)return;return this.moveToTail(i),s&&this.updateItemAge(i),r}}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return At("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const s=this.keyMap.get(e);if(void 0!==s)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(s);const t=this.valList[s];this.isBackgroundFetch(t)?t.__abortController.abort():(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[s]=null,this.valList[s]=null,s===this.tail?this.tail=this.prev[s]:s===this.head?this.head=this.next[s]:(this.next[this.prev[s]]=this.next[s],this.prev[this.next[s]]=this.prev[s]),this.size--,this.free.push(s)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort();else{const s=this.keyList[e];this.dispose(t,s,"delete"),this.disposeAfter&&this.disposed.push([t,s,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return At("reset","clear"),this.clear}get length(){return((e,t)=>{const s=`LRU_CACHE_PROPERTY_${e}`;if(bt(s)){const{prototype:i}=zt,{get:r}=Object.getOwnPropertyDescriptor(i,e);Nt(s,`${e} property`,`cache.${t}`,r)}})("length","size"),this.size}}var Pt=zt;class Mt{constructor(e,t){if(t=Dt(t),e instanceof Mt)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new Mt(e.raw,t);if(e instanceof Ut)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!Yt(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&Jt(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,s=Ft.get(t);if(s)return s;const i=this.options.loose,r=i?Xt[Bt.HYPHENRANGELOOSE]:Xt[Bt.HYPHENRANGE];e=e.replace(r,hs(this.options.includePrerelease)),Gt("hyphen replace",e),e=e.replace(Xt[Bt.COMPARATORTRIM],Vt),Gt("comparator trim",e);let n=(e=(e=(e=e.replace(Xt[Bt.TILDETRIM],Wt)).replace(Xt[Bt.CARETTRIM],qt)).split(/\s+/).join(" ")).split(" ").map((e=>Qt(e,this.options))).join(" ").split(/\s+/).map((e=>as(e,this.options)));i&&(n=n.filter((e=>(Gt("loose invalid filter",e,this.options),!!e.match(Xt[Bt.COMPARATORLOOSE]))))),Gt("range list",n);const o=new Map,a=n.map((e=>new Ut(e,this.options)));for(const e of a){if(Yt(e))return[e];o.set(e.value,e)}o.size>1&&o.has("")&&o.delete("");const h=[...o.values()];return Ft.set(t,h),h}intersects(e,t){if(!(e instanceof Mt))throw new TypeError("a Range is required");return this.set.some((s=>Zt(s,t)&&e.set.some((e=>Zt(e,t)&&s.every((s=>e.every((e=>s.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new Ht(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(ls(this.set[t],e,this.options))return!0;return!1}}var jt=Mt;const Ft=new Pt({max:1e3}),Dt=J,Ut=us,Gt=V,Ht=he,{re:Xt,t:Bt,comparatorTrimReplace:Vt,tildeTrimReplace:Wt,caretTrimReplace:qt}=q.exports,Yt=e=>"<0.0.0-0"===e.value,Jt=e=>""===e.value,Zt=(e,t)=>{let s=!0;const i=e.slice();let r=i.pop();for(;s&&i.length;)s=i.every((e=>r.intersects(e,t))),r=i.pop();return s},Qt=(e,t)=>(Gt("comp",e,t),e=ss(e,t),Gt("caret",e),e=es(e,t),Gt("tildes",e),e=rs(e,t),Gt("xrange",e),e=os(e,t),Gt("stars",e),e),Kt=e=>!e||"x"===e.toLowerCase()||"*"===e,es=(e,t)=>e.trim().split(/\s+/).map((e=>ts(e,t))).join(" "),ts=(e,t)=>{const s=t.loose?Xt[Bt.TILDELOOSE]:Xt[Bt.TILDE];return e.replace(s,((t,s,i,r,n)=>{let o;return Gt("tilde",e,t,s,i,r,n),Kt(s)?o="":Kt(i)?o=`>=${s}.0.0 <${+s+1}.0.0-0`:Kt(r)?o=`>=${s}.${i}.0 <${s}.${+i+1}.0-0`:n?(Gt("replaceTilde pr",n),o=`>=${s}.${i}.${r}-${n} <${s}.${+i+1}.0-0`):o=`>=${s}.${i}.${r} <${s}.${+i+1}.0-0`,Gt("tilde return",o),o}))},ss=(e,t)=>e.trim().split(/\s+/).map((e=>is(e,t))).join(" "),is=(e,t)=>{Gt("caret",e,t);const s=t.loose?Xt[Bt.CARETLOOSE]:Xt[Bt.CARET],i=t.includePrerelease?"-0":"";return e.replace(s,((t,s,r,n,o)=>{let a;return Gt("caret",e,t,s,r,n,o),Kt(s)?a="":Kt(r)?a=`>=${s}.0.0${i} <${+s+1}.0.0-0`:Kt(n)?a="0"===s?`>=${s}.${r}.0${i} <${s}.${+r+1}.0-0`:`>=${s}.${r}.0${i} <${+s+1}.0.0-0`:o?(Gt("replaceCaret pr",o),a="0"===s?"0"===r?`>=${s}.${r}.${n}-${o} <${s}.${r}.${+n+1}-0`:`>=${s}.${r}.${n}-${o} <${s}.${+r+1}.0-0`:`>=${s}.${r}.${n}-${o} <${+s+1}.0.0-0`):(Gt("no pr"),a="0"===s?"0"===r?`>=${s}.${r}.${n}${i} <${s}.${r}.${+n+1}-0`:`>=${s}.${r}.${n}${i} <${s}.${+r+1}.0-0`:`>=${s}.${r}.${n} <${+s+1}.0.0-0`),Gt("caret return",a),a}))},rs=(e,t)=>(Gt("replaceXRanges",e,t),e.split(/\s+/).map((e=>ns(e,t))).join(" ")),ns=(e,t)=>{e=e.trim();const s=t.loose?Xt[Bt.XRANGELOOSE]:Xt[Bt.XRANGE];return e.replace(s,((s,i,r,n,o,a)=>{Gt("xRange",e,s,i,r,n,o,a);const h=Kt(r),l=h||Kt(n),c=l||Kt(o),p=c;return"="===i&&p&&(i=""),a=t.includePrerelease?"-0":"",h?s=">"===i||"<"===i?"<0.0.0-0":"*":i&&p?(l&&(n=0),o=0,">"===i?(i=">=",l?(r=+r+1,n=0,o=0):(n=+n+1,o=0)):"<="===i&&(i="<",l?r=+r+1:n=+n+1),"<"===i&&(a="-0"),s=`${i+r}.${n}.${o}${a}`):l?s=`>=${r}.0.0${a} <${+r+1}.0.0-0`:c&&(s=`>=${r}.${n}.0${a} <${r}.${+n+1}.0-0`),Gt("xRange return",s),s}))},os=(e,t)=>(Gt("replaceStars",e,t),e.trim().replace(Xt[Bt.STAR],"")),as=(e,t)=>(Gt("replaceGTE0",e,t),e.trim().replace(Xt[t.includePrerelease?Bt.GTE0PRE:Bt.GTE0],"")),hs=e=>(t,s,i,r,n,o,a,h,l,c,p,u,d)=>`${s=Kt(i)?"":Kt(r)?`>=${i}.0.0${e?"-0":""}`:Kt(n)?`>=${i}.${r}.0${e?"-0":""}`:o?`>=${s}`:`>=${s}${e?"-0":""}`} ${h=Kt(l)?"":Kt(c)?`<${+l+1}.0.0-0`:Kt(p)?`<${l}.${+c+1}.0-0`:u?`<=${l}.${c}.${p}-${u}`:e?`<${l}.${c}.${+p+1}-0`:`<=${h}`}`.trim(),ls=(e,t,s)=>{for(let s=0;s<e.length;s++)if(!e[s].test(t))return!1;if(t.prerelease.length&&!s.includePrerelease){for(let s=0;s<e.length;s++)if(Gt(e[s].semver),e[s].semver!==Ut.ANY&&e[s].semver.prerelease.length>0){const i=e[s].semver;if(i.major===t.major&&i.minor===t.minor&&i.patch===t.patch)return!0}return!1}return!0},cs=Symbol("SemVer ANY");class ps{static get ANY(){return cs}constructor(e,t){if(t=ds(t),e instanceof ps){if(e.loose===!!t.loose)return e;e=e.value}Es("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===cs?this.value="":this.value=this.operator+this.semver.version,Es("comp",this)}parse(e){const t=this.options.loose?fs[ms.COMPARATORLOOSE]:fs[ms.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new vs(s[2],this.options.loose):this.semver=cs}toString(){return this.value}test(e){if(Es("Comparator.test",e,this.options.loose),this.semver===cs||e===cs)return!0;if("string"==typeof e)try{e=new vs(e,this.options)}catch(e){return!1}return gs(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof ps))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new $s(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new $s(this.value,t).test(e.semver);const s=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),i=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),r=this.semver.version===e.semver.version,n=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=gs(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),a=gs(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return s||i||r&&n||o||a}}var us=ps;const ds=J,{re:fs,t:ms}=q.exports,gs=Et,Es=V,vs=he,$s=jt,ws=jt;var Rs=(e,t,s)=>{try{t=new ws(t,s)}catch(e){return!1}return t.test(e)};const Is=jt;var ys=(e,t)=>new Is(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));const Ss=he,Ls=jt;var Os=(e,t,s)=>{let i=null,r=null,n=null;try{n=new Ls(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(i&&-1!==r.compare(e)||(i=e,r=new Ss(i,s)))})),i};const As=he,Ts=jt;var bs=(e,t,s)=>{let i=null,r=null,n=null;try{n=new Ts(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(i&&1!==r.compare(e)||(i=e,r=new As(i,s)))})),i};const Ns=he,xs=jt,Cs=ue;var ks=(e,t)=>{e=new xs(e,t);let s=new Ns("0.0.0");if(e.test(s))return s;if(s=new Ns("0.0.0-0"),e.test(s))return s;s=null;for(let t=0;t<e.set.length;++t){const i=e.set[t];let r=null;i.forEach((e=>{const t=new Ns(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":r&&!Cs(t,r)||(r=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!r||s&&!Cs(s,r)||(s=r)}return s&&e.test(s)?s:null};const _s=jt;var zs=(e,t)=>{try{return new _s(e,t).range||"*"}catch(e){return null}};const Ps=he,Ms=us,{ANY:js}=Ms,Fs=jt,Ds=Rs,Us=ue,Gs=rt,Hs=ct,Xs=ht;var Bs=(e,t,s,i)=>{let r,n,o,a,h;switch(e=new Ps(e,i),t=new Fs(t,i),s){case">":r=Us,n=Hs,o=Gs,a=">",h=">=";break;case"<":r=Gs,n=Xs,o=Us,a="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Ds(e,t,i))return!1;for(let s=0;s<t.set.length;++s){const l=t.set[s];let c=null,p=null;if(l.forEach((e=>{e.semver===js&&(e=new Ms(">=0.0.0")),c=c||e,p=p||e,r(e.semver,c.semver,i)?c=e:o(e.semver,p.semver,i)&&(p=e)})),c.operator===a||c.operator===h)return!1;if((!p.operator||p.operator===a)&&n(e,p.semver))return!1;if(p.operator===h&&o(e,p.semver))return!1}return!0};const Vs=Bs;var Ws=(e,t,s)=>Vs(e,t,">",s);const qs=Bs;var Ys=(e,t,s)=>qs(e,t,"<",s);const Js=jt;var Zs=(e,t,s)=>(e=new Js(e,s),t=new Js(t,s),e.intersects(t));const Qs=Rs,Ks=ce;const ei=jt,ti=us,{ANY:si}=ti,ii=Rs,ri=ce,ni=(e,t,s)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===si){if(1===t.length&&t[0].semver===si)return!0;e=s.includePrerelease?[new ti(">=0.0.0-0")]:[new ti(">=0.0.0")]}if(1===t.length&&t[0].semver===si){if(s.includePrerelease)return!0;t=[new ti(">=0.0.0")]}const i=new Set;let r,n,o,a,h,l,c;for(const t of e)">"===t.operator||">="===t.operator?r=oi(r,t,s):"<"===t.operator||"<="===t.operator?n=ai(n,t,s):i.add(t.semver);if(i.size>1)return null;if(r&&n){if(o=ri(r.semver,n.semver,s),o>0)return null;if(0===o&&(">="!==r.operator||"<="!==n.operator))return null}for(const e of i){if(r&&!ii(e,String(r),s))return null;if(n&&!ii(e,String(n),s))return null;for(const i of t)if(!ii(e,String(i),s))return!1;return!0}let p=!(!n||s.includePrerelease||!n.semver.prerelease.length)&&n.semver,u=!(!r||s.includePrerelease||!r.semver.prerelease.length)&&r.semver;p&&1===p.prerelease.length&&"<"===n.operator&&0===p.prerelease[0]&&(p=!1);for(const e of t){if(c=c||">"===e.operator||">="===e.operator,l=l||"<"===e.operator||"<="===e.operator,r)if(u&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===u.major&&e.semver.minor===u.minor&&e.semver.patch===u.patch&&(u=!1),">"===e.operator||">="===e.operator){if(a=oi(r,e,s),a===e&&a!==r)return!1}else if(">="===r.operator&&!ii(r.semver,String(e),s))return!1;if(n)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),"<"===e.operator||"<="===e.operator){if(h=ai(n,e,s),h===e&&h!==n)return!1}else if("<="===n.operator&&!ii(n.semver,String(e),s))return!1;if(!e.operator&&(n||r)&&0!==o)return!1}return!(r&&l&&!n&&0!==o)&&(!(n&&c&&!r&&0!==o)&&(!u&&!p))},oi=(e,t,s)=>{if(!e)return t;const i=ri(e.semver,t.semver,s);return i>0?e:i<0||">"===t.operator&&">="===e.operator?t:e},ai=(e,t,s)=>{if(!e)return t;const i=ri(e.semver,t.semver,s);return i<0?e:i>0||"<"===t.operator&&"<="===e.operator?t:e};var hi=(e,t,s={})=>{if(e===t)return!0;e=new ei(e,s),t=new ei(t,s);let i=!1;e:for(const r of e.set){for(const e of t.set){const t=ni(r,e,s);if(i=i||null!==t,t)continue e}if(i)return!1}return!0};const li=q.exports;var ci={re:li.re,src:li.src,tokens:li.t,SEMVER_SPEC_VERSION:W.SEMVER_SPEC_VERSION,SemVer:he,compareIdentifiers:K.compareIdentifiers,rcompareIdentifiers:K.rcompareIdentifiers,parse:Ae,valid:be,clean:xe,inc:ke,diff:je,major:De,minor:Ge,patch:Xe,prerelease:Ve,compare:ce,rcompare:qe,compareLoose:Je,compareBuild:Qe,sort:et,rsort:st,gt:ue,lt:rt,eq:ze,neq:ot,gte:ht,lte:ct,cmp:Et,coerce:It,Comparator:us,Range:jt,satisfies:Rs,toComparators:ys,maxSatisfying:Os,minSatisfying:bs,minVersion:ks,validRange:zs,outside:Bs,gtr:Ws,ltr:Ys,intersects:Zs,simplifyRange:(e,t,s)=>{const i=[];let r=null,n=null;const o=e.sort(((e,t)=>Ks(e,t,s)));for(const e of o){Qs(e,t,s)?(n=e,r||(r=e)):(n&&i.push([r,n]),n=null,r=null)}r&&i.push([r,null]);const a=[];for(const[e,t]of i)e===t?a.push(e):t||e!==o[0]?t?e===o[0]?a.push(`<=${t}`):a.push(`${e} - ${t}`):a.push(`>=${e}`):a.push("*");const h=a.join(" || "),l="string"==typeof t.raw?t.raw:String(t);return h.length<l.length?h:t},subset:hi};class pi{constructor(){this.tasks=[],this.isDownloading=!1,this.__downLoadFinnishCallBack=()=>0}downLoadFinnishCallBack(e){this.__downLoadFinnishCallBack=e}addTask(e){if("function"!=typeof e)throw new TypeError("Task must be a function!");this.tasks.push(e),this.isDownloading||(this.isDownloading=!0,this.download())}downAndungzip(t,r,n,o){return new Promise(((a,h)=>{const l=`${n}.tmp`;if(s.existsSync(n)&&de(s.readFileSync(n))===t)a(!0);else{const c=e.createHash("sha256"),p=i.createGunzip(),u=s.createWriteStream(l);o(r).then((e=>{e.pipe(p)}),(e=>{h(e)})),p.on("error",(e=>{p.close(),u.close(),c.destroy(),h(e)})),p.on("data",(e=>{c.write(e),u.write(e)})),p.on("end",(()=>{c.digest("hex")!==t?(c.destroy(),h(new Error("下载文件出错"))):(u.on("finish",(()=>{s.rename(l,n,(e=>{e?h(e):a(!0)}))})),u.end())}))}}))}download(){const e=this.tasks.shift();e?e.task().then((()=>{e.finnishCallBack(!0),this.download()})).catch((t=>{e.finnishCallBack(!1,t)})):(this.__downLoadFinnishCallBack(),this.isDownloading=!1)}}exports.DiffVersionHashResult=H,exports.DiffVersionHashResultItem=class{},exports.HashedFile=U,exports.HashedFolder=G,exports.UpdateElectron=class{constructor(e,t,s,i,r,n,o,a,h,l={files:{}}){this.statusCallback=e,this.updaterName=t,this.version=s,this.exePath=i,this.tempDirectory=r,this.updateConfigName=n,this.updateJson=o,this.baseUrl=a,this.downloadFn=h,this.options=l,this.downloadQueue=new pi,this.__diffResult=void 0}checkForUpdates(){return n(this,void 0,void 0,(function*(){try{if(ci.gt(this.updateJson.version,this.version)){const e=me(t.dirname(this.exePath),this.options);ge(e);const s=Ee(e,this.updateJson.hash);return s&&s.added.concat(s.changed).length>0&&(this.__diffResult=Object.freeze(s)),!!this.__diffResult}return!1}catch(e){return this.statusCallback({message:e,status:"failed"}),console.log("checkForUpdates",e),!1}}))}downloadUpdate(){return n(this,void 0,void 0,(function*(){if(!this.__diffResult)return this.statusCallback({message:"程序无须更新",status:"failed"}),!1;try{s.existsSync(this.tempDirectory)||s.mkdirSync(this.tempDirectory),this.baseUrl.endsWith("/")||(this.baseUrl+="/"),this.statusCallback({message:{changed:this.__diffResult.changed.map((e=>e.hash)),added:this.__diffResult.added.map((e=>e.hash)),msg:"findDifferentElements"},status:"init"});return new Promise(((e,s)=>{this.downloadQueue.downLoadFinnishCallBack((()=>{e(!0)})),this.__diffResult.added.concat(this.__diffResult.changed).forEach((e=>{const s=`${this.baseUrl}${e.hash}.gz`;this.downloadQueue.addTask({task:()=>this.downloadQueue.downAndungzip(e.hash,s,t.join(this.tempDirectory,e.hash),this.downloadFn),finnishCallBack:e=>{}})}))}))}catch(e){return this.statusCallback({message:e,status:"failed"}),console.log("downloadUpdate",e),!1}}))}install(e=!1){var t,s;return n(this,void 0,void 0,(function*(){try{let i=!0;if(e)i=e;else{if(!(yield this.validateDiffPackageIntegrity()))return this.statusCallback({message:"Installation check difference failed",status:"failed"}),!1}if(i){const e=r.spawn(this.updaterName,{detached:!0,env:{exe_path:this.exePath,update_temp_path:this.tempDirectory,update_config_file_name:this.updateConfigName+".json",exe_pid:process.pid.toString()},stdio:"ignore"});return null===(t=e.stdout)||void 0===t||t.on("data",(e=>{this.statusCallback({message:{data:JSON.stringify(e),msg:"child.stdout data"},status:"init"})})),null===(s=e.stdout)||void 0===s||s.on("close",(()=>{this.statusCallback({message:"child.stdout close",status:"init"})})),!0}return!1}catch(e){this.statusCallback({message:e,status:"failed"})}}))}validateDiffPackageIntegrity(){return n(this,void 0,void 0,(function*(){if(this.__diffResult){for(const e of this.__diffResult.changed){const t=`${this.tempDirectory}/${e.hash}`;if(!(yield Re(t,e.hash)))return!0}for(const e of this.__diffResult.added){const t=`${this.tempDirectory}/${e.hash}`;if(!(yield Re(t,e.hash)))return!0}}return!1}))}},exports.UpdateInfo=X,exports.checkFileExitAndHash=Re,exports.diffVersionHash=Ee,exports.gzip=$e,exports.handleHashedFolderChildrenToObject=ge,exports.hash256=de,exports.hashElement=me,exports.pushdiffVersionHashResult=ve,exports.reduceGlobPatterns=fe,exports.updateElectron=function(e,i,o,a,h,l,c,p,u,d={files:{}}){return n(this,void 0,void 0,(function*(){const n=t.dirname(a),f=new X;s.existsSync(h)||s.mkdirSync(h);const m=process.noAsar;try{if(ue(c.version,o)){f.status="downloading",process.noAsar=!0;const o=me(n,d);ge(o);const g=Ee(o,c.hash);return s.writeFileSync(t.join(h,l+".json"),JSON.stringify(g,null,2)),console.log(g),e(f),p.endsWith("/")||(p+="/"),yield Promise.all(g.changed.map((e=>we(e.hash,`${p}${e.hash}.gz`,t.join(h,e.hash),u)))),yield Promise.all(g.added.map((e=>we(e.hash,`${p}${e.hash}.gz`,t.join(h,e.hash),u)))),process.noAsar=m,console.log("complete"),f.status="finished",e(f),r.spawn(i,{detached:!0,env:{exe_path:a,update_temp_path:h,update_config_file_name:l+".json",exe_pid:process.pid.toString()},stdio:"ignore"}),exports.UpdateStatus.Success}return exports.UpdateStatus.HaveNothingUpdate}catch(t){return process.noAsar=m,console.log(t),f.status="failed",f.message=t,e(f),exports.UpdateStatus.Failed}}))},exports.zipHashElement=function e(s,i,r,o=!1){return n(this,void 0,void 0,(function*(){if(s.children)for(let t=0;t<s.children.length;t++)yield e(s.children[t],i+(o?"":"/"+s.name),r);else yield $e(i+"/"+s.name,t.join(r,s.hash+".gz"))}))};
