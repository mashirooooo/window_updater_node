"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("crypto"),t=require("path"),s=require("fs"),r=require("zlib"),i=require("child_process");
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.
Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.
THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
function n(e,t,s,r){return new(s||(s=Promise))((function(i,n){function o(e){try{h(r.next(e))}catch(e){n(e)}}function a(e){try{h(r.throw(e))}catch(e){n(e)}}function h(e){var t;e.done?i(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,a)}h((r=r.apply(e,t||[])).next())}))}var o="object"==typeof process&&process&&"win32"===process.platform?{sep:"\\"}:{sep:"/"},a=h;function h(e,t,s){e instanceof RegExp&&(e=l(e,s)),t instanceof RegExp&&(t=l(t,s));var r=c(e,t,s);return r&&{start:r[0],end:r[1],pre:s.slice(0,r[0]),body:s.slice(r[0]+e.length,r[1]),post:s.slice(r[1]+t.length)}}function l(e,t){var s=t.match(e);return s?s[0]:null}function c(e,t,s){var r,i,n,o,a,h=s.indexOf(e),l=s.indexOf(t,h+1),c=h;if(h>=0&&l>0){if(e===t)return[h,l];for(r=[],n=s.length;c>=0&&!a;)c==h?(r.push(c),h=s.indexOf(e,c+1)):1==r.length?a=[r.pop(),l]:((i=r.pop())<n&&(n=i,o=l),l=s.indexOf(t,c+1)),c=h<l&&h>=0?h:l;r.length&&(a=[n,o])}return a}h.range=c;var p=a,u=function(e){if(!e)return[];"{}"===e.substr(0,2)&&(e="\\{\\}"+e.substr(2));return L(function(e){return e.split("\\\\").join(d).split("\\{").join(f).split("\\}").join(m).split("\\,").join(g).split("\\.").join(E)}(e),!0).map($)},d="\0SLASH"+Math.random()+"\0",f="\0OPEN"+Math.random()+"\0",m="\0CLOSE"+Math.random()+"\0",g="\0COMMA"+Math.random()+"\0",E="\0PERIOD"+Math.random()+"\0";function v(e){return parseInt(e,10)==e?parseInt(e,10):e.charCodeAt(0)}function $(e){return e.split(d).join("\\").split(f).join("{").split(m).join("}").split(g).join(",").split(E).join(".")}function I(e){if(!e)return[""];var t=[],s=p("{","}",e);if(!s)return e.split(",");var r=s.pre,i=s.body,n=s.post,o=r.split(",");o[o.length-1]+="{"+i+"}";var a=I(n);return n.length&&(o[o.length-1]+=a.shift(),o.push.apply(o,a)),t.push.apply(t,o),t}function w(e){return"{"+e+"}"}function y(e){return/^-?0\d/.test(e)}function S(e,t){return e<=t}function R(e,t){return e>=t}function L(e,t){var s=[],r=p("{","}",e);if(!r)return[e];var i=r.pre,n=r.post.length?L(r.post,!1):[""];if(/\$$/.test(r.pre))for(var o=0;o<n.length;o++){var a=i+"{"+r.body+"}"+n[o];s.push(a)}else{var h,l,c=/^-?\d+\.\.-?\d+(?:\.\.-?\d+)?$/.test(r.body),u=/^[a-zA-Z]\.\.[a-zA-Z](?:\.\.-?\d+)?$/.test(r.body),d=c||u,f=r.body.indexOf(",")>=0;if(!d&&!f)return r.post.match(/,.*\}/)?L(e=r.pre+"{"+r.body+m+r.post):[e];if(d)h=r.body.split(/\.\./);else if(1===(h=I(r.body)).length&&1===(h=L(h[0],!1).map(w)).length)return n.map((function(e){return r.pre+h[0]+e}));if(d){var g=v(h[0]),E=v(h[1]),$=Math.max(h[0].length,h[1].length),O=3==h.length?Math.abs(v(h[2])):1,T=S;E<g&&(O*=-1,T=R);var A=h.some(y);l=[];for(var b=g;T(b,E);b+=O){var N;if(u)"\\"===(N=String.fromCharCode(b))&&(N="");else if(N=String(b),A){var x=$-N.length;if(x>0){var C=new Array(x+1).join("0");N=b<0?"-"+C+N.slice(1):C+N}}l.push(N)}}else{l=[];for(var k=0;k<h.length;k++)l.push.apply(l,L(h[k],!1))}for(k=0;k<l.length;k++)for(o=0;o<n.length;o++){a=i+l[k]+n[o];(!t||d||a)&&s.push(a)}}return s}const O=T=(e,t,s={})=>(j(t),!(!s.nocomment&&"#"===t.charAt(0))&&new _(t,s).match(e));var T=O;const A=o;O.sep=A.sep;const b=Symbol("globstar **");O.GLOBSTAR=b;const N=u,x={"!":{open:"(?:(?!(?:",close:"))[^/]*?)"},"?":{open:"(?:",close:")?"},"+":{open:"(?:",close:")+"},"*":{open:"(?:",close:")*"},"@":{open:"(?:",close:")"}},C=e=>e.split("").reduce(((e,t)=>(e[t]=!0,e)),{}),k=C("().*{}+?[]^$\\!"),z=C("[.("),P=/\/+/;O.filter=(e,t={})=>(s,r,i)=>O(s,e,t);const M=(e,t={})=>{const s={};return Object.keys(e).forEach((t=>s[t]=e[t])),Object.keys(t).forEach((e=>s[e]=t[e])),s};O.defaults=e=>{if(!e||"object"!=typeof e||!Object.keys(e).length)return O;const t=O,s=(s,r,i)=>t(s,r,M(e,i));return(s.Minimatch=class extends t.Minimatch{constructor(t,s){super(t,M(e,s))}}).defaults=s=>t.defaults(M(e,s)).Minimatch,s.filter=(s,r)=>t.filter(s,M(e,r)),s.defaults=s=>t.defaults(M(e,s)),s.makeRe=(s,r)=>t.makeRe(s,M(e,r)),s.braceExpand=(s,r)=>t.braceExpand(s,M(e,r)),s.match=(s,r,i)=>t.match(s,r,M(e,i)),s},O.braceExpand=(e,t)=>D(e,t);const D=(e,t={})=>(j(e),t.nobrace||!/\{(?:(?!\{).)*\}/.test(e)?[e]:N(e)),j=e=>{if("string"!=typeof e)throw new TypeError("invalid pattern");if(e.length>65536)throw new TypeError("pattern is too long")},F=Symbol("subparse");O.makeRe=(e,t)=>new _(e,t||{}).makeRe(),O.match=(e,t,s={})=>{const r=new _(t,s);return e=e.filter((e=>r.match(e))),r.options.nonull&&!e.length&&e.push(t),e};class _{constructor(e,t){j(e),t||(t={}),this.options=t,this.set=[],this.pattern=e,this.regexp=null,this.negate=!1,this.comment=!1,this.empty=!1,this.partial=!!t.partial,this.make()}debug(){}make(){const e=this.pattern,t=this.options;if(!t.nocomment&&"#"===e.charAt(0))return void(this.comment=!0);if(!e)return void(this.empty=!0);this.parseNegate();let s=this.globSet=this.braceExpand();t.debug&&(this.debug=(...e)=>console.error(...e)),this.debug(this.pattern,s),s=this.globParts=s.map((e=>e.split(P))),this.debug(this.pattern,s),s=s.map(((e,t,s)=>e.map(this.parse,this))),this.debug(this.pattern,s),s=s.filter((e=>-1===e.indexOf(!1))),this.debug(this.pattern,s),this.set=s}parseNegate(){if(this.options.nonegate)return;const e=this.pattern;let t=!1,s=0;for(let r=0;r<e.length&&"!"===e.charAt(r);r++)t=!t,s++;s&&(this.pattern=e.substr(s)),this.negate=t}matchOne(e,t,s){var r=this.options;this.debug("matchOne",{this:this,file:e,pattern:t}),this.debug("matchOne",e.length,t.length);for(var i=0,n=0,o=e.length,a=t.length;i<o&&n<a;i++,n++){this.debug("matchOne loop");var h,l=t[n],c=e[i];if(this.debug(t,l,c),!1===l)return!1;if(l===b){this.debug("GLOBSTAR",[t,l,c]);var p=i,u=n+1;if(u===a){for(this.debug("** at the end");i<o;i++)if("."===e[i]||".."===e[i]||!r.dot&&"."===e[i].charAt(0))return!1;return!0}for(;p<o;){var d=e[p];if(this.debug("\nglobstar while",e,p,t,u,d),this.matchOne(e.slice(p),t.slice(u),s))return this.debug("globstar found match!",p,o,d),!0;if("."===d||".."===d||!r.dot&&"."===d.charAt(0)){this.debug("dot detected!",e,p,t,u);break}this.debug("globstar swallow a segment, and continue"),p++}return!(!s||(this.debug("\n>>> no match, partial?",e,p,t,u),p!==o))}if("string"==typeof l?(h=c===l,this.debug("string match",l,c,h)):(h=c.match(l),this.debug("pattern match",l,c,h)),!h)return!1}if(i===o&&n===a)return!0;if(i===o)return s;if(n===a)return i===o-1&&""===e[i];throw new Error("wtf?")}braceExpand(){return D(this.pattern,this.options)}parse(e,t){j(e);const s=this.options;if("**"===e){if(!s.noglobstar)return b;e="*"}if(""===e)return"";let r="",i=!!s.nocase,n=!1;const o=[],a=[];let h,l,c,p,u=!1,d=-1,f=-1;const m="."===e.charAt(0)?"":s.dot?"(?!(?:^|\\/)\\.{1,2}(?:$|\\/))":"(?!\\.)",g=()=>{if(h){switch(h){case"*":r+="[^/]*?",i=!0;break;case"?":r+="[^/]",i=!0;break;default:r+="\\"+h}this.debug("clearStateChar %j %j",h,r),h=!1}};for(let t,m=0;m<e.length&&(t=e.charAt(m));m++)if(this.debug("%s\t%s %s %j",e,m,r,t),n){if("/"===t)return!1;k[t]&&(r+="\\"),r+=t,n=!1}else switch(t){case"/":return!1;case"\\":g(),n=!0;continue;case"?":case"*":case"+":case"@":case"!":if(this.debug("%s\t%s %s %j <-- stateChar",e,m,r,t),u){this.debug("  in class"),"!"===t&&m===f+1&&(t="^"),r+=t;continue}this.debug("call clearStateChar %j",h),g(),h=t,s.noext&&g();continue;case"(":if(u){r+="(";continue}if(!h){r+="\\(";continue}o.push({type:h,start:m-1,reStart:r.length,open:x[h].open,close:x[h].close}),r+="!"===h?"(?:(?!(?:":"(?:",this.debug("plType %j %j",h,r),h=!1;continue;case")":if(u||!o.length){r+="\\)";continue}g(),i=!0,c=o.pop(),r+=c.close,"!"===c.type&&a.push(c),c.reEnd=r.length;continue;case"|":if(u||!o.length){r+="\\|";continue}g(),r+="|";continue;case"[":if(g(),u){r+="\\"+t;continue}u=!0,f=m,d=r.length,r+=t;continue;case"]":if(m===f+1||!u){r+="\\"+t;continue}l=e.substring(f+1,m);try{RegExp("["+l+"]")}catch(e){p=this.parse(l,F),r=r.substr(0,d)+"\\["+p[0]+"\\]",i=i||p[1],u=!1;continue}i=!0,u=!1,r+=t;continue;default:g(),!k[t]||"^"===t&&u||(r+="\\"),r+=t}for(u&&(l=e.substr(f+1),p=this.parse(l,F),r=r.substr(0,d)+"\\["+p[0],i=i||p[1]),c=o.pop();c;c=o.pop()){let e;e=r.slice(c.reStart+c.open.length),this.debug("setting tail",r,c),e=e.replace(/((?:\\{2}){0,64})(\\?)\|/g,((e,t,s)=>(s||(s="\\"),t+t+s+"|"))),this.debug("tail=%j\n   %s",e,e,c,r);const t="*"===c.type?"[^/]*?":"?"===c.type?"[^/]":"\\"+c.type;i=!0,r=r.slice(0,c.reStart)+t+"\\("+e}g(),n&&(r+="\\\\");const E=z[r.charAt(0)];for(let e=a.length-1;e>-1;e--){const s=a[e],i=r.slice(0,s.reStart),n=r.slice(s.reStart,s.reEnd-8);let o=r.slice(s.reEnd);const h=r.slice(s.reEnd-8,s.reEnd)+o,l=i.split("(").length-1;let c=o;for(let e=0;e<l;e++)c=c.replace(/\)[+*?]?/,"");o=c;r=i+n+o+(""===o&&t!==F?"$":"")+h}if(""!==r&&i&&(r="(?=.)"+r),E&&(r=m+r),t===F)return[r,i];if(!i)return e.replace(/\\(.)/g,"$1");const v=s.nocase?"i":"";try{return Object.assign(new RegExp("^"+r+"$",v),{_glob:e,_src:r})}catch(e){return new RegExp("$.")}}makeRe(){if(this.regexp||!1===this.regexp)return this.regexp;const e=this.set;if(!e.length)return this.regexp=!1,this.regexp;const t=this.options,s=t.noglobstar?"[^/]*?":t.dot?"(?:(?!(?:\\/|^)(?:\\.{1,2})($|\\/)).)*?":"(?:(?!(?:\\/|^)\\.).)*?",r=t.nocase?"i":"";let i=e.map((e=>(e=e.map((e=>"string"==typeof e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):e===b?b:e._src)).reduce(((e,t)=>(e[e.length-1]===b&&t===b||e.push(t),e)),[]),e.forEach(((t,r)=>{t===b&&e[r-1]!==b&&(0===r?e.length>1?e[r+1]="(?:\\/|"+s+"\\/)?"+e[r+1]:e[r]=s:r===e.length-1?e[r-1]+="(?:\\/|"+s+")?":(e[r-1]+="(?:\\/|\\/"+s+"\\/)"+e[r+1],e[r+1]=b))})),e.filter((e=>e!==b)).join("/")))).join("|");i="^(?:"+i+")$",this.negate&&(i="^(?!"+i+").*$");try{this.regexp=new RegExp(i,r)}catch(e){this.regexp=!1}return this.regexp}match(e,t=this.partial){if(this.debug("match",e,this.pattern),this.comment)return!1;if(this.empty)return""===e;if("/"===e&&t)return!0;const s=this.options;"/"!==A.sep&&(e=e.split(A.sep).join("/")),e=e.split(P),this.debug(this.pattern,"split",e);const r=this.set;let i;this.debug(this.pattern,"set",r);for(let t=e.length-1;t>=0&&(i=e[t],!i);t--);for(let n=0;n<r.length;n++){const o=r[n];let a=e;s.matchBase&&1===o.length&&(a=[i]);if(this.matchOne(a,o,t))return!!s.flipNegate||!this.negate}return!s.flipNegate&&this.negate}static defaults(e){return O.defaults(e).Minimatch}}O.Minimatch=_;class G{}class U extends G{}class H{constructor(){this.added=[],this.changed=[]}}var X;function V(t){return e.createHash("sha256").update(t).digest("hex")}function B(e,t){if("function"==typeof e)return e(t);if(e&&Array.isArray(e)&&0!==e.length){return new RegExp(e.reduce(((e,t)=>e+"|"+T.makeRe(t).source),"").substring(1)).test(t)}return!1}function W(e,r={}){var i,n;const o=s.statSync(e),a=t.basename(e);if(o.isFile()){if(B(null===(i=null==r?void 0:r.files)||void 0===i?void 0:i.exclude,a))return null;const t=new G;return t.name=a,t.hash=V(s.readFileSync(e)),t}if(o.isDirectory()){if(B(null===(n=null==r?void 0:r.folders)||void 0===n?void 0:n.exclude,a))return null;const i=new U;return i.name=a,i.children=s.readdirSync(e).map((s=>W(t.join(e,s),r))).filter((e=>null!==e)),i.hash=V(i.children.map((e=>e.hash)).join("")),i}return null}function q(e){e&&e.children&&(e.childrenObject=e.children.reduce(((e,t)=>(t.children&&q(t),e[t.name]=t,e)),{}))}function Y(e,t,s=new H,r="."){return t.hash===e.hash||(t.children?t.children.forEach((t=>{t=t,e.childrenObject&&e.childrenObject[t.name]?Y(e.childrenObject[t.name],t,s,r+"/"+t.name):Z(t,r+"/"+t.name,s.added)})):s.changed.push({filePath:r,hash:t.hash})),s}function Z(e,t,s){e.children?e.children.forEach((e=>{Z(e,t+"/"+e.name,s)})):s.push({filePath:t,hash:e.hash})}function J(e,t){return new Promise(((i,n)=>{const o=r.createGzip(),a=s.createWriteStream(t),h=s.createReadStream(e);h.on("close",i),h.on("error",n),a.on("error",n),h.pipe(o).pipe(a)}))}function Q(e){return new Promise(((r,i)=>{try{const i=s.readdirSync(e),n=[];for(const r of i){const i=`${e}/${r}`;if(s.statSync(i).isFile()){if(""===t.extname(i)){const e=r;n.push(e)}}}r(n)}catch(e){i(e)}}))}function K(e,t){if(t.length<e.length)return!1;const s=new Set(e);return t.every((e=>s.has(e)))}function ee(e,t){const s=new Set(e),r=[];for(let e=0;e<t.length;e++)s.has(t[e])||r.push(t[e]);return r}function te(e){return[...new Set([...e])]}exports.UpdateStatus=void 0,(X=exports.UpdateStatus||(exports.UpdateStatus={}))[X.HaveNothingUpdate=0]="HaveNothingUpdate",X[X.Success=1]="Success",X[X.Failed=2]="Failed";var se={exports:{}};var re={SEMVER_SPEC_VERSION:"2.0.0",MAX_LENGTH:256,MAX_SAFE_INTEGER:Number.MAX_SAFE_INTEGER||9007199254740991,MAX_SAFE_COMPONENT_LENGTH:16};var ie="object"==typeof process&&process.env&&process.env.NODE_DEBUG&&/\bsemver\b/i.test(process.env.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};!function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:s}=re,r=ie,i=(t=e.exports={}).re=[],n=t.src=[],o=t.t={};let a=0;const h=(e,t,s)=>{const h=a++;r(e,h,t),o[e]=h,n[h]=t,i[h]=new RegExp(t,s?"g":void 0)};h("NUMERICIDENTIFIER","0|[1-9]\\d*"),h("NUMERICIDENTIFIERLOOSE","[0-9]+"),h("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-][a-zA-Z0-9-]*"),h("MAINVERSION",`(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})\\.(${n[o.NUMERICIDENTIFIER]})`),h("MAINVERSIONLOOSE",`(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})\\.(${n[o.NUMERICIDENTIFIERLOOSE]})`),h("PRERELEASEIDENTIFIER",`(?:${n[o.NUMERICIDENTIFIER]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASEIDENTIFIERLOOSE",`(?:${n[o.NUMERICIDENTIFIERLOOSE]}|${n[o.NONNUMERICIDENTIFIER]})`),h("PRERELEASE",`(?:-(${n[o.PRERELEASEIDENTIFIER]}(?:\\.${n[o.PRERELEASEIDENTIFIER]})*))`),h("PRERELEASELOOSE",`(?:-?(${n[o.PRERELEASEIDENTIFIERLOOSE]}(?:\\.${n[o.PRERELEASEIDENTIFIERLOOSE]})*))`),h("BUILDIDENTIFIER","[0-9A-Za-z-]+"),h("BUILD",`(?:\\+(${n[o.BUILDIDENTIFIER]}(?:\\.${n[o.BUILDIDENTIFIER]})*))`),h("FULLPLAIN",`v?${n[o.MAINVERSION]}${n[o.PRERELEASE]}?${n[o.BUILD]}?`),h("FULL",`^${n[o.FULLPLAIN]}$`),h("LOOSEPLAIN",`[v=\\s]*${n[o.MAINVERSIONLOOSE]}${n[o.PRERELEASELOOSE]}?${n[o.BUILD]}?`),h("LOOSE",`^${n[o.LOOSEPLAIN]}$`),h("GTLT","((?:<|>)?=?)"),h("XRANGEIDENTIFIERLOOSE",`${n[o.NUMERICIDENTIFIERLOOSE]}|x|X|\\*`),h("XRANGEIDENTIFIER",`${n[o.NUMERICIDENTIFIER]}|x|X|\\*`),h("XRANGEPLAIN",`[v=\\s]*(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:\\.(${n[o.XRANGEIDENTIFIER]})(?:${n[o.PRERELEASE]})?${n[o.BUILD]}?)?)?`),h("XRANGEPLAINLOOSE",`[v=\\s]*(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:\\.(${n[o.XRANGEIDENTIFIERLOOSE]})(?:${n[o.PRERELEASELOOSE]})?${n[o.BUILD]}?)?)?`),h("XRANGE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAIN]}$`),h("XRANGELOOSE",`^${n[o.GTLT]}\\s*${n[o.XRANGEPLAINLOOSE]}$`),h("COERCE",`(^|[^\\d])(\\d{1,${s}})(?:\\.(\\d{1,${s}}))?(?:\\.(\\d{1,${s}}))?(?:$|[^\\d])`),h("COERCERTL",n[o.COERCE],!0),h("LONETILDE","(?:~>?)"),h("TILDETRIM",`(\\s*)${n[o.LONETILDE]}\\s+`,!0),t.tildeTrimReplace="$1~",h("TILDE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAIN]}$`),h("TILDELOOSE",`^${n[o.LONETILDE]}${n[o.XRANGEPLAINLOOSE]}$`),h("LONECARET","(?:\\^)"),h("CARETTRIM",`(\\s*)${n[o.LONECARET]}\\s+`,!0),t.caretTrimReplace="$1^",h("CARET",`^${n[o.LONECARET]}${n[o.XRANGEPLAIN]}$`),h("CARETLOOSE",`^${n[o.LONECARET]}${n[o.XRANGEPLAINLOOSE]}$`),h("COMPARATORLOOSE",`^${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]})$|^$`),h("COMPARATOR",`^${n[o.GTLT]}\\s*(${n[o.FULLPLAIN]})$|^$`),h("COMPARATORTRIM",`(\\s*)${n[o.GTLT]}\\s*(${n[o.LOOSEPLAIN]}|${n[o.XRANGEPLAIN]})`,!0),t.comparatorTrimReplace="$1$2$3",h("HYPHENRANGE",`^\\s*(${n[o.XRANGEPLAIN]})\\s+-\\s+(${n[o.XRANGEPLAIN]})\\s*$`),h("HYPHENRANGELOOSE",`^\\s*(${n[o.XRANGEPLAINLOOSE]})\\s+-\\s+(${n[o.XRANGEPLAINLOOSE]})\\s*$`),h("STAR","(<|>)?=?\\s*\\*"),h("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),h("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")}(se,se.exports);const ne=["includePrerelease","loose","rtl"];var oe=e=>e?"object"!=typeof e?{loose:!0}:ne.filter((t=>e[t])).reduce(((e,t)=>(e[t]=!0,e)),{}):{};const ae=/^[0-9]+$/,he=(e,t)=>{const s=ae.test(e),r=ae.test(t);return s&&r&&(e=+e,t=+t),e===t?0:s&&!r?-1:r&&!s?1:e<t?-1:1};var le={compareIdentifiers:he,rcompareIdentifiers:(e,t)=>he(t,e)};const ce=ie,{MAX_LENGTH:pe,MAX_SAFE_INTEGER:ue}=re,{re:de,t:fe}=se.exports,me=oe,{compareIdentifiers:ge}=le;class Ee{constructor(e,t){if(t=me(t),e instanceof Ee){if(e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease)return e;e=e.version}else if("string"!=typeof e)throw new TypeError(`Invalid Version: ${e}`);if(e.length>pe)throw new TypeError(`version is longer than ${pe} characters`);ce("SemVer",e,t),this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease;const s=e.trim().match(t.loose?de[fe.LOOSE]:de[fe.FULL]);if(!s)throw new TypeError(`Invalid Version: ${e}`);if(this.raw=e,this.major=+s[1],this.minor=+s[2],this.patch=+s[3],this.major>ue||this.major<0)throw new TypeError("Invalid major version");if(this.minor>ue||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>ue||this.patch<0)throw new TypeError("Invalid patch version");s[4]?this.prerelease=s[4].split(".").map((e=>{if(/^[0-9]+$/.test(e)){const t=+e;if(t>=0&&t<ue)return t}return e})):this.prerelease=[],this.build=s[5]?s[5].split("."):[],this.format()}format(){return this.version=`${this.major}.${this.minor}.${this.patch}`,this.prerelease.length&&(this.version+=`-${this.prerelease.join(".")}`),this.version}toString(){return this.version}compare(e){if(ce("SemVer.compare",this.version,this.options,e),!(e instanceof Ee)){if("string"==typeof e&&e===this.version)return 0;e=new Ee(e,this.options)}return e.version===this.version?0:this.compareMain(e)||this.comparePre(e)}compareMain(e){return e instanceof Ee||(e=new Ee(e,this.options)),ge(this.major,e.major)||ge(this.minor,e.minor)||ge(this.patch,e.patch)}comparePre(e){if(e instanceof Ee||(e=new Ee(e,this.options)),this.prerelease.length&&!e.prerelease.length)return-1;if(!this.prerelease.length&&e.prerelease.length)return 1;if(!this.prerelease.length&&!e.prerelease.length)return 0;let t=0;do{const s=this.prerelease[t],r=e.prerelease[t];if(ce("prerelease compare",t,s,r),void 0===s&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===s)return-1;if(s!==r)return ge(s,r)}while(++t)}compareBuild(e){e instanceof Ee||(e=new Ee(e,this.options));let t=0;do{const s=this.build[t],r=e.build[t];if(ce("prerelease compare",t,s,r),void 0===s&&void 0===r)return 0;if(void 0===r)return 1;if(void 0===s)return-1;if(s!==r)return ge(s,r)}while(++t)}inc(e,t){switch(e){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",t);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",t);break;case"prepatch":this.prerelease.length=0,this.inc("patch",t),this.inc("pre",t);break;case"prerelease":0===this.prerelease.length&&this.inc("patch",t),this.inc("pre",t);break;case"major":0===this.minor&&0===this.patch&&0!==this.prerelease.length||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":0===this.patch&&0!==this.prerelease.length||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":0===this.prerelease.length&&this.patch++,this.prerelease=[];break;case"pre":if(0===this.prerelease.length)this.prerelease=[0];else{let e=this.prerelease.length;for(;--e>=0;)"number"==typeof this.prerelease[e]&&(this.prerelease[e]++,e=-2);-1===e&&this.prerelease.push(0)}t&&(this.prerelease[0]===t?isNaN(this.prerelease[1])&&(this.prerelease=[t,0]):this.prerelease=[t,0]);break;default:throw new Error(`invalid increment argument: ${e}`)}return this.format(),this.raw=this.version,this}}var ve=Ee;const{MAX_LENGTH:$e}=re,{re:Ie,t:we}=se.exports,ye=ve,Se=oe;var Re=(e,t)=>{if(t=Se(t),e instanceof ye)return e;if("string"!=typeof e)return null;if(e.length>$e)return null;if(!(t.loose?Ie[we.LOOSE]:Ie[we.FULL]).test(e))return null;try{return new ye(e,t)}catch(e){return null}};const Le=Re;var Oe=(e,t)=>{const s=Le(e,t);return s?s.version:null};const Te=Re;var Ae=(e,t)=>{const s=Te(e.trim().replace(/^[=v]+/,""),t);return s?s.version:null};const be=ve;var Ne=(e,t,s,r)=>{"string"==typeof s&&(r=s,s=void 0);try{return new be(e,s).inc(t,r).version}catch(e){return null}};const xe=ve;var Ce=(e,t,s)=>new xe(e,s).compare(new xe(t,s));const ke=Ce;var ze=(e,t,s)=>0===ke(e,t,s);const Pe=Re,Me=ze;var De=(e,t)=>{if(Me(e,t))return null;{const s=Pe(e),r=Pe(t),i=s.prerelease.length||r.prerelease.length,n=i?"pre":"",o=i?"prerelease":"";for(const e in s)if(("major"===e||"minor"===e||"patch"===e)&&s[e]!==r[e])return n+e;return o}};const je=ve;var Fe=(e,t)=>new je(e,t).major;const _e=ve;var Ge=(e,t)=>new _e(e,t).minor;const Ue=ve;var He=(e,t)=>new Ue(e,t).patch;const Xe=Re;var Ve=(e,t)=>{const s=Xe(e,t);return s&&s.prerelease.length?s.prerelease:null};const Be=Ce;var We=(e,t,s)=>Be(t,e,s);const qe=Ce;var Ye=(e,t)=>qe(e,t,!0);const Ze=ve;var Je=(e,t,s)=>{const r=new Ze(e,s),i=new Ze(t,s);return r.compare(i)||r.compareBuild(i)};const Qe=Je;var Ke=(e,t)=>e.sort(((e,s)=>Qe(e,s,t)));const et=Je;var tt=(e,t)=>e.sort(((e,s)=>et(s,e,t)));const st=Ce;var rt=(e,t,s)=>st(e,t,s)>0;const it=Ce;var nt=(e,t,s)=>it(e,t,s)<0;const ot=Ce;var at=(e,t,s)=>0!==ot(e,t,s);const ht=Ce;var lt=(e,t,s)=>ht(e,t,s)>=0;const ct=Ce;var pt=(e,t,s)=>ct(e,t,s)<=0;const ut=ze,dt=at,ft=rt,mt=lt,gt=nt,Et=pt;var vt=(e,t,s,r)=>{switch(t){case"===":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e===s;case"!==":return"object"==typeof e&&(e=e.version),"object"==typeof s&&(s=s.version),e!==s;case"":case"=":case"==":return ut(e,s,r);case"!=":return dt(e,s,r);case">":return ft(e,s,r);case">=":return mt(e,s,r);case"<":return gt(e,s,r);case"<=":return Et(e,s,r);default:throw new TypeError(`Invalid operator: ${t}`)}};const $t=ve,It=Re,{re:wt,t:yt}=se.exports;var St=(e,t)=>{if(e instanceof $t)return e;if("number"==typeof e&&(e=String(e)),"string"!=typeof e)return null;let s=null;if((t=t||{}).rtl){let t;for(;(t=wt[yt.COERCERTL].exec(e))&&(!s||s.index+s[0].length!==e.length);)s&&t.index+t[0].length===s.index+s[0].length||(s=t),wt[yt.COERCERTL].lastIndex=t.index+t[1].length+t[2].length;wt[yt.COERCERTL].lastIndex=-1}else s=e.match(wt[yt.COERCE]);return null===s?null:It(`${s[2]}.${s[3]||"0"}.${s[4]||"0"}`,t)};const Rt="object"==typeof performance&&performance&&"function"==typeof performance.now?performance:Date,Lt="undefined"!=typeof AbortController?AbortController:Object.assign(class{constructor(){this.signal=new Lt.AbortSignal}abort(){this.signal.aborted=!0}},{AbortSignal:class{constructor(){this.aborted=!1}}}),Ot=new Set,Tt=(e,t)=>{const s=`LRU_CACHE_OPTION_${e}`;Nt(s)&&xt(s,`${e} option`,`options.${t}`,Mt)},At=(e,t)=>{const s=`LRU_CACHE_METHOD_${e}`;if(Nt(s)){const{prototype:r}=Mt,{get:i}=Object.getOwnPropertyDescriptor(r,e);xt(s,`${e} method`,`cache.${t}()`,i)}},bt=(...e)=>{"object"==typeof process&&process&&"function"==typeof process.emitWarning?process.emitWarning(...e):console.error(...e)},Nt=e=>!Ot.has(e),xt=(e,t,s,r)=>{Ot.add(e);bt(`The ${t} is deprecated. Please use ${s} instead.`,"DeprecationWarning",e,r)},Ct=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),kt=e=>Ct(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?zt:null:null;class zt extends Array{constructor(e){super(e),this.fill(0)}}class Pt{constructor(e){const t=e?kt(e):Array;this.heap=new t(e),this.length=0}push(e){this.heap[this.length++]=e}pop(){return this.heap[--this.length]}}class Mt{constructor(e={}){const{max:t=0,ttl:s,ttlResolution:r=1,ttlAutopurge:i,updateAgeOnGet:n,updateAgeOnHas:o,allowStale:a,dispose:h,disposeAfter:l,noDisposeOnSet:c,noUpdateTTL:p,maxSize:u=0,sizeCalculation:d,fetchMethod:f}=e,{length:m,maxAge:g,stale:E}=e instanceof Mt?{}:e;if(0!==t&&!Ct(t))throw new TypeError("max option must be a nonnegative integer");const v=t?kt(t):Array;if(!v)throw new Error("invalid max value: "+t);if(this.max=t,this.maxSize=u,this.sizeCalculation=d||m,this.sizeCalculation){if(!this.maxSize)throw new TypeError("cannot set sizeCalculation without setting maxSize");if("function"!=typeof this.sizeCalculation)throw new TypeError("sizeCalculation set to non-function")}if(this.fetchMethod=f||null,this.fetchMethod&&"function"!=typeof this.fetchMethod)throw new TypeError("fetchMethod must be a function if specified");if(this.keyMap=new Map,this.keyList=new Array(t).fill(null),this.valList=new Array(t).fill(null),this.next=new v(t),this.prev=new v(t),this.head=0,this.tail=0,this.free=new Pt(t),this.initialFill=1,this.size=0,"function"==typeof h&&(this.dispose=h),"function"==typeof l?(this.disposeAfter=l,this.disposed=[]):(this.disposeAfter=null,this.disposed=null),this.noDisposeOnSet=!!c,this.noUpdateTTL=!!p,0!==this.maxSize){if(!Ct(this.maxSize))throw new TypeError("maxSize must be a positive integer if specified");this.initializeSizeTracking()}if(this.allowStale=!!a||!!E,this.updateAgeOnGet=!!n,this.updateAgeOnHas=!!o,this.ttlResolution=Ct(r)||0===r?r:1,this.ttlAutopurge=!!i,this.ttl=s||g||0,this.ttl){if(!Ct(this.ttl))throw new TypeError("ttl must be a positive integer if specified");this.initializeTTLTracking()}if(0===this.max&&0===this.ttl&&0===this.maxSize)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!this.max&&!this.maxSize){const e="LRU_CACHE_UNBOUNDED";if(Nt(e)){Ot.add(e);bt("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",e,Mt)}}E&&Tt("stale","allowStale"),g&&Tt("maxAge","ttl"),m&&Tt("length","sizeCalculation")}getRemainingTTL(e){return this.has(e,{updateAgeOnHas:!1})?1/0:0}initializeTTLTracking(){this.ttls=new zt(this.max),this.starts=new zt(this.max),this.setItemTTL=(e,t)=>{if(this.starts[e]=0!==t?Rt.now():0,this.ttls[e]=t,0!==t&&this.ttlAutopurge){const s=setTimeout((()=>{this.isStale(e)&&this.delete(this.keyList[e])}),t+1);s.unref&&s.unref()}},this.updateItemAge=e=>{this.starts[e]=0!==this.ttls[e]?Rt.now():0};let e=0;const t=()=>{const t=Rt.now();if(this.ttlResolution>0){e=t;const s=setTimeout((()=>e=0),this.ttlResolution);s.unref&&s.unref()}return t};this.getRemainingTTL=s=>{const r=this.keyMap.get(s);return void 0===r?0:0===this.ttls[r]||0===this.starts[r]?1/0:this.starts[r]+this.ttls[r]-(e||t())},this.isStale=s=>0!==this.ttls[s]&&0!==this.starts[s]&&(e||t())-this.starts[s]>this.ttls[s]}updateItemAge(e){}setItemTTL(e,t){}isStale(e){return!1}initializeSizeTracking(){this.calculatedSize=0,this.sizes=new zt(this.max),this.removeItemSize=e=>this.calculatedSize-=this.sizes[e],this.requireSize=(e,t,s,r)=>{if(!Ct(s)){if(!r)throw new TypeError("invalid size value (must be positive integer)");if("function"!=typeof r)throw new TypeError("sizeCalculation must be a function");if(s=r(t,e),!Ct(s))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}return s},this.addItemSize=(e,t,s,r)=>{this.sizes[e]=r;const i=this.maxSize-this.sizes[e];for(;this.calculatedSize>i;)this.evict();this.calculatedSize+=this.sizes[e]},this.delete=e=>{if(0!==this.size){const t=this.keyMap.get(e);void 0!==t&&(this.calculatedSize-=this.sizes[t])}return Mt.prototype.delete.call(this,e)}}removeItemSize(e){}addItemSize(e,t,s,r){}requireSize(e,t,s,r){if(s||r)throw new TypeError("cannot set size without setting maxSize on cache")}*indexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.tail;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.head);)t=this.prev[t]}*rindexes({allowStale:e=this.allowStale}={}){if(this.size)for(let t=this.head;this.isValidIndex(t)&&(!e&&this.isStale(t)||(yield t),t!==this.tail);)t=this.next[t]}isValidIndex(e){return this.keyMap.get(this.keyList[e])===e}*entries(){for(const e of this.indexes())yield[this.keyList[e],this.valList[e]]}*rentries(){for(const e of this.rindexes())yield[this.keyList[e],this.valList[e]]}*keys(){for(const e of this.indexes())yield this.keyList[e]}*rkeys(){for(const e of this.rindexes())yield this.keyList[e]}*values(){for(const e of this.indexes())yield this.valList[e]}*rvalues(){for(const e of this.rindexes())yield this.valList[e]}[Symbol.iterator](){return this.entries()}find(e,t={}){for(const s of this.indexes())if(e(this.valList[s],this.keyList[s],this))return this.get(this.keyList[s],t)}forEach(e,t=this){for(const s of this.indexes())e.call(t,this.valList[s],this.keyList[s],this)}rforEach(e,t=this){for(const s of this.rindexes())e.call(t,this.valList[s],this.keyList[s],this)}get prune(){return At("prune","purgeStale"),this.purgeStale}purgeStale(){let e=!1;for(const t of this.rindexes({allowStale:!0}))this.isStale(t)&&(this.delete(this.keyList[t]),e=!0);return e}dump(){const e=[];for(const t of this.indexes()){const s=this.keyList[t],r={value:this.valList[t]};this.ttls&&(r.ttl=this.ttls[t]),this.sizes&&(r.size=this.sizes[t]),e.unshift([s,r])}return e}load(e){this.clear();for(const[t,s]of e)this.set(t,s.value,s)}dispose(e,t,s){}set(e,t,{ttl:s=this.ttl,noDisposeOnSet:r=this.noDisposeOnSet,size:i=0,sizeCalculation:n=this.sizeCalculation,noUpdateTTL:o=this.noUpdateTTL}={}){i=this.requireSize(e,t,i,n);let a=0===this.size?void 0:this.keyMap.get(e);if(void 0===a)a=this.newIndex(),this.keyList[a]=e,this.valList[a]=t,this.keyMap.set(e,a),this.next[this.tail]=a,this.prev[a]=this.tail,this.tail=a,this.size++,this.addItemSize(a,t,e,i),o=!1;else{const s=this.valList[a];t!==s&&(this.isBackgroundFetch(s)?s.__abortController.abort():r||(this.dispose(s,e,"set"),this.disposeAfter&&this.disposed.push([s,e,"set"])),this.removeItemSize(a),this.valList[a]=t,this.addItemSize(a,t,e,i)),this.moveToTail(a)}if(0===s||0!==this.ttl||this.ttls||this.initializeTTLTracking(),o||this.setItemTTL(a,s),this.disposeAfter)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return this}newIndex(){return 0===this.size?this.tail:this.size===this.max?this.evict():0!==this.free.length?this.free.pop():this.initialFill++}pop(){if(this.size){const e=this.valList[this.head];return this.evict(),e}}evict(){const e=this.head,t=this.keyList[e],s=this.valList[e];return this.isBackgroundFetch(s)?s.__abortController.abort():(this.dispose(s,t,"evict"),this.disposeAfter&&this.disposed.push([s,t,"evict"])),this.removeItemSize(e),this.head=this.next[e],this.keyMap.delete(t),this.size--,e}has(e,{updateAgeOnHas:t=this.updateAgeOnHas}={}){const s=this.keyMap.get(e);return void 0!==s&&!this.isStale(s)&&(t&&this.updateItemAge(s),!0)}peek(e,{allowStale:t=this.allowStale}={}){const s=this.keyMap.get(e);if(void 0!==s&&(t||!this.isStale(s)))return this.valList[s]}backgroundFetch(e,t,s){const r=void 0===t?void 0:this.valList[t];if(this.isBackgroundFetch(r))return r;const i=new Lt,n={signal:i.signal,options:s},o=Promise.resolve(this.fetchMethod(e,r,n)).then((t=>(i.signal.aborted||this.set(e,t,n.options),t)));return o.__abortController=i,o.__staleWhileFetching=r,void 0===t?(this.set(e,o,n.options),t=this.keyMap.get(e)):this.valList[t]=o,o}isBackgroundFetch(e){return e&&"object"==typeof e&&"function"==typeof e.then&&Object.prototype.hasOwnProperty.call(e,"__staleWhileFetching")}async fetch(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet,ttl:r=this.ttl,noDisposeOnSet:i=this.noDisposeOnSet,size:n=0,sizeCalculation:o=this.sizeCalculation,noUpdateTTL:a=this.noUpdateTTL}={}){if(!this.fetchMethod)return this.get(e,{allowStale:t,updateAgeOnGet:s});const h={allowStale:t,updateAgeOnGet:s,ttl:r,noDisposeOnSet:i,size:n,sizeCalculation:o,noUpdateTTL:a};let l=this.keyMap.get(e);if(void 0===l)return this.backgroundFetch(e,l,h);{const r=this.valList[l];if(this.isBackgroundFetch(r))return t&&void 0!==r.__staleWhileFetching?r.__staleWhileFetching:r;if(!this.isStale(l))return this.moveToTail(l),s&&this.updateItemAge(l),r;const i=this.backgroundFetch(e,l,h);return t&&void 0!==i.__staleWhileFetching?i.__staleWhileFetching:i}}get(e,{allowStale:t=this.allowStale,updateAgeOnGet:s=this.updateAgeOnGet}={}){const r=this.keyMap.get(e);if(void 0!==r){const i=this.valList[r],n=this.isBackgroundFetch(i);if(this.isStale(r))return n?t?i.__staleWhileFetching:void 0:(this.delete(e),t?i:void 0);if(n)return;return this.moveToTail(r),s&&this.updateItemAge(r),i}}connect(e,t){this.prev[t]=e,this.next[e]=t}moveToTail(e){e!==this.tail&&(e===this.head?this.head=this.next[e]:this.connect(this.prev[e],this.next[e]),this.connect(this.tail,e),this.tail=e)}get del(){return At("del","delete"),this.delete}delete(e){let t=!1;if(0!==this.size){const s=this.keyMap.get(e);if(void 0!==s)if(t=!0,1===this.size)this.clear();else{this.removeItemSize(s);const t=this.valList[s];this.isBackgroundFetch(t)?t.__abortController.abort():(this.dispose(t,e,"delete"),this.disposeAfter&&this.disposed.push([t,e,"delete"])),this.keyMap.delete(e),this.keyList[s]=null,this.valList[s]=null,s===this.tail?this.tail=this.prev[s]:s===this.head?this.head=this.next[s]:(this.next[this.prev[s]]=this.next[s],this.prev[this.next[s]]=this.prev[s]),this.size--,this.free.push(s)}}if(this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift());return t}clear(){for(const e of this.rindexes({allowStale:!0})){const t=this.valList[e];if(this.isBackgroundFetch(t))t.__abortController.abort();else{const s=this.keyList[e];this.dispose(t,s,"delete"),this.disposeAfter&&this.disposed.push([t,s,"delete"])}}if(this.keyMap.clear(),this.valList.fill(null),this.keyList.fill(null),this.ttls&&(this.ttls.fill(0),this.starts.fill(0)),this.sizes&&this.sizes.fill(0),this.head=0,this.tail=0,this.initialFill=1,this.free.length=0,this.calculatedSize=0,this.size=0,this.disposed)for(;this.disposed.length;)this.disposeAfter(...this.disposed.shift())}get reset(){return At("reset","clear"),this.clear}get length(){return((e,t)=>{const s=`LRU_CACHE_PROPERTY_${e}`;if(Nt(s)){const{prototype:r}=Mt,{get:i}=Object.getOwnPropertyDescriptor(r,e);xt(s,`${e} property`,`cache.${t}`,i)}})("length","size"),this.size}}var Dt=Mt;class jt{constructor(e,t){if(t=Gt(t),e instanceof jt)return e.loose===!!t.loose&&e.includePrerelease===!!t.includePrerelease?e:new jt(e.raw,t);if(e instanceof Ut)return this.raw=e.value,this.set=[[e]],this.format(),this;if(this.options=t,this.loose=!!t.loose,this.includePrerelease=!!t.includePrerelease,this.raw=e,this.set=e.split("||").map((e=>this.parseRange(e.trim()))).filter((e=>e.length)),!this.set.length)throw new TypeError(`Invalid SemVer Range: ${e}`);if(this.set.length>1){const e=this.set[0];if(this.set=this.set.filter((e=>!Zt(e[0]))),0===this.set.length)this.set=[e];else if(this.set.length>1)for(const e of this.set)if(1===e.length&&Jt(e[0])){this.set=[e];break}}this.format()}format(){return this.range=this.set.map((e=>e.join(" ").trim())).join("||").trim(),this.range}toString(){return this.range}parseRange(e){e=e.trim();const t=`parseRange:${Object.keys(this.options).join(",")}:${e}`,s=_t.get(t);if(s)return s;const r=this.options.loose,i=r?Vt[Bt.HYPHENRANGELOOSE]:Vt[Bt.HYPHENRANGE];e=e.replace(i,ls(this.options.includePrerelease)),Ht("hyphen replace",e),e=e.replace(Vt[Bt.COMPARATORTRIM],Wt),Ht("comparator trim",e);let n=(e=(e=(e=e.replace(Vt[Bt.TILDETRIM],qt)).replace(Vt[Bt.CARETTRIM],Yt)).split(/\s+/).join(" ")).split(" ").map((e=>Kt(e,this.options))).join(" ").split(/\s+/).map((e=>hs(e,this.options)));r&&(n=n.filter((e=>(Ht("loose invalid filter",e,this.options),!!e.match(Vt[Bt.COMPARATORLOOSE]))))),Ht("range list",n);const o=new Map,a=n.map((e=>new Ut(e,this.options)));for(const e of a){if(Zt(e))return[e];o.set(e.value,e)}o.size>1&&o.has("")&&o.delete("");const h=[...o.values()];return _t.set(t,h),h}intersects(e,t){if(!(e instanceof jt))throw new TypeError("a Range is required");return this.set.some((s=>Qt(s,t)&&e.set.some((e=>Qt(e,t)&&s.every((s=>e.every((e=>s.intersects(e,t)))))))))}test(e){if(!e)return!1;if("string"==typeof e)try{e=new Xt(e,this.options)}catch(e){return!1}for(let t=0;t<this.set.length;t++)if(cs(this.set[t],e,this.options))return!0;return!1}}var Ft=jt;const _t=new Dt({max:1e3}),Gt=oe,Ut=ds,Ht=ie,Xt=ve,{re:Vt,t:Bt,comparatorTrimReplace:Wt,tildeTrimReplace:qt,caretTrimReplace:Yt}=se.exports,Zt=e=>"<0.0.0-0"===e.value,Jt=e=>""===e.value,Qt=(e,t)=>{let s=!0;const r=e.slice();let i=r.pop();for(;s&&r.length;)s=r.every((e=>i.intersects(e,t))),i=r.pop();return s},Kt=(e,t)=>(Ht("comp",e,t),e=rs(e,t),Ht("caret",e),e=ts(e,t),Ht("tildes",e),e=ns(e,t),Ht("xrange",e),e=as(e,t),Ht("stars",e),e),es=e=>!e||"x"===e.toLowerCase()||"*"===e,ts=(e,t)=>e.trim().split(/\s+/).map((e=>ss(e,t))).join(" "),ss=(e,t)=>{const s=t.loose?Vt[Bt.TILDELOOSE]:Vt[Bt.TILDE];return e.replace(s,((t,s,r,i,n)=>{let o;return Ht("tilde",e,t,s,r,i,n),es(s)?o="":es(r)?o=`>=${s}.0.0 <${+s+1}.0.0-0`:es(i)?o=`>=${s}.${r}.0 <${s}.${+r+1}.0-0`:n?(Ht("replaceTilde pr",n),o=`>=${s}.${r}.${i}-${n} <${s}.${+r+1}.0-0`):o=`>=${s}.${r}.${i} <${s}.${+r+1}.0-0`,Ht("tilde return",o),o}))},rs=(e,t)=>e.trim().split(/\s+/).map((e=>is(e,t))).join(" "),is=(e,t)=>{Ht("caret",e,t);const s=t.loose?Vt[Bt.CARETLOOSE]:Vt[Bt.CARET],r=t.includePrerelease?"-0":"";return e.replace(s,((t,s,i,n,o)=>{let a;return Ht("caret",e,t,s,i,n,o),es(s)?a="":es(i)?a=`>=${s}.0.0${r} <${+s+1}.0.0-0`:es(n)?a="0"===s?`>=${s}.${i}.0${r} <${s}.${+i+1}.0-0`:`>=${s}.${i}.0${r} <${+s+1}.0.0-0`:o?(Ht("replaceCaret pr",o),a="0"===s?"0"===i?`>=${s}.${i}.${n}-${o} <${s}.${i}.${+n+1}-0`:`>=${s}.${i}.${n}-${o} <${s}.${+i+1}.0-0`:`>=${s}.${i}.${n}-${o} <${+s+1}.0.0-0`):(Ht("no pr"),a="0"===s?"0"===i?`>=${s}.${i}.${n}${r} <${s}.${i}.${+n+1}-0`:`>=${s}.${i}.${n}${r} <${s}.${+i+1}.0-0`:`>=${s}.${i}.${n} <${+s+1}.0.0-0`),Ht("caret return",a),a}))},ns=(e,t)=>(Ht("replaceXRanges",e,t),e.split(/\s+/).map((e=>os(e,t))).join(" ")),os=(e,t)=>{e=e.trim();const s=t.loose?Vt[Bt.XRANGELOOSE]:Vt[Bt.XRANGE];return e.replace(s,((s,r,i,n,o,a)=>{Ht("xRange",e,s,r,i,n,o,a);const h=es(i),l=h||es(n),c=l||es(o),p=c;return"="===r&&p&&(r=""),a=t.includePrerelease?"-0":"",h?s=">"===r||"<"===r?"<0.0.0-0":"*":r&&p?(l&&(n=0),o=0,">"===r?(r=">=",l?(i=+i+1,n=0,o=0):(n=+n+1,o=0)):"<="===r&&(r="<",l?i=+i+1:n=+n+1),"<"===r&&(a="-0"),s=`${r+i}.${n}.${o}${a}`):l?s=`>=${i}.0.0${a} <${+i+1}.0.0-0`:c&&(s=`>=${i}.${n}.0${a} <${i}.${+n+1}.0-0`),Ht("xRange return",s),s}))},as=(e,t)=>(Ht("replaceStars",e,t),e.trim().replace(Vt[Bt.STAR],"")),hs=(e,t)=>(Ht("replaceGTE0",e,t),e.trim().replace(Vt[t.includePrerelease?Bt.GTE0PRE:Bt.GTE0],"")),ls=e=>(t,s,r,i,n,o,a,h,l,c,p,u,d)=>`${s=es(r)?"":es(i)?`>=${r}.0.0${e?"-0":""}`:es(n)?`>=${r}.${i}.0${e?"-0":""}`:o?`>=${s}`:`>=${s}${e?"-0":""}`} ${h=es(l)?"":es(c)?`<${+l+1}.0.0-0`:es(p)?`<${l}.${+c+1}.0-0`:u?`<=${l}.${c}.${p}-${u}`:e?`<${l}.${c}.${+p+1}-0`:`<=${h}`}`.trim(),cs=(e,t,s)=>{for(let s=0;s<e.length;s++)if(!e[s].test(t))return!1;if(t.prerelease.length&&!s.includePrerelease){for(let s=0;s<e.length;s++)if(Ht(e[s].semver),e[s].semver!==Ut.ANY&&e[s].semver.prerelease.length>0){const r=e[s].semver;if(r.major===t.major&&r.minor===t.minor&&r.patch===t.patch)return!0}return!1}return!0},ps=Symbol("SemVer ANY");class us{static get ANY(){return ps}constructor(e,t){if(t=fs(t),e instanceof us){if(e.loose===!!t.loose)return e;e=e.value}vs("comparator",e,t),this.options=t,this.loose=!!t.loose,this.parse(e),this.semver===ps?this.value="":this.value=this.operator+this.semver.version,vs("comp",this)}parse(e){const t=this.options.loose?ms[gs.COMPARATORLOOSE]:ms[gs.COMPARATOR],s=e.match(t);if(!s)throw new TypeError(`Invalid comparator: ${e}`);this.operator=void 0!==s[1]?s[1]:"","="===this.operator&&(this.operator=""),s[2]?this.semver=new $s(s[2],this.options.loose):this.semver=ps}toString(){return this.value}test(e){if(vs("Comparator.test",e,this.options.loose),this.semver===ps||e===ps)return!0;if("string"==typeof e)try{e=new $s(e,this.options)}catch(e){return!1}return Es(e,this.operator,this.semver,this.options)}intersects(e,t){if(!(e instanceof us))throw new TypeError("a Comparator is required");if(t&&"object"==typeof t||(t={loose:!!t,includePrerelease:!1}),""===this.operator)return""===this.value||new Is(e.value,t).test(this.value);if(""===e.operator)return""===e.value||new Is(this.value,t).test(e.semver);const s=!(">="!==this.operator&&">"!==this.operator||">="!==e.operator&&">"!==e.operator),r=!("<="!==this.operator&&"<"!==this.operator||"<="!==e.operator&&"<"!==e.operator),i=this.semver.version===e.semver.version,n=!(">="!==this.operator&&"<="!==this.operator||">="!==e.operator&&"<="!==e.operator),o=Es(this.semver,"<",e.semver,t)&&(">="===this.operator||">"===this.operator)&&("<="===e.operator||"<"===e.operator),a=Es(this.semver,">",e.semver,t)&&("<="===this.operator||"<"===this.operator)&&(">="===e.operator||">"===e.operator);return s||r||i&&n||o||a}}var ds=us;const fs=oe,{re:ms,t:gs}=se.exports,Es=vt,vs=ie,$s=ve,Is=Ft,ws=Ft;var ys=(e,t,s)=>{try{t=new ws(t,s)}catch(e){return!1}return t.test(e)};const Ss=Ft;var Rs=(e,t)=>new Ss(e,t).set.map((e=>e.map((e=>e.value)).join(" ").trim().split(" ")));const Ls=ve,Os=Ft;var Ts=(e,t,s)=>{let r=null,i=null,n=null;try{n=new Os(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(r&&-1!==i.compare(e)||(r=e,i=new Ls(r,s)))})),r};const As=ve,bs=Ft;var Ns=(e,t,s)=>{let r=null,i=null,n=null;try{n=new bs(t,s)}catch(e){return null}return e.forEach((e=>{n.test(e)&&(r&&1!==i.compare(e)||(r=e,i=new As(r,s)))})),r};const xs=ve,Cs=Ft,ks=rt;var zs=(e,t)=>{e=new Cs(e,t);let s=new xs("0.0.0");if(e.test(s))return s;if(s=new xs("0.0.0-0"),e.test(s))return s;s=null;for(let t=0;t<e.set.length;++t){const r=e.set[t];let i=null;r.forEach((e=>{const t=new xs(e.semver.version);switch(e.operator){case">":0===t.prerelease.length?t.patch++:t.prerelease.push(0),t.raw=t.format();case"":case">=":i&&!ks(t,i)||(i=t);break;case"<":case"<=":break;default:throw new Error(`Unexpected operation: ${e.operator}`)}})),!i||s&&!ks(s,i)||(s=i)}return s&&e.test(s)?s:null};const Ps=Ft;var Ms=(e,t)=>{try{return new Ps(e,t).range||"*"}catch(e){return null}};const Ds=ve,js=ds,{ANY:Fs}=js,_s=Ft,Gs=ys,Us=rt,Hs=nt,Xs=pt,Vs=lt;var Bs=(e,t,s,r)=>{let i,n,o,a,h;switch(e=new Ds(e,r),t=new _s(t,r),s){case">":i=Us,n=Xs,o=Hs,a=">",h=">=";break;case"<":i=Hs,n=Vs,o=Us,a="<",h="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Gs(e,t,r))return!1;for(let s=0;s<t.set.length;++s){const l=t.set[s];let c=null,p=null;if(l.forEach((e=>{e.semver===Fs&&(e=new js(">=0.0.0")),c=c||e,p=p||e,i(e.semver,c.semver,r)?c=e:o(e.semver,p.semver,r)&&(p=e)})),c.operator===a||c.operator===h)return!1;if((!p.operator||p.operator===a)&&n(e,p.semver))return!1;if(p.operator===h&&o(e,p.semver))return!1}return!0};const Ws=Bs;var qs=(e,t,s)=>Ws(e,t,">",s);const Ys=Bs;var Zs=(e,t,s)=>Ys(e,t,"<",s);const Js=Ft;var Qs=(e,t,s)=>(e=new Js(e,s),t=new Js(t,s),e.intersects(t));const Ks=ys,er=Ce;const tr=Ft,sr=ds,{ANY:rr}=sr,ir=ys,nr=Ce,or=(e,t,s)=>{if(e===t)return!0;if(1===e.length&&e[0].semver===rr){if(1===t.length&&t[0].semver===rr)return!0;e=s.includePrerelease?[new sr(">=0.0.0-0")]:[new sr(">=0.0.0")]}if(1===t.length&&t[0].semver===rr){if(s.includePrerelease)return!0;t=[new sr(">=0.0.0")]}const r=new Set;let i,n,o,a,h,l,c;for(const t of e)">"===t.operator||">="===t.operator?i=ar(i,t,s):"<"===t.operator||"<="===t.operator?n=hr(n,t,s):r.add(t.semver);if(r.size>1)return null;if(i&&n){if(o=nr(i.semver,n.semver,s),o>0)return null;if(0===o&&(">="!==i.operator||"<="!==n.operator))return null}for(const e of r){if(i&&!ir(e,String(i),s))return null;if(n&&!ir(e,String(n),s))return null;for(const r of t)if(!ir(e,String(r),s))return!1;return!0}let p=!(!n||s.includePrerelease||!n.semver.prerelease.length)&&n.semver,u=!(!i||s.includePrerelease||!i.semver.prerelease.length)&&i.semver;p&&1===p.prerelease.length&&"<"===n.operator&&0===p.prerelease[0]&&(p=!1);for(const e of t){if(c=c||">"===e.operator||">="===e.operator,l=l||"<"===e.operator||"<="===e.operator,i)if(u&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===u.major&&e.semver.minor===u.minor&&e.semver.patch===u.patch&&(u=!1),">"===e.operator||">="===e.operator){if(a=ar(i,e,s),a===e&&a!==i)return!1}else if(">="===i.operator&&!ir(i.semver,String(e),s))return!1;if(n)if(p&&e.semver.prerelease&&e.semver.prerelease.length&&e.semver.major===p.major&&e.semver.minor===p.minor&&e.semver.patch===p.patch&&(p=!1),"<"===e.operator||"<="===e.operator){if(h=hr(n,e,s),h===e&&h!==n)return!1}else if("<="===n.operator&&!ir(n.semver,String(e),s))return!1;if(!e.operator&&(n||i)&&0!==o)return!1}return!(i&&l&&!n&&0!==o)&&(!(n&&c&&!i&&0!==o)&&(!u&&!p))},ar=(e,t,s)=>{if(!e)return t;const r=nr(e.semver,t.semver,s);return r>0?e:r<0||">"===t.operator&&">="===e.operator?t:e},hr=(e,t,s)=>{if(!e)return t;const r=nr(e.semver,t.semver,s);return r<0?e:r>0||"<"===t.operator&&"<="===e.operator?t:e};var lr=(e,t,s={})=>{if(e===t)return!0;e=new tr(e,s),t=new tr(t,s);let r=!1;e:for(const i of e.set){for(const e of t.set){const t=or(i,e,s);if(r=r||null!==t,t)continue e}if(r)return!1}return!0};const cr=se.exports;var pr={re:cr.re,src:cr.src,tokens:cr.t,SEMVER_SPEC_VERSION:re.SEMVER_SPEC_VERSION,SemVer:ve,compareIdentifiers:le.compareIdentifiers,rcompareIdentifiers:le.rcompareIdentifiers,parse:Re,valid:Oe,clean:Ae,inc:Ne,diff:De,major:Fe,minor:Ge,patch:He,prerelease:Ve,compare:Ce,rcompare:We,compareLoose:Ye,compareBuild:Je,sort:Ke,rsort:tt,gt:rt,lt:nt,eq:ze,neq:at,gte:lt,lte:pt,cmp:vt,coerce:St,Comparator:ds,Range:Ft,satisfies:ys,toComparators:Rs,maxSatisfying:Ts,minSatisfying:Ns,minVersion:zs,validRange:Ms,outside:Bs,gtr:qs,ltr:Zs,intersects:Qs,simplifyRange:(e,t,s)=>{const r=[];let i=null,n=null;const o=e.sort(((e,t)=>er(e,t,s)));for(const e of o){Ks(e,t,s)?(n=e,i||(i=e)):(n&&r.push([i,n]),n=null,i=null)}i&&r.push([i,null]);const a=[];for(const[e,t]of r)e===t?a.push(e):t||e!==o[0]?t?e===o[0]?a.push(`<=${t}`):a.push(`${e} - ${t}`):a.push(`>=${e}`):a.push("*");const h=a.join(" || "),l="string"==typeof t.raw?t.raw:String(t);return h.length<l.length?h:t},subset:lr};class ur{constructor(){this.tasks=[],this.isDownloading=!1}addTask(e){if("function"!=typeof e)throw new TypeError("Task must be a function!");this.tasks.push(e),this.isDownloading||(this.isDownloading=!0,this.download())}download(){const e=this.tasks.shift();e?e().then((()=>{this.download()})):this.isDownloading=!1}downAndungzip(t,i,n,o){return new Promise(((a,h)=>{const l=`${n}.tmp`;if(s.existsSync(n)&&V(s.readFileSync(n))===t)a(!0);else{const c=e.createHash("sha256"),p=r.createGunzip(),u=s.createWriteStream(l);o(i).then((e=>{e.pipe(p)}),(e=>{h(e)})),p.on("error",(e=>{p.close(),u.close(),c.destroy(),h(e)})),p.on("data",(e=>{c.write(e),u.write(e)})),p.on("end",(()=>{c.digest("hex")!==t?(c.destroy(),h(new Error("下载文件出错"))):(u.on("finish",(()=>{s.rename(l,n,(e=>{e?h(e):a(!0)}))})),u.end())}))}}))}}exports.DiffVersionHashResult=H,exports.DiffVersionHashResultItem=class{},exports.HashedFile=G,exports.HashedFolder=U,exports.UpdateElectron=class{constructor(e,t,s,r,i,n,o,a,h,l={files:{}}){this.statusCallback=e,this.updaterName=t,this.version=s,this.exePath=r,this.tempDirectory=i,this.updateConfigName=n,this.updateJson=o,this.baseUrl=a,this.downloadFn=h,this.options=l,this.downloadQueue=new ur}checkForUpdates(){try{if(pr.gt(this.updateJson.version,this.version)){const e=W(t.dirname(this.exePath),this.options);q(e);return Y(e,this.updateJson.hash)}return}catch(e){this.statusCallback({message:e,status:"failed"}),console.log("checkForUpdates",e)}}downloadUpdate(e){return n(this,void 0,void 0,(function*(){try{s.existsSync(this.tempDirectory)||s.mkdirSync(this.tempDirectory),this.baseUrl.endsWith("/")||(this.baseUrl+="/");const r=e.changed.map((e=>e.hash)),i=e.added.map((e=>e.hash));let n=[];try{n=yield Q(this.tempDirectory)}catch(e){console.log("Get local difference packages",e)}const o=ee(n,r),a=ee(n,i);this.statusCallback({message:{changedOptimizedData:o,addedOptimizedData:a,changed:r,added:i,tempFileHash:n,msg:"findDifferentElements"},status:"init"}),yield Promise.all(te([...a,...o]).map((e=>{const s=`${this.baseUrl}${e}.gz`;return this.downloadQueue.addTask((()=>this.downloadQueue.downAndungzip(e,s,t.join(this.tempDirectory,e),this.downloadFn))),1})))}catch(e){this.statusCallback({message:e,status:"failed"}),console.log("downloadUpdate",e)}}))}install(e=!1){var t,s;return n(this,void 0,void 0,(function*(){try{let r=!0;if(e)r=e;else{if(!(yield this.validateDiffPackageIntegrity()))return this.statusCallback({message:"Installation check difference failed",status:"failed"}),!1}if(r){const e=i.spawn(this.updaterName,{detached:!0,env:{exe_path:this.exePath,update_temp_path:this.tempDirectory,update_config_file_name:this.updateConfigName+".json",exe_pid:process.pid.toString()},stdio:"ignore"});return null===(t=e.stdout)||void 0===t||t.on("data",(e=>{this.statusCallback({message:{data:JSON.stringify(e),msg:"child.stdout data"},status:"init"})})),null===(s=e.stdout)||void 0===s||s.on("close",(()=>{this.statusCallback({message:"child.stdout close",status:"init"})})),!0}return!1}catch(e){this.statusCallback({message:e,status:"failed"})}}))}validateDiffPackageIntegrity(){return n(this,void 0,void 0,(function*(){const e=this.checkForUpdates();if(void 0!==e){let t=[];const s=te([...e.changed,...e.added].map((e=>e.hash)));try{t=yield Q(this.tempDirectory)}catch(e){console.log("Get local difference packages",e)}this.statusCallback({message:{tempFileHash:t,diffResultAll:s,msg:"validateDiffPackageIntegrity"},status:"init"});const r=K(s,t);return this.statusCallback({message:{is:r,msg:"hasSameElement"},status:"init"}),r}return!1}))}},exports.UpdateInfo=class{constructor(){this.status="init",this.message=""}},exports.diffVersionHash=Y,exports.downAndungzip=function(t,i,n,o){return new Promise(((a,h)=>{if(s.existsSync(n)&&V(s.readFileSync(n))===t)a(!0);else{const l=e.createHash("sha256"),c=r.createGunzip(),p=s.createWriteStream(n);o(i).then((e=>{e.pipe(c)}),(e=>{h(e)})),c.on("error",(e=>{c.close(),p.close(),l.destroy(),h(e)})),c.on("data",(e=>{l.write(e),p.write(e)})),c.on("end",(()=>{l.digest("hex")!==t?(l.destroy(),h(new Error("下载文件出错"))):a(!0)}))}}))},exports.findDifferentElements=ee,exports.getLocalDifferenceFileName=Q,exports.gzip=J,exports.handleHashedFolderChildrenToObject=q,exports.hasSameElement=K,exports.hash256=V,exports.hashElement=W,exports.pushdiffVersionHashResult=Z,exports.reduceGlobPatterns=B,exports.unique=te,exports.zipHashElement=function e(s,r,i,o=!1){return n(this,void 0,void 0,(function*(){if(s.children)for(let t=0;t<s.children.length;t++)yield e(s.children[t],r+(o?"":"/"+s.name),i);else yield J(r+"/"+s.name,t.join(i,s.hash+".gz"))}))};
